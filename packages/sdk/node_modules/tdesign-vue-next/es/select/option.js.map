{"version":3,"file":"option.js","sources":["../../src/select/option.tsx"],"sourcesContent":["import { defineComponent, VNode } from 'vue';\nimport get from 'lodash/get';\nimport { renderContent } from '../utils/render-tnode';\nimport { scrollSelectedIntoView } from '../utils/dom';\nimport { prefix } from '../config';\nimport CLASSNAMES from '../utils/classnames';\nimport ripple from '../utils/ripple';\nimport props from './option-props';\nimport { SelectOption } from './type';\nimport Checkbox from '../checkbox/index';\nimport { ClassName } from '../common';\n\nconst selectName = `${prefix}-select`;\n\nexport default defineComponent({\n  name: 'TOption',\n  components: {\n    TCheckbox: Checkbox,\n  },\n  directives: { ripple },\n  inject: {\n    tSelect: {\n      default: undefined,\n    },\n  },\n  props: { ...props },\n  data() {\n    return {\n      isHover: false,\n    };\n  },\n  computed: {\n    // 键盘上下按键选中hover样式的选项\n    hovering(): boolean {\n      return get(this.tSelect, `hoverOptions[${this.tSelect.hoverIndex}][${this.tSelect.realValue}]`) === this.value;\n    },\n    multiLimitDisabled(): boolean {\n      if (this.tSelect && this.tSelect.multiple && this.tSelect.max) {\n        if (\n          this.tSelect.value instanceof Array &&\n          this.tSelect.value.indexOf(this.value) === -1 &&\n          this.tSelect.max <= this.tSelect.value.length\n        ) {\n          return true;\n        }\n      }\n      return false;\n    },\n    classes(): ClassName {\n      return [\n        `${prefix}-select-option`,\n        {\n          [CLASSNAMES.STATUS.disabled]: this.disabled || this.multiLimitDisabled,\n          [CLASSNAMES.STATUS.selected]: this.selected,\n          [CLASSNAMES.SIZE[this.tSelect && this.tSelect.size]]: this.tSelect && this.tSelect.size,\n          [`${prefix}-select-option__hover`]: this.hovering,\n        },\n      ];\n    },\n    isCreatedOption(): boolean {\n      return this.tSelect.creatable && this.value === this.tSelect.searchInput;\n    },\n    show(): boolean {\n      /**\n       * 此属性主要用于slots生成options时显示控制，直传options由select进行显示控制\n       * create的option，始终显示\n       * canFilter只显示待匹配的选项\n       */\n      if (!this.tSelect) return false;\n      if (this.isCreatedOption) return true;\n      if (this.tSelect.canFilter && this.tSelect.searchInput !== '') {\n        return this.tSelect.filterOptions.some(\n          (option: SelectOption) => get(option, this.tSelect.realValue) === this.value,\n        );\n      }\n      return true;\n    },\n    labelText(): string {\n      return this.label || String(this.value);\n    },\n    selected(): boolean {\n      let flag = false;\n      if (!this.tSelect) return false;\n      if (this.tSelect.value instanceof Array) {\n        if (this.tSelect.labelInValue) {\n          flag =\n            this.tSelect.value\n              .map((item: string | number | SelectOption) => get(item, this.tSelect.realValue))\n              .indexOf(this.value) !== -1;\n        } else {\n          flag = this.tSelect.value.indexOf(this.value) !== -1;\n        }\n      } else if (typeof this.tSelect.value === 'object') {\n        flag = get(this.tSelect.value, this.tSelect.realValue) === this.value;\n      } else {\n        flag = this.tSelect.value === this.value;\n      }\n      return flag;\n    },\n  },\n  watch: {\n    value() {\n      this.tSelect && this.tSelect.getOptions(this);\n    },\n    label() {\n      this.tSelect && this.tSelect.getOptions(this);\n    },\n    hovering() {\n      if (this.hovering) {\n        const timer = setTimeout(() => {\n          scrollSelectedIntoView(this.tSelect.getOverlayElm(), this.$el as HTMLElement);\n          clearTimeout(timer);\n        }, this.tSelect.popupOpenTime); // 待popup弹出后再滚动到对应位置\n      }\n    },\n  },\n  mounted() {\n    this.tSelect && this.tSelect.getOptions(this);\n  },\n  methods: {\n    select(e: MouseEvent | KeyboardEvent) {\n      e.stopPropagation();\n      if (this.disabled || this.multiLimitDisabled) {\n        return false;\n      }\n      const parent = this.$el.parentNode as HTMLElement;\n      if (parent && parent.className.indexOf(`${selectName}__create-option`) !== -1) {\n        this.tSelect && this.tSelect.createOption(this.value.toString());\n      }\n      this.tSelect && this.tSelect.onOptionClick(this.value, e);\n    },\n    mouseEvent(v: boolean) {\n      this.isHover = v;\n    },\n  },\n  render(): VNode {\n    const { classes, labelText, selected, disabled, multiLimitDisabled, show } = this;\n    const children = renderContent(this, 'default', 'content');\n    const optionChild = children || labelText;\n    return (\n      <li\n        v-show={show}\n        class={classes}\n        title={labelText}\n        onMouseenter={() => this.mouseEvent(true)}\n        onMouseleave={() => this.mouseEvent(false)}\n        onClick={(e: MouseEvent) => {\n          e.preventDefault();\n          this.select(e);\n        }}\n        v-ripple\n      >\n        {this.tSelect && this.tSelect.multiple ? (\n          <t-checkbox checked={selected} disabled={disabled || multiLimitDisabled}>\n            {optionChild}\n          </t-checkbox>\n        ) : (\n          optionChild\n        )}\n      </li>\n    );\n  },\n});\n"],"names":["selectName","prefix","defineComponent","name","components","TCheckbox","Checkbox","directives","ripple","inject","tSelect","props","data","isHover","computed","hovering","get","hoverIndex","realValue","value","multiLimitDisabled","multiple","max","Array","indexOf","length","classes","CLASSNAMES","STATUS","disabled","selected","SIZE","size","isCreatedOption","creatable","searchInput","show","canFilter","filterOptions","some","option","labelText","label","String","flag","labelInValue","map","item","watch","getOptions","timer","setTimeout","scrollSelectedIntoView","getOverlayElm","$el","clearTimeout","popupOpenTime","mounted","methods","select","e","stopPropagation","parent","parentNode","className","createOption","toString","onOptionClick","mouseEvent","v","render","children","renderContent","optionChild","preventDefault"],"mappings":"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"}