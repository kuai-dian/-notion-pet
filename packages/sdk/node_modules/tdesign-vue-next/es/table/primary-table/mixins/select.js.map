{"version":3,"file":"select.js","sources":["../../../../src/table/primary-table/mixins/select.tsx"],"sourcesContent":["import { defineComponent, VNode } from 'vue';\nimport get from 'lodash/get';\nimport { PrimaryTableCol } from '../../type';\nimport primaryTableProps from '../../primary-table-props';\nimport baseTableProps from '../../base-table-props';\nimport { prefix } from '../../../config';\nimport { filterDataByIds, isRowSelectedDisabled } from '../../util/common';\nimport SelectBox from '../select-box';\nimport { emitEvent } from '../../../utils/event';\nimport { Checkbox } from '../../../checkbox';\n\nexport default defineComponent({\n  name: `${prefix}-primary-table-select`,\n  components: { SelectBox, Checkbox },\n  props: {\n    columns: primaryTableProps.columns,\n    data: baseTableProps.data,\n    rowKey: baseTableProps.rowKey,\n    selectedRowKeys: primaryTableProps.selectedRowKeys,\n  },\n  emits: ['select-change'],\n  computed: {\n    reRowKey(): string {\n      return this.rowKey || 'id';\n    },\n    selectColumn(): any {\n      return this.columns.find(({ type }) => ['multiple', 'single'].includes(type)) || {};\n    },\n    canSelectedRows(): Array<Record<string, any>> {\n      return this.data.filter((row, rowIndex): boolean => !this.isDisabled(row, rowIndex));\n    },\n    isSelectedAll(): boolean {\n      return !!(\n        this.canSelectedRows.length &&\n        this.canSelectedRows.every((record) => this.selectedRowKeys.includes(get(record, this.reRowKey)))\n      );\n    },\n    // 判断 indeterminate\n    isSelectedSome(): boolean {\n      return (\n        !this.isSelectedAll &&\n        this.canSelectedRows.some((record) => this.selectedRowKeys.includes(get(record, this.reRowKey)))\n      );\n    },\n  },\n  methods: {\n    isDisabled(row: Record<string, any>, rowIndex: number): boolean {\n      return isRowSelectedDisabled(this.selectColumn, row, rowIndex);\n    },\n    // get\n    getSelectColumns(columns: Array<PrimaryTableCol>): Array<PrimaryTableCol> {\n      return columns.map((c: PrimaryTableCol): PrimaryTableCol => {\n        const isSelection = ['multiple', 'single'].includes(c.type);\n        const isMultiple = c.type === 'multiple';\n        const title = isMultiple ? this.getSelectedHeader() : '';\n        return {\n          ...c,\n          ...(isSelection\n            ? {\n                render: (h, slotProps: Record<string, any>): VNode =>\n                  this.renderSelectCell({\n                    column: c,\n                    ...slotProps,\n                  }),\n              }\n            : {}),\n          ...(isSelection ? { title } : {}),\n        };\n      });\n    },\n    getSelectedHeader() {\n      return () => (\n        <Checkbox\n          checked={this.isSelectedAll}\n          indeterminate={this.isSelectedSome}\n          disabled={!this.canSelectedRows.length}\n          onChange={this.handleSelectAll}\n        />\n      );\n    },\n\n    // render\n    renderSelectCell({ column = {}, row = {}, rowIndex }: Record<string, any>): VNode {\n      const selectBoxProps = {\n        checked: this.selectedRowKeys.includes(get(row, this.reRowKey)),\n        ...column,\n        type: column.type,\n        checkProps: typeof column.checkProps === 'function' ? column.checkProps({ row, rowIndex }) : column.checkProps,\n        disabled: typeof column.disabled === 'function' ? column.disabled({ row, rowIndex }) : column.disabled,\n        rowIndex,\n        onChange: (): void => this.handleSelectChange(row),\n        onClick: (e: MouseEvent) => {\n          // 选中行功能中，点击 checkbo/radio 需阻止事件冒泡，避免触发不必要的 onRowClick\n          e.stopPropagation();\n        },\n      };\n      return <SelectBox {...selectBoxProps} />;\n    },\n\n    // handle：\n    handleSelectChange(record: Record<string, any> = {}): void {\n      let selectedRowKeys = [...this.selectedRowKeys] as Array<string | number>;\n      const { reRowKey } = this;\n      const id = get(record, reRowKey);\n      const selectedRowIndex = selectedRowKeys.indexOf(id);\n      const isSelected = selectedRowIndex !== -1;\n      if (this.selectColumn.type === 'multiple') {\n        isSelected\n          ? selectedRowKeys.splice(selectedRowIndex, 1) // 删除\n          : selectedRowKeys.push(id); // 增加\n      }\n      if (this.selectColumn.type === 'single') {\n        selectedRowKeys = !isSelected ? [id] : [];\n      }\n      emitEvent(this, 'select-change', selectedRowKeys, {\n        selectedRowData: filterDataByIds(this.data, selectedRowKeys, reRowKey),\n        currentRowKey: id,\n        currentRowData: record,\n        type: isSelected ? 'uncheck' : 'check',\n      });\n    },\n    handleSelectAll(): void {\n      const { selectedRowKeys, canSelectedRows, reRowKey } = this;\n      const canSelectedRowKeys = canSelectedRows.map((record) => get(record, reRowKey));\n      const disabledSelectedRowKeys = selectedRowKeys.filter((id) => !canSelectedRowKeys.includes(id));\n      const allIds = (\n        this.isSelectedAll ? [...disabledSelectedRowKeys] : [...disabledSelectedRowKeys, ...canSelectedRowKeys]\n      ) as Array<string | number>;\n      const params = {\n        selectedRowData: filterDataByIds(this.data, allIds, reRowKey),\n        type: this.isSelectedAll ? 'uncheck' : 'check',\n        currentRowKey: 'CHECK_ALL_BOX',\n      };\n      emitEvent(this, 'select-change', allIds, params);\n    },\n  },\n});\n"],"names":["defineComponent","name","prefix","components","SelectBox","Checkbox","props","columns","primaryTableProps","data","baseTableProps","rowKey","selectedRowKeys","emits","computed","reRowKey","selectColumn","find","type","includes","canSelectedRows","filter","row","rowIndex","isDisabled","isSelectedAll","length","every","record","get","isSelectedSome","some","methods","isRowSelectedDisabled","getSelectColumns","map","c","isSelection","isMultiple","title","getSelectedHeader","render","h","slotProps","renderSelectCell","column","handleSelectAll","selectBoxProps","checked","checkProps","disabled","onChange","handleSelectChange","onClick","e","stopPropagation","id","selectedRowIndex","indexOf","isSelected","splice","push","emitEvent","selectedRowData","filterDataByIds","currentRowKey","currentRowData","canSelectedRowKeys","disabledSelectedRowKeys","allIds","params"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AASA,aAAeA,eAAe,CAAC;AAC7BC,EAAAA,IAAI,YAAKC,MAAL,0BADyB;AAE7BC,EAAAA,UAAU,EAAE;AAAEC,IAAAA,SAAS,EAATA,SAAF;AAAaC,IAAAA,QAAQ,EAARA;AAAb,GAFiB;AAG7BC,EAAAA,KAAK,EAAE;AACLC,IAAAA,OAAO,EAAEC,iBAAiB,CAACD,OADtB;AAELE,IAAAA,IAAI,EAAEC,cAAc,CAACD,IAFhB;AAGLE,IAAAA,MAAM,EAAED,cAAc,CAACC,MAHlB;AAILC,IAAAA,eAAe,EAAEJ,iBAAiB,CAACI;AAJ9B,GAHsB;AAS7BC,EAAAA,KAAK,EAAE,CAAC,eAAD,CATsB;AAU7BC,EAAAA,QAAQ,EAAE;AACRC,IAAAA,QADQ,sBACG;AACT,aAAO,KAAKJ,MAAL,IAAe,IAAtB;AACD,KAHO;AAIRK,IAAAA,YAJQ,0BAIO;AACb,aAAO,KAAKT,OAAL,CAAaU,IAAb,CAAkB;AAAA,YAAGC,IAAH,QAAGA,IAAH;AAAA,eAAc,CAAC,UAAD,EAAa,QAAb,EAAuBC,QAAvB,CAAgCD,IAAhC,CAAd;AAAA,OAAlB,KAA0E,EAAjF;AACD,KANO;AAORE,IAAAA,eAPQ,6BAOU;AAAA;;AAChB,aAAO,KAAKX,IAAL,CAAUY,MAAV,CAAiB,UAACC,GAAD,EAAMC,QAAN;AAAA,eAAmB,CAAC,KAAI,CAACC,UAAL,CAAgBF,GAAhB,EAAqBC,QAArB,CAApB;AAAA,OAAjB,CAAP;AACD,KATO;AAURE,IAAAA,aAVQ,2BAUQ;AAAA;;AACd,aAAO,CAAC,EAAE,KAAKL,eAAL,CAAqBM,MAArB,IAA+B,KAAKN,eAAL,CAAqBO,KAArB,CAA2B,UAACC,MAAD;AAAA,eAAY,MAAI,CAAChB,eAAL,CAAqBO,QAArB,CAA8BU,GAAG,CAACD,MAAD,EAAS,MAAI,CAACb,QAAd,CAAjC,CAAZ;AAAA,OAA3B,CAAjC,CAAR;AACD,KAZO;AAaRe,IAAAA,cAbQ,4BAaS;AAAA;;AACf,aAAO,CAAC,KAAKL,aAAN,IAAuB,KAAKL,eAAL,CAAqBW,IAArB,CAA0B,UAACH,MAAD;AAAA,eAAY,MAAI,CAAChB,eAAL,CAAqBO,QAArB,CAA8BU,GAAG,CAACD,MAAD,EAAS,MAAI,CAACb,QAAd,CAAjC,CAAZ;AAAA,OAA1B,CAA9B;AACD;AAfO,GAVmB;AA2B7BiB,EAAAA,OAAO,EAAE;AACPR,IAAAA,UADO,sBACIF,GADJ,EACSC,QADT,EACmB;AACxB,aAAOU,qBAAqB,CAAC,KAAKjB,YAAN,EAAoBM,GAApB,EAAyBC,QAAzB,CAA5B;AACD,KAHM;AAIPW,IAAAA,gBAJO,4BAIU3B,OAJV,EAImB;AAAA;;AACxB,aAAOA,OAAO,CAAC4B,GAAR,CAAY,UAACC,CAAD,EAAO;AACxB,YAAMC,WAAW,GAAG,CAAC,UAAD,EAAa,QAAb,EAAuBlB,QAAvB,CAAgCiB,CAAC,CAAClB,IAAlC,CAApB;AACA,YAAMoB,UAAU,GAAGF,CAAC,CAAClB,IAAF,KAAW,UAA9B;AACA,YAAMqB,KAAK,GAAGD,UAAU,GAAG,MAAI,CAACE,iBAAL,EAAH,GAA8B,EAAtD;AACA,6DACKJ,CADL,GAEKC,WAAW,GAAG;AACfI,UAAAA,MAAM,EAAE,gBAACC,CAAD,EAAIC,SAAJ;AAAA,mBAAkB,MAAI,CAACC,gBAAL;AACxBC,cAAAA,MAAM,EAAET;AADgB,eAErBO,SAFqB,EAAlB;AAAA;AADO,SAAH,GAKV,EAPN,GAQKN,WAAW,GAAG;AAAEE,UAAAA,KAAK,EAALA;AAAF,SAAH,GAAe,EAR/B;AAUD,OAdM,CAAP;AAeD,KApBM;AAqBPC,IAAAA,iBArBO,+BAqBa;AAAA;;AAClB,aAAO;AAAA;AAAA,qBAAyB,MAAI,CAACf,aAA9B;AAAA,2BAA4D,MAAI,CAACK,cAAjE;AAAA,sBAA2F,CAAC,MAAI,CAACV,eAAL,CAAqBM,MAAjH;AAAA,sBAAmI,MAAI,CAACoB;AAAxI;AAAA,OAAP;AACD,KAvBM;AAwBPF,IAAAA,gBAxBO,mCAwB+C;AAAA;;AAAA,+BAAnCC,MAAmC;AAAA,UAAnCA,MAAmC,6BAA1B,EAA0B;AAAA,4BAAtBvB,GAAsB;AAAA,UAAtBA,GAAsB,0BAAhB,EAAgB;AAAA,UAAZC,QAAY,SAAZA,QAAY;;AACpD,UAAMwB,cAAc;AAClBC,QAAAA,OAAO,EAAE,KAAKpC,eAAL,CAAqBO,QAArB,CAA8BU,GAAG,CAACP,GAAD,EAAM,KAAKP,QAAX,CAAjC;AADS,SAEf8B,MAFe;AAGlB3B,QAAAA,IAAI,EAAE2B,MAAM,CAAC3B,IAHK;AAIlB+B,QAAAA,UAAU,EAAE,OAAOJ,MAAM,CAACI,UAAd,KAA6B,UAA7B,GAA0CJ,MAAM,CAACI,UAAP,CAAkB;AAAE3B,UAAAA,GAAG,EAAHA,GAAF;AAAOC,UAAAA,QAAQ,EAARA;AAAP,SAAlB,CAA1C,GAAiFsB,MAAM,CAACI,UAJlF;AAKlBC,QAAAA,QAAQ,EAAE,OAAOL,MAAM,CAACK,QAAd,KAA2B,UAA3B,GAAwCL,MAAM,CAACK,QAAP,CAAgB;AAAE5B,UAAAA,GAAG,EAAHA,GAAF;AAAOC,UAAAA,QAAQ,EAARA;AAAP,SAAhB,CAAxC,GAA6EsB,MAAM,CAACK,QAL5E;AAMlB3B,QAAAA,QAAQ,EAARA,QANkB;AAOlB4B,QAAAA,QAAQ,EAAE;AAAA,iBAAM,MAAI,CAACC,kBAAL,CAAwB9B,GAAxB,CAAN;AAAA,SAPQ;AAQlB+B,QAAAA,OAAO,EAAE,iBAACC,CAAD,EAAO;AACdA,UAAAA,CAAC,CAACC,eAAF;AACD;AAViB,QAApB;;AAYA,oCAAsBR,cAAtB;AACD,KAtCM;AAuCPK,IAAAA,kBAvCO,gCAuCyB;AAAA,UAAbxB,MAAa,uEAAJ,EAAI;;AAC9B,UAAIhB,eAAe,sBAAO,KAAKA,eAAZ,CAAnB;;AACA,UAAQG,QAAR,GAAqB,IAArB,CAAQA,QAAR;AACA,UAAMyC,EAAE,GAAG3B,GAAG,CAACD,MAAD,EAASb,QAAT,CAAd;AACA,UAAM0C,gBAAgB,GAAG7C,eAAe,CAAC8C,OAAhB,CAAwBF,EAAxB,CAAzB;AACA,UAAMG,UAAU,GAAGF,gBAAgB,KAAK,CAAC,CAAzC;;AACA,UAAI,KAAKzC,YAAL,CAAkBE,IAAlB,KAA2B,UAA/B,EAA2C;AACzCyC,QAAAA,UAAU,GAAG/C,eAAe,CAACgD,MAAhB,CAAuBH,gBAAvB,EAAyC,CAAzC,CAAH,GAAiD7C,eAAe,CAACiD,IAAhB,CAAqBL,EAArB,CAA3D;AACD;;AACD,UAAI,KAAKxC,YAAL,CAAkBE,IAAlB,KAA2B,QAA/B,EAAyC;AACvCN,QAAAA,eAAe,GAAG,CAAC+C,UAAD,GAAc,CAACH,EAAD,CAAd,GAAqB,EAAvC;AACD;;AACDM,MAAAA,SAAS,CAAC,IAAD,EAAO,eAAP,EAAwBlD,eAAxB,EAAyC;AAChDmD,QAAAA,eAAe,EAAEC,eAAe,CAAC,KAAKvD,IAAN,EAAYG,eAAZ,EAA6BG,QAA7B,CADgB;AAEhDkD,QAAAA,aAAa,EAAET,EAFiC;AAGhDU,QAAAA,cAAc,EAAEtC,MAHgC;AAIhDV,QAAAA,IAAI,EAAEyC,UAAU,GAAG,SAAH,GAAe;AAJiB,OAAzC,CAAT;AAMD,KAzDM;AA0DPb,IAAAA,eA1DO,6BA0DW;AAChB,UAAQlC,eAAR,GAAuD,IAAvD,CAAQA,eAAR;AAAA,UAAyBQ,eAAzB,GAAuD,IAAvD,CAAyBA,eAAzB;AAAA,UAA0CL,QAA1C,GAAuD,IAAvD,CAA0CA,QAA1C;AACA,UAAMoD,kBAAkB,GAAG/C,eAAe,CAACe,GAAhB,CAAoB,UAACP,MAAD;AAAA,eAAYC,GAAG,CAACD,MAAD,EAASb,QAAT,CAAf;AAAA,OAApB,CAA3B;AACA,UAAMqD,uBAAuB,GAAGxD,eAAe,CAACS,MAAhB,CAAuB,UAACmC,EAAD;AAAA,eAAQ,CAACW,kBAAkB,CAAChD,QAAnB,CAA4BqC,EAA5B,CAAT;AAAA,OAAvB,CAAhC;AACA,UAAMa,MAAM,GAAG,KAAK5C,aAAL,sBAAyB2C,uBAAzB,iCAAwDA,uBAAxD,sBAAoFD,kBAApF,EAAf;AACA,UAAMG,MAAM,GAAG;AACbP,QAAAA,eAAe,EAAEC,eAAe,CAAC,KAAKvD,IAAN,EAAY4D,MAAZ,EAAoBtD,QAApB,CADnB;AAEbG,QAAAA,IAAI,EAAE,KAAKO,aAAL,GAAqB,SAArB,GAAiC,OAF1B;AAGbwC,QAAAA,aAAa,EAAE;AAHF,OAAf;AAKAH,MAAAA,SAAS,CAAC,IAAD,EAAO,eAAP,EAAwBO,MAAxB,EAAgCC,MAAhC,CAAT;AACD;AArEM;AA3BoB,CAAD,CAA9B;;;;"}