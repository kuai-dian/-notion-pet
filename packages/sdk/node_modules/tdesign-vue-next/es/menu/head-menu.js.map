{"version":3,"file":"head-menu.js","sources":["../../src/menu/head-menu.tsx"],"sourcesContent":["import { defineComponent, computed, provide, ref, reactive, watch, onMounted, watchEffect } from 'vue';\nimport { useEmitEvent } from '../hooks/event';\nimport log from '../_common/js/log/log';\nimport { prefix } from '../config';\nimport props from './head-menu-props';\nimport { MenuValue } from './type';\nimport { TdMenuInterface, TdOpenType } from './const';\nimport { Tabs, TabPanel } from '../tabs';\nimport { renderContent, renderTNodeJSX } from '../utils/render-tnode';\nimport VMenu from './v-menu';\n\nexport default defineComponent({\n  name: 'THeadMenu',\n  components: { Tabs, TabPanel },\n  props,\n  emits: ['change', 'expand'],\n  setup(props, ctx) {\n    const emitEvent = useEmitEvent(props, ctx.emit);\n    watchEffect(() => {\n      if (ctx.slots.options) {\n        log.warnOnce('TMenu', '`options` slot is going to be deprecated, please use `operations` for slot instead.');\n      }\n    });\n    const activeValue = ref(props.defaultValue || props.value);\n    const activeValues = ref([]);\n    const expandValues = ref(props.defaultExpanded || props.expanded || []);\n    const theme = computed(() => props.theme);\n    const menuClass = computed(() => [`${prefix}-menu`, `${prefix}-head-menu`, `${prefix}-menu--${props.theme}`]);\n    const mode = ref(props.expandType);\n    const submenu = reactive([]);\n    const vMenu = new VMenu({ isMutex: true, expandValues: expandValues.value });\n\n    provide<TdMenuInterface>('TdMenu', {\n      mode,\n      theme,\n      vMenu,\n      isHead: true,\n      expandValues,\n      activeValue,\n      activeValues,\n      select: (value: MenuValue) => {\n        emitEvent('change', value);\n      },\n      open: (value: MenuValue, type: TdOpenType) => {\n        const expanded = [...expandValues.value];\n        const index = expanded.indexOf(value);\n\n        if (mode.value === 'popup') {\n          if (type === 'add') {\n            if (index === -1) {\n              // 可能初始expanded里包含了该value\n              expanded.push(value);\n            }\n          } else if (type === 'remove') {\n            expanded.splice(index, 1);\n          }\n        } else {\n          expanded.splice(0, 1);\n          if (index === -1) {\n            expanded.push(value);\n          }\n        }\n        emitEvent('expand', expanded);\n      },\n    });\n\n    // methods\n    const handleTabChange = (value: MenuValue) => {\n      emitEvent('change', value);\n    };\n\n    const handleSubmenuExpand = (value: MenuValue) => {\n      const ans = vMenu.getChild(value);\n      submenu.length = 0;\n      submenu.push(...ans);\n    };\n\n    // watch\n    watch(\n      () => props.expanded,\n      (value) => {\n        expandValues.value = value;\n        if (mode.value === 'normal') {\n          handleSubmenuExpand(value[0]);\n        }\n      },\n    );\n    const updateActiveValues = (value: MenuValue) => {\n      activeValue.value = value;\n      activeValues.value = vMenu.select(value);\n    };\n    watch(() => props.value, updateActiveValues);\n    watch(() => props.defaultValue, updateActiveValues);\n    watch(\n      () => props.expandType,\n      (value) => {\n        mode.value = value;\n      },\n    );\n\n    onMounted(() => {\n      activeValues.value = vMenu.select(activeValue.value);\n      if (expandValues.value?.length > 0) {\n        handleSubmenuExpand(expandValues.value[0]); // 顶部导航只能同时展开一个子菜单\n      }\n    });\n\n    return {\n      mode,\n      menuClass,\n      expandValues,\n      activeValue,\n      activeValues,\n      submenu,\n      handleTabChange,\n    };\n  },\n  methods: {\n    renderNormalSubmenu() {\n      if (this.submenu.length === 0) return null;\n      return (\n        <ul class={[`${prefix}-head-menu__submenu`, `${prefix}-submenu`]}>\n          {\n            <t-tabs value={this.activeValue} onChange={this.handleTabChange}>\n              {this.submenu.map((item) => (\n                <t-tab-panel value={item.value} label={item.vnode()[0]?.children} />\n              ))}\n            </t-tabs>\n          }\n        </ul>\n      );\n    },\n  },\n  render() {\n    const operations = renderContent(this, 'operations', 'options');\n    const logo = renderTNodeJSX(this, 'logo');\n    return (\n      <div class={this.menuClass}>\n        <div class={`${prefix}-head-menu__inner`}>\n          {logo && <div class={`${prefix}-menu__logo`}>{logo}</div>}\n          <ul class={`${prefix}-menu`}>{renderContent(this, 'default', 'content')}</ul>\n          {operations && <div class={`${prefix}-menu__operations`}>{operations}</div>}\n        </div>\n        {this.mode === 'normal' && this.renderNormalSubmenu()}\n      </div>\n    );\n  },\n});\n"],"names":["defineComponent","name","components","Tabs","TabPanel","props","emits","setup","props2","ctx","emitEvent","useEmitEvent","emit","watchEffect","slots","options","log","warnOnce","activeValue","ref","defaultValue","value","activeValues","expandValues","defaultExpanded","expanded","theme","computed","menuClass","prefix","mode","expandType","submenu","reactive","vMenu","VMenu","isMutex","provide","isHead","select","open","type","index","indexOf","push","splice","handleTabChange","handleSubmenuExpand","ans","getChild","length","watch","updateActiveValues","onMounted","methods","renderNormalSubmenu","map","item","vnode","children","render","operations","renderContent","logo","renderTNodeJSX"],"mappings":"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"}