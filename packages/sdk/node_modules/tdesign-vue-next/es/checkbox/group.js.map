{"version":3,"file":"group.js","sources":["../../src/checkbox/group.tsx"],"sourcesContent":["import { VNode, defineComponent, h } from 'vue';\nimport intersection from 'lodash/intersection';\nimport { prefix } from '../config';\nimport Checkbox from './checkbox';\nimport checkboxGroupProps from './checkbox-group-props';\nimport { emitEvent } from '../utils/event';\nimport { CheckboxOptionObj, TdCheckboxProps, CheckboxGroupValue, TdCheckboxGroupProps } from './type';\n\nconst name = `${prefix}-checkbox-group`;\n\nexport default defineComponent({\n  name: 'TCheckboxGroup',\n  components: {\n    Checkbox,\n  },\n  provide(): { checkboxGroup: any } {\n    return {\n      checkboxGroup: this,\n    };\n  },\n  props: { ...checkboxGroupProps },\n  emits: ['change'],\n  data() {\n    return {\n      checkedMap: {},\n      optionList: [] as Array<CheckboxOptionObj>,\n    };\n  },\n  computed: {\n    values(): string {\n      if (this.value instanceof Array) {\n        return this.value.join();\n      }\n      return '';\n    },\n    intersectionLen(): number {\n      const values = this.optionList.map((item) => item.value);\n      if (this.value instanceof Array) {\n        const n = intersection(this.value, values);\n        return n.length;\n      }\n      return 0;\n    },\n    isCheckAll(): boolean {\n      if (this.value instanceof Array && this.value.length !== this.optionList.length - 1) {\n        return false;\n      }\n      return this.intersectionLen === this.optionList.length - 1;\n    },\n    indeterminate(): boolean {\n      return !this.isCheckAll && this.intersectionLen < this.optionList.length && this.intersectionLen !== 0;\n    },\n    maxExceeded(): boolean {\n      return this.max !== undefined && this.value.length === this.max;\n    },\n  },\n\n  watch: {\n    values: {\n      immediate: true,\n      handler() {\n        if (this.value instanceof Array) {\n          const map = {};\n          this.value.forEach((item: string | number) => {\n            map[item] = true;\n          });\n          this.checkedMap = map;\n        }\n      },\n    },\n    options: {\n      immediate: true,\n      handler() {\n        if (!this.options) return [];\n        this.optionList = this.options.map((item) => {\n          let r: CheckboxOptionObj = {};\n          if (typeof item !== 'object') {\n            r = { label: String(item), value: item };\n          } else {\n            r = { ...item };\n            r.disabled = r.disabled === undefined ? this.disabled : r.disabled;\n          }\n          return r;\n        });\n      },\n    },\n  },\n\n  methods: {\n    onCheckedChange(p: { checked: boolean; checkAll: boolean; e: Event; option: TdCheckboxProps }) {\n      const { checked, checkAll, e } = p;\n      if (checkAll) {\n        this.onCheckAllChange(checked, { e });\n      } else {\n        this.handleCheckboxChange(p);\n      }\n    },\n    getOptionListBySlots(nodes: VNode[]) {\n      const arr: Array<CheckboxOptionObj> = [];\n      nodes?.forEach((node) => {\n        const option = node.props as CheckboxOptionObj;\n        if (option?.['check-all'] === '' || option?.['check-all'] === true) {\n          option.checkAll = true;\n        }\n        option && arr.push(option);\n      });\n      return arr;\n    },\n    renderLabel(option: CheckboxOptionObj) {\n      if (typeof option.label === 'function') {\n        return option.label(h);\n      }\n      return option.label;\n    },\n    emitChange(val: CheckboxGroupValue, e?: Event) {\n      emitEvent<Parameters<TdCheckboxGroupProps['onChange']>>(this, 'change', val, { e });\n    },\n    handleCheckboxChange(data: { checked: boolean; e: Event; option: TdCheckboxProps }) {\n      const currentValue = data.option.value;\n      if (this.value instanceof Array) {\n        const val = [...this.value];\n        if (data.checked) {\n          val.push(currentValue);\n        } else {\n          const i = val.indexOf(currentValue);\n          val.splice(i, 1);\n        }\n        this.emitChange(val, data.e);\n      } else {\n        console.warn(`TDesign CheckboxGroup Warn: \\`value\\` must be an array, instead of ${typeof this.value}`);\n      }\n    },\n    getAllCheckboxValue(): CheckboxGroupValue {\n      const val = new Set<TdCheckboxProps['value']>();\n      for (let i = 0, len = this.optionList.length; i < len; i++) {\n        const item = this.optionList[i];\n        if (item.checkAll) continue;\n        val.add(item.value);\n        if (this.maxExceeded) break;\n      }\n      return [...val];\n    },\n    onCheckAllChange(checked: boolean, context: { e: Event; source?: 't-checkbox' }) {\n      const value: CheckboxGroupValue = checked ? this.getAllCheckboxValue() : [];\n      this.emitChange(value, context.e);\n    },\n  },\n\n  render(): VNode {\n    let children = null;\n    if (this.options?.length) {\n      children = this.optionList?.map((option) => (\n        <Checkbox key={option.value} {...option} checked={this.checkedMap[option.value]}>\n          {this.renderLabel(option)}\n        </Checkbox>\n      ));\n    } else {\n      const nodes = this.$slots.default && this.$slots.default(null);\n      this.optionList = this.getOptionListBySlots(nodes);\n      children = nodes;\n    }\n    return <div class={name}>{children}</div>;\n  },\n});\n"],"names":["name","prefix","defineComponent","components","Checkbox","provide","checkboxGroup","props","checkboxGroupProps","emits","data","checkedMap","optionList","computed","values","value","Array","join","intersectionLen","map","item","n","intersection","length","isCheckAll","indeterminate","maxExceeded","max","watch","immediate","handler","forEach","options","r","label","String","disabled","methods","onCheckedChange","p","checked","checkAll","e","onCheckAllChange","handleCheckboxChange","getOptionListBySlots","nodes","arr","node","option","push","renderLabel","h","emitChange","val","emitEvent","currentValue","i","indexOf","splice","console","warn","getAllCheckboxValue","Set","len","add","context","render","children","$slots"],"mappings":"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"}