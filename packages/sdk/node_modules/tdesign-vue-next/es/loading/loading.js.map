{"version":3,"file":"loading.js","sources":["../../src/loading/loading.tsx"],"sourcesContent":["import { defineComponent, ref, computed, watch, onMounted } from 'vue';\nimport GradientIcon from './icon/gradient';\nimport { prefix } from '../config';\nimport { SIZE_CLASSNAMES } from '../utils/classnames';\nimport { addClass, removeClass } from '../utils/dom';\nimport { renderTNodeJSX, renderContent } from '../utils/render-tnode';\nimport TransferDom from '../utils/transfer-dom';\nimport props from './props';\nimport { Styles } from '../common';\n\nconst name = `${prefix}-loading`;\nconst centerClass = `${prefix}-loading--center`;\nconst fullscreenClass = `${prefix}-loading__fullscreen`;\nconst lockClass = `${prefix}-loading--lock`;\nconst overlayClass = `${prefix}-loading__overlay`;\nconst relativeClass = `${prefix}-loading__parent`;\nconst fullClass = `${prefix}-loading--full`;\nconst inheritColorClass = `${prefix}-loading--inherit-color`;\n\nexport default defineComponent({\n  name: 'TLoading',\n  directives: {\n    TransferDom,\n  },\n  props,\n  setup(props, { slots }) {\n    const delayShowLoading = ref(false);\n\n    const countDelay = () => {\n      delayShowLoading.value = false;\n      const timer = setTimeout(() => {\n        delayShowLoading.value = true;\n        clearTimeout(timer);\n      }, props.delay);\n    };\n\n    // 延时计时是否完成。用于控制延时计时结束前不能显示加载态\n    const delayCounted = computed(() => Boolean(!props.delay || (props.delay && delayShowLoading.value)));\n\n    // loading style\n    const styles = computed(() => {\n      const styles: Styles = {};\n      if (props.zIndex !== undefined) {\n        styles.zIndex = props.zIndex;\n      }\n      if (!['small', 'medium', 'large'].includes(props.size)) {\n        styles['font-size'] = props.size;\n      }\n      return styles;\n    });\n\n    const hasContent = computed(() => Boolean(props.default || slots.default || props.content || slots.content));\n    const lockFullscreen = computed(() => props.preventScrollThrough && props.fullscreen);\n    const showText = computed(() => Boolean(props.text || slots.text));\n    const showWrapLoading = computed(() => hasContent.value && props.loading && delayCounted.value);\n    const showNormalLoading = computed(() => !hasContent.value && props.loading && delayCounted.value);\n\n    const classes = computed(() => {\n      const baseClasses = [centerClass, SIZE_CLASSNAMES[props.size], { [inheritColorClass]: props.inheritColor }];\n      const fullScreenClasses = [name, fullscreenClass, centerClass, overlayClass];\n\n      return {\n        baseClasses,\n        attachClasses: baseClasses.concat([name, fullClass, { [overlayClass]: props.showOverlay }]),\n        withContentClasses: baseClasses.concat([\n          name,\n          fullClass,\n          {\n            [overlayClass]: props.showOverlay,\n          },\n        ]),\n        fullScreenClasses,\n        normalClasses: baseClasses.concat([name]),\n      };\n    });\n\n    const loadingRef = computed(() => props.loading);\n\n    watch([loadingRef], ([isLoading]) => {\n      if (isLoading) {\n        countDelay();\n        lockFullscreen.value && addClass(document.body, lockClass);\n      } else {\n        lockFullscreen.value && removeClass(document.body, lockClass);\n      }\n    });\n\n    onMounted(() => {\n      props.delay && countDelay();\n    });\n\n    return {\n      delayShowLoading,\n      styles,\n      showText,\n      hasContent,\n      classes,\n      lockFullscreen,\n      showWrapLoading,\n      showNormalLoading,\n    };\n  },\n  render() {\n    const { fullScreenClasses, baseClasses, withContentClasses, attachClasses, normalClasses } = this.classes;\n\n    const defaultIndicator = <GradientIcon size={this.size} />;\n    const indicator = this.loading && renderTNodeJSX(this, 'indicator', defaultIndicator);\n    const text = this.showText && <div class={`${prefix}-loading__text`}>{renderTNodeJSX(this, 'text')}</div>;\n\n    // full screen loading\n    if (this.fullscreen) {\n      if (!this.loading) return null;\n      return (\n        <div class={fullScreenClasses} style={this.styles} v-transfer-dom={this.attach}>\n          <div class={baseClasses}>\n            {indicator}\n            {text}\n          </div>\n        </div>\n      );\n    }\n\n    // Loading is wrapping a HTMLElement.\n    if (this.hasContent) {\n      return (\n        <div class={relativeClass}>\n          {renderContent(this, 'default', 'content')}\n          {this.showWrapLoading && (\n            <div class={withContentClasses} style={this.styles}>\n              {indicator}\n              {text}\n            </div>\n          )}\n        </div>\n      );\n    }\n\n    // transfer parent node\n    if (this.attach) {\n      return (\n        <div class={attachClasses} style={this.styles} v-transfer-dom={this.attach}>\n          {indicator}\n          {text}\n        </div>\n      );\n    }\n\n    // Normal Loading without overlay or content\n    return (\n      <div class={normalClasses} style={this.styles}>\n        {indicator}\n        {text}\n      </div>\n    );\n  },\n});\n"],"names":["name","prefix","centerClass","fullscreenClass","lockClass","overlayClass","relativeClass","fullClass","inheritColorClass","defineComponent","directives","TransferDom","props","setup","props2","slots","delayShowLoading","ref","countDelay","value","timer","setTimeout","clearTimeout","delay","delayCounted","computed","Boolean","styles","styles2","zIndex","includes","size","hasContent","content","lockFullscreen","preventScrollThrough","fullscreen","showText","text","showWrapLoading","loading","showNormalLoading","classes","baseClasses","SIZE_CLASSNAMES","inheritColor","fullScreenClasses","attachClasses","concat","showOverlay","withContentClasses","normalClasses","loadingRef","watch","isLoading","addClass","document","body","removeClass","onMounted","render","defaultIndicator","indicator","renderTNodeJSX","attach","renderContent"],"mappings":"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"}