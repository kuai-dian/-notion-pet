{"version":3,"file":"plugin.js","sources":["../../src/loading/plugin.tsx"],"sourcesContent":["import { App, Plugin, createApp, defineComponent, h, reactive } from 'vue';\nimport LoadingComponent from './loading';\nimport { prefix } from '../config';\nimport { getAttach, removeClass } from '../utils/dom';\nimport { TdLoadingProps, LoadingInstance, LoadingMethod } from './type';\n\nconst lockClass = `${prefix}-loading--lock`;\n\nlet fullScreenLoadingInstance: LoadingInstance = null;\n\nfunction createLoading(props: TdLoadingProps): LoadingInstance {\n  const component = defineComponent({\n    setup() {\n      const loadingOptions = reactive(props);\n      return {\n        loadingOptions,\n      };\n    },\n    render() {\n      return h(LoadingComponent, {\n        ...this.loadingOptions,\n      });\n    },\n  });\n\n  const attach = getAttach(props.attach);\n\n  const loading = createApp(component).mount(document.createElement('div'));\n\n  if (attach) {\n    attach.appendChild(loading.$el);\n  } else {\n    console.error('attach is not exist');\n  }\n\n  const loadingInstance: LoadingInstance = {\n    hide: () => {\n      loading.loading = false;\n      loading.$el.parentNode.removeChild(loading.$el);\n    },\n  };\n  return loadingInstance;\n}\n\nfunction produceLoading(props: boolean | TdLoadingProps): LoadingInstance {\n  // 全屏加载\n  // 全屏加载\n  if (props === true) {\n    fullScreenLoadingInstance = createLoading({\n      fullscreen: true,\n      loading: true,\n      attach: 'body',\n    });\n    return fullScreenLoadingInstance;\n  }\n  removeClass(document.body, lockClass);\n\n  if (props === false) {\n    // 销毁全屏实例\n    removeClass(document.body, lockClass);\n    fullScreenLoadingInstance.hide();\n    fullScreenLoadingInstance = null;\n    return;\n  }\n  return createLoading(props);\n}\n\nexport type LoadingPluginType = Plugin & LoadingMethod;\n\nconst LoadingPlugin: LoadingPluginType = produceLoading as LoadingPluginType;\n\nLoadingPlugin.install = (app: App) => {\n  // eslint-disable-next-line no-param-reassign\n  app.config.globalProperties.$loading = produceLoading;\n};\n\nexport default LoadingPlugin;\n"],"names":["lockClass","prefix","fullScreenLoadingInstance","createLoading","props","component","defineComponent","setup","loadingOptions","reactive","render","h","LoadingComponent","attach","getAttach","loading","createApp","mount","document","createElement","appendChild","$el","console","error","loadingInstance","hide","parentNode","removeChild","produceLoading","fullscreen","removeClass","body","LoadingPlugin","install","app","config","globalProperties","$loading"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAIA,IAAMA,SAAS,aAAMC,MAAN,mBAAf;AACA,IAAIC,yBAAyB,GAAG,IAAhC;;AACA,SAASC,aAAT,CAAuBC,KAAvB,EAA8B;AAC5B,MAAMC,SAAS,GAAGC,eAAe,CAAC;AAChCC,IAAAA,KADgC,mBACxB;AACN,UAAMC,cAAc,GAAGC,QAAQ,CAACL,KAAD,CAA/B;AACA,aAAO;AACLI,QAAAA,cAAc,EAAdA;AADK,OAAP;AAGD,KAN+B;AAOhCE,IAAAA,MAPgC,oBAOvB;AACP,aAAOC,CAAC,CAACC,QAAD,oBACH,KAAKJ,cADF,EAAR;AAGD;AAX+B,GAAD,CAAjC;AAaA,MAAMK,MAAM,GAAGC,SAAS,CAACV,KAAK,CAACS,MAAP,CAAxB;AACA,MAAME,OAAO,GAAGC,SAAS,CAACX,SAAD,CAAT,CAAqBY,KAArB,CAA2BC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAA3B,CAAhB;;AACA,MAAIN,MAAJ,EAAY;AACVA,IAAAA,MAAM,CAACO,WAAP,CAAmBL,OAAO,CAACM,GAA3B;AACD,GAFD,MAEO;AACLC,IAAAA,OAAO,CAACC,KAAR,CAAc,qBAAd;AACD;;AACD,MAAMC,eAAe,GAAG;AACtBC,IAAAA,IAAI,EAAE,gBAAM;AACVV,MAAAA,OAAO,CAACA,OAAR,GAAkB,KAAlB;AACAA,MAAAA,OAAO,CAACM,GAAR,CAAYK,UAAZ,CAAuBC,WAAvB,CAAmCZ,OAAO,CAACM,GAA3C;AACD;AAJqB,GAAxB;AAMA,SAAOG,eAAP;AACD;;AACD,SAASI,cAAT,CAAwBxB,KAAxB,EAA+B;AAC7B,MAAIA,KAAK,KAAK,IAAd,EAAoB;AAClBF,IAAAA,yBAAyB,GAAGC,aAAa,CAAC;AACxC0B,MAAAA,UAAU,EAAE,IAD4B;AAExCd,MAAAA,OAAO,EAAE,IAF+B;AAGxCF,MAAAA,MAAM,EAAE;AAHgC,KAAD,CAAzC;AAKA,WAAOX,yBAAP;AACD;;AACD4B,EAAAA,WAAW,CAACZ,QAAQ,CAACa,IAAV,EAAgB/B,SAAhB,CAAX;;AACA,MAAII,KAAK,KAAK,KAAd,EAAqB;AACnB0B,IAAAA,WAAW,CAACZ,QAAQ,CAACa,IAAV,EAAgB/B,SAAhB,CAAX;AACAE,IAAAA,yBAAyB,CAACuB,IAA1B;AACAvB,IAAAA,yBAAyB,GAAG,IAA5B;AACA;AACD;;AACD,SAAOC,aAAa,CAACC,KAAD,CAApB;AACD;;IACK4B,aAAa,GAAGJ;;AACtBI,aAAa,CAACC,OAAd,GAAwB,UAACC,GAAD,EAAS;AAC/BA,EAAAA,GAAG,CAACC,MAAJ,CAAWC,gBAAX,CAA4BC,QAA5B,GAAuCT,cAAvC;AACD,CAFD;;;;"}