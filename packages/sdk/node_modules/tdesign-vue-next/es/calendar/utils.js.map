{"version":3,"file":"utils.js","sources":["../../src/calendar/utils.ts"],"sourcesContent":["import dayjs from 'dayjs';\n\nimport { CalendarCell } from './type';\n\n// 组件的一些常量\nimport { FIRST_MONTH_OF_YEAR, LAST_MONTH_OF_YEAR, DAY_CN_MAP } from './const';\n\n/**\n * 获取一个日期是周几（1~7）\n */\nconst getDay = (dt: Date): number => {\n  let day = dayjs(dt).day();\n  if (day === 0) {\n    day = 7;\n  }\n  return day;\n};\n\n/**\n * 获取星期的中文\n * @param num 星期（1~7）\n */\nconst getDayCn = (num: number): string => {\n  let re = '';\n  const numStr = num.toString();\n  if (numStr in DAY_CN_MAP) {\n    re = DAY_CN_MAP[numStr];\n  }\n  return re;\n};\n\n/**\n * 获取一个日期在日历上的列下标\n * @param firstDayOfWeek 周起始日（1~7）\n * @param dt\n */\nconst getCellColIndex = (firstDayOfWeek: number, dt: Date): number => {\n  let re = 0;\n  const day = getDay(dt);\n  if (day >= firstDayOfWeek) {\n    re = day - firstDayOfWeek;\n  } else {\n    re = 7 - firstDayOfWeek + day;\n  }\n  return re;\n};\n/**\n * 返回日期+天数（天数可以负数）\n */\nconst addDate = (dt: Date, days: number) => {\n  const d = new Date(dt);\n  d.setDate(d.getDate() + days);\n  return d;\n};\n\n/**\n * 创建月历单元格数据\n * @param year 月历年份\n * @param curDate 当前日期\n */\nconst createYearCellsData = (year: number, curDate: dayjs.Dayjs, format: string): CalendarCell[] => {\n  const monthsArr: CalendarCell[] = [];\n  const isCurYear = curDate.year() === year;\n  for (let num = FIRST_MONTH_OF_YEAR; num <= LAST_MONTH_OF_YEAR; num++) {\n    const date = new Date(year, num - 1);\n    const curDateMon = parseInt(curDate.format('M'), 10);\n    const isCurrent = isCurYear && curDateMon === num;\n    monthsArr.push({\n      mode: 'year',\n      isCurrent,\n      date,\n      formattedDate: dayjs(date).format(format),\n      filterDate: null,\n      formattedFilterDate: null,\n      isShowWeekend: true,\n    });\n  }\n\n  return monthsArr;\n};\n\n/**\n * 创建日历单元格数据\n * @param year 日历年份\n * @param month 日历月份\n * @param firstDayOfWeek 周起始日（1~7）\n * @param curDate 当前日期\n * @param format 日期格式\n */\nconst createMonthCellsData = (\n  year: number,\n  month: number,\n  firstDayOfWeek: number,\n  curDate: dayjs.Dayjs,\n  format: string,\n): CalendarCell[][] => {\n  const daysArr: CalendarCell[][] = [];\n  // 当前月份的开始日期\n  const begin: Date = dayjs(`${year}-${month}`).startOf('month').toDate();\n  // 当前月份的结束日期\n  const end: Date = dayjs(`${year}-${month}`).endOf('month').toDate();\n  const days = end.getDate();\n\n  const beginDateColIndex = getCellColIndex(firstDayOfWeek, begin);\n  let arr = [];\n  let num = 1;\n\n  const createCellData = (belongTo: number, isCurrent: boolean, date: Date, weekOrder: number): CalendarCell => {\n    const day = getDay(date);\n    return {\n      mode: 'month',\n      belongTo,\n      isCurrent,\n      day,\n      weekOrder,\n      date,\n      formattedDate: dayjs(date).format(format),\n      filterDate: null,\n      formattedFilterDate: null,\n      isShowWeekend: true,\n    };\n  };\n\n  // 添加上个月中和当前月第一天同一周的日期\n  for (let i = 0; i < beginDateColIndex; i++) {\n    const date = addDate(begin, i - beginDateColIndex);\n    arr.push(createCellData(-1, false, date, num));\n    if (arr.length === 7) {\n      daysArr.push(arr);\n      arr = [];\n      num += 1;\n    }\n  }\n  for (let i = 0; i < days; i++) {\n    const date = addDate(begin, i);\n    arr.push(createCellData(0, curDate.isSame(dayjs(date)), date, num));\n    if (arr.length === 7) {\n      daysArr.push(arr);\n      arr = [];\n      num += 1;\n    }\n  }\n  // 添加下个月中和当前月最后同一周的日期\n  if (arr.length) {\n    const nextMonthCellNum = 7 - arr.length;\n    for (let i = 0; i < nextMonthCellNum; i++) {\n      const date = addDate(end, i + 1);\n      arr.push(createCellData(1, false, date, num));\n    }\n    daysArr.push(arr);\n  }\n\n  return daysArr;\n};\n\nexport { getDayCn, getCellColIndex, addDate, createYearCellsData, createMonthCellsData };\n"],"names":["getDay","dt","day","dayjs","getDayCn","num","re","numStr","toString","DAY_CN_MAP","getCellColIndex","firstDayOfWeek","addDate","days","d","Date","setDate","getDate","createYearCellsData","year","curDate","format","monthsArr","isCurYear","FIRST_MONTH_OF_YEAR","LAST_MONTH_OF_YEAR","date","curDateMon","parseInt","isCurrent","push","mode","formattedDate","filterDate","formattedFilterDate","isShowWeekend","createMonthCellsData","month","daysArr","begin","startOf","toDate","end","endOf","beginDateColIndex","arr","createCellData","belongTo","weekOrder","i","length","isSame","nextMonthCellNum"],"mappings":"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"}