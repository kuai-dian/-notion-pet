{"version":3,"file":"dragger.js","sources":["../../src/upload/dragger.tsx"],"sourcesContent":["import { defineComponent, PropType, VNode } from 'vue';\nimport { CheckCircleFilledIcon, ErrorCircleFilledIcon } from 'tdesign-icons-vue-next';\nimport { prefix } from '../config';\nimport { UploadFile } from './type';\nimport TLoading from '../loading';\nimport TButton from '../button';\nimport { returnFileSize, getCurrentDate, abridgeName, UPLOAD_NAME } from './util';\nimport { ClassName } from '../common';\n\nconst name = `${prefix}-upload-dragger`;\n\nexport default defineComponent({\n  name,\n\n  components: {\n    TButton,\n    TLoading,\n    CheckCircleFilledIcon,\n    ErrorCircleFilledIcon,\n  },\n\n  props: {\n    file: {\n      type: Object as PropType<UploadFile>,\n    },\n    loadingFile: {\n      type: Object as PropType<UploadFile>,\n    },\n    display: {\n      type: String as PropType<'file' | 'file-input' | 'image' | 'custom'>,\n      validator(val: string) {\n        return ['file', 'file-input', 'image', 'custom'].includes(val);\n      },\n    },\n    cancel: Function as PropType<(e: MouseEvent) => void>,\n    trigger: Function as PropType<(e: MouseEvent) => void>,\n    remove: Function as PropType<(e: MouseEvent) => void>,\n    upload: Function as PropType<(file: UploadFile, e: MouseEvent) => void>,\n    autoUpload: Boolean,\n  },\n  emits: ['change', 'dragleave', 'dragenter'],\n\n  data() {\n    return {\n      target: null,\n      dragActive: false,\n    };\n  },\n  computed: {\n    isImage(): boolean {\n      return this.display === 'image';\n    },\n    imageUrl(): string {\n      return (this.loadingFile && this.loadingFile.url) || (this.file && this.file.url);\n    },\n    percent(): number {\n      return this.loadingFile && this.loadingFile.percent;\n    },\n    inputName(): string {\n      return (this.loadingFile && this.loadingFile.name) || (this.file && this.file.name);\n    },\n    classes(): ClassName {\n      return [\n        `${UPLOAD_NAME}__dragger`,\n        { [`${UPLOAD_NAME}__dragger-center`]: !this.loadingFile && !this.file },\n        { [`${UPLOAD_NAME}__dragger-error`]: this.loadingFile && this.loadingFile.status === 'fail' },\n      ];\n    },\n    size(): number {\n      return (this.loadingFile && this.loadingFile.size) || (this.file && this.file.size);\n    },\n    // 上传失败或者上传成功会显示\n    showResultOperate(): boolean {\n      return Boolean(!this.loadingFile && this.file?.name) || ['success', 'fail'].includes(this.loadingFile?.status);\n    },\n  },\n\n  methods: {\n    handleDrop(event: DragEvent) {\n      event.preventDefault();\n      this.$emit('change', event.dataTransfer.files);\n      this.$emit('dragleave', event);\n      this.dragActive = false;\n    },\n\n    handleDragenter(event: DragEvent) {\n      this.target = event.target;\n      event.preventDefault();\n      this.$emit('dragenter', event);\n      this.dragActive = true;\n    },\n\n    handleDragleave(event: DragEvent) {\n      if (this.target !== event.target) return;\n      event.preventDefault();\n      this.$emit('dragleave', event);\n      this.dragActive = false;\n    },\n\n    handleDragover(event: DragEvent) {\n      event.preventDefault();\n    },\n\n    renderDefaultDragElement(): VNode {\n      const unActiveElement = (\n        <div>\n          <span class={`${prefix}-upload--highlight`}>点击上传</span>\n          <span>&nbsp;&nbsp;/&nbsp;&nbsp;拖拽到此区域</span>\n        </div>\n      );\n      const activeElement = <div>释放鼠标</div>;\n      return this.dragActive ? activeElement : unActiveElement;\n    },\n\n    renderImage() {\n      return <div class={`${UPLOAD_NAME}__dragger-img-wrap`}>{this.imageUrl && <img src={this.imageUrl}></img>}</div>;\n    },\n\n    renderUploading() {\n      if (this.loadingFile.status === 'fail') {\n        return <ErrorCircleFilledIcon />;\n      }\n      if (this.loadingFile.status === 'progress') {\n        return (\n          <div class={`${UPLOAD_NAME}__single-progress`}>\n            <TLoading />\n            <span class={`${UPLOAD_NAME}__single-percent`}>{Math.min(this.loadingFile.percent, 99)}%</span>\n          </div>\n        );\n      }\n    },\n\n    reupload(e: MouseEvent) {\n      this.remove(e);\n      this.trigger(e);\n    },\n\n    renderProgress() {\n      return (\n        <div class={`${UPLOAD_NAME}__dragger-progress`}>\n          {this.isImage && this.renderImage()}\n          <div class={`${UPLOAD_NAME}__dragger-progress-info`}>\n            <div class={`${UPLOAD_NAME}__dragger-text`}>\n              <span class={`${UPLOAD_NAME}__single-name`}>{abridgeName(this.inputName)}</span>\n              {this.loadingFile && this.renderUploading()}\n              {!this.loadingFile && !!this.file && <CheckCircleFilledIcon />}\n            </div>\n            <small class={`${prefix}-size-s`}>文件大小：{returnFileSize(this.size)}</small>\n            <small class={`${prefix}-size-s`}>上传日期：{getCurrentDate()}</small>\n            <div class={`${UPLOAD_NAME}__dragger-btns`}>\n              {['progress', 'waiting'].includes(this.loadingFile?.status) && (\n                <TButton\n                  theme=\"primary\"\n                  variant=\"text\"\n                  class={`${UPLOAD_NAME}__dragger-progress-cancel`}\n                  onClick={this.cancel}\n                >\n                  取消上传\n                </TButton>\n              )}\n              {!this.autoUpload && this.loadingFile?.status === 'waiting' && (\n                <TButton\n                  theme=\"primary\"\n                  variant=\"text\"\n                  onClick={(e: MouseEvent) => this.upload({ ...this.loadingFile }, e)}\n                >\n                  开始上传\n                </TButton>\n              )}\n            </div>\n            {this.showResultOperate && (\n              <div class={`${UPLOAD_NAME}__dragger-btns`}>\n                <t-button\n                  theme=\"primary\"\n                  variant=\"text\"\n                  class={`${UPLOAD_NAME}__dragger-progress-cancel`}\n                  onClick={this.reupload}\n                >\n                  重新上传\n                </t-button>\n                <t-button theme=\"primary\" variant=\"text\" onClick={this.remove}>\n                  删除\n                </t-button>\n              </div>\n            )}\n          </div>\n        </div>\n      );\n    },\n  },\n\n  render(): VNode {\n    let content = null;\n    if ((this.loadingFile || this.file) && this.display !== 'custom') {\n      content = this.renderProgress();\n    } else {\n      content = (\n        <div class={`${UPLOAD_NAME}__trigger`} onClick={this.trigger}>\n          {(this.$slots.default && this.$slots.default(null)) || this.renderDefaultDragElement()}\n        </div>\n      );\n    }\n    return (\n      <div\n        class={this.classes}\n        onDrop={this.handleDrop}\n        onDragenter={this.handleDragenter}\n        onDragover={this.handleDragover}\n        onDragleave={this.handleDragleave}\n      >\n        {content}\n      </div>\n    );\n  },\n});\n"],"names":["name","prefix","defineComponent","components","TButton","TLoading","CheckCircleFilledIcon","ErrorCircleFilledIcon","props","file","type","Object","loadingFile","display","String","validator","val","includes","cancel","Function","trigger","remove","upload","autoUpload","Boolean","emits","data","target","dragActive","computed","isImage","imageUrl","url","percent","inputName","classes","UPLOAD_NAME","status","size","showResultOperate","methods","handleDrop","event","preventDefault","$emit","dataTransfer","files","handleDragenter","handleDragleave","handleDragover","renderDefaultDragElement","unActiveElement","activeElement","renderImage","renderUploading","Math","min","reupload","e","renderProgress","abridgeName","returnFileSize","getCurrentDate","render","content","$slots"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAMA,IAAMA,IAAI,aAAMC,MAAN,oBAAV;AACA,cAAeC,eAAe,CAAC;AAC7BF,EAAAA,IAAI,EAAJA,IAD6B;AAE7BG,EAAAA,UAAU,EAAE;AACVC,IAAAA,OAAO,EAAPA,MADU;AAEVC,IAAAA,QAAQ,EAARA,OAFU;AAGVC,IAAAA,qBAAqB,EAArBA,qBAHU;AAIVC,IAAAA,qBAAqB,EAArBA;AAJU,GAFiB;AAQ7BC,EAAAA,KAAK,EAAE;AACLC,IAAAA,IAAI,EAAE;AACJC,MAAAA,IAAI,EAAEC;AADF,KADD;AAILC,IAAAA,WAAW,EAAE;AACXF,MAAAA,IAAI,EAAEC;AADK,KAJR;AAOLE,IAAAA,OAAO,EAAE;AACPH,MAAAA,IAAI,EAAEI,MADC;AAEPC,MAAAA,SAFO,qBAEGC,GAFH,EAEQ;AACb,eAAO,CAAC,MAAD,EAAS,YAAT,EAAuB,OAAvB,EAAgC,QAAhC,EAA0CC,QAA1C,CAAmDD,GAAnD,CAAP;AACD;AAJM,KAPJ;AAaLE,IAAAA,MAAM,EAAEC,QAbH;AAcLC,IAAAA,OAAO,EAAED,QAdJ;AAeLE,IAAAA,MAAM,EAAEF,QAfH;AAgBLG,IAAAA,MAAM,EAAEH,QAhBH;AAiBLI,IAAAA,UAAU,EAAEC;AAjBP,GARsB;AA2B7BC,EAAAA,KAAK,EAAE,CAAC,QAAD,EAAW,WAAX,EAAwB,WAAxB,CA3BsB;AA4B7BC,EAAAA,IA5B6B,kBA4BtB;AACL,WAAO;AACLC,MAAAA,MAAM,EAAE,IADH;AAELC,MAAAA,UAAU,EAAE;AAFP,KAAP;AAID,GAjC4B;AAkC7BC,EAAAA,QAAQ,EAAE;AACRC,IAAAA,OADQ,qBACE;AACR,aAAO,KAAKjB,OAAL,KAAiB,OAAxB;AACD,KAHO;AAIRkB,IAAAA,QAJQ,sBAIG;AACT,aAAO,KAAKnB,WAAL,IAAoB,KAAKA,WAAL,CAAiBoB,GAArC,IAA4C,KAAKvB,IAAL,IAAa,KAAKA,IAAL,CAAUuB,GAA1E;AACD,KANO;AAORC,IAAAA,OAPQ,qBAOE;AACR,aAAO,KAAKrB,WAAL,IAAoB,KAAKA,WAAL,CAAiBqB,OAA5C;AACD,KATO;AAURC,IAAAA,SAVQ,uBAUI;AACV,aAAO,KAAKtB,WAAL,IAAoB,KAAKA,WAAL,CAAiBZ,IAArC,IAA6C,KAAKS,IAAL,IAAa,KAAKA,IAAL,CAAUT,IAA3E;AACD,KAZO;AAaRmC,IAAAA,OAbQ,qBAaE;AACR,aAAO,WACFC,WADE,8CAECA,WAFD,uBAEiC,CAAC,KAAKxB,WAAN,IAAqB,CAAC,KAAKH,IAF5D,iCAGC2B,WAHD,sBAGgC,KAAKxB,WAAL,IAAoB,KAAKA,WAAL,CAAiByB,MAAjB,KAA4B,MAHhF,EAAP;AAKD,KAnBO;AAoBRC,IAAAA,IApBQ,kBAoBD;AACL,aAAO,KAAK1B,WAAL,IAAoB,KAAKA,WAAL,CAAiB0B,IAArC,IAA6C,KAAK7B,IAAL,IAAa,KAAKA,IAAL,CAAU6B,IAA3E;AACD,KAtBO;AAuBRC,IAAAA,iBAvBQ,+BAuBY;AAAA;;AAClB,aAAOf,OAAO,CAAC,CAAC,KAAKZ,WAAN,mBAAqB,KAAKH,IAA1B,+CAAqB,WAAWT,IAAhC,CAAD,CAAP,IAAiD,CAAC,SAAD,EAAY,MAAZ,EAAoBiB,QAApB,sBAA6B,KAAKL,WAAlC,sDAA6B,kBAAkByB,MAA/C,CAAxD;AACD;AAzBO,GAlCmB;AA6D7BG,EAAAA,OAAO,EAAE;AACPC,IAAAA,UADO,sBACIC,KADJ,EACW;AAChBA,MAAAA,KAAK,CAACC,cAAN;AACA,WAAKC,KAAL,CAAW,QAAX,EAAqBF,KAAK,CAACG,YAAN,CAAmBC,KAAxC;AACA,WAAKF,KAAL,CAAW,WAAX,EAAwBF,KAAxB;AACA,WAAKd,UAAL,GAAkB,KAAlB;AACD,KANM;AAOPmB,IAAAA,eAPO,2BAOSL,KAPT,EAOgB;AACrB,WAAKf,MAAL,GAAce,KAAK,CAACf,MAApB;AACAe,MAAAA,KAAK,CAACC,cAAN;AACA,WAAKC,KAAL,CAAW,WAAX,EAAwBF,KAAxB;AACA,WAAKd,UAAL,GAAkB,IAAlB;AACD,KAZM;AAaPoB,IAAAA,eAbO,2BAaSN,KAbT,EAagB;AACrB,UAAI,KAAKf,MAAL,KAAgBe,KAAK,CAACf,MAA1B,EACE;AACFe,MAAAA,KAAK,CAACC,cAAN;AACA,WAAKC,KAAL,CAAW,WAAX,EAAwBF,KAAxB;AACA,WAAKd,UAAL,GAAkB,KAAlB;AACD,KAnBM;AAoBPqB,IAAAA,cApBO,0BAoBQP,KApBR,EAoBe;AACpBA,MAAAA,KAAK,CAACC,cAAN;AACD,KAtBM;AAuBPO,IAAAA,wBAvBO,sCAuBoB;AACzB,UAAMC,eAAe;AAAA,2BACHlD,MADG;AAAA,UAC0B,0BAD1B,+BAEZ,uDAFY,IAArB;;AAIA,UAAMmD,aAAa,6BAAS,0BAAT,EAAnB;;AACA,aAAO,KAAKxB,UAAL,GAAkBwB,aAAlB,GAAkCD,eAAzC;AACD,KA9BM;AA+BPE,IAAAA,WA/BO,yBA+BO;AACZ;AAAA,2BAAsBjB,WAAtB;AAAA,UAAwD,KAAKL,QAAL;AAAA,eAA2B,KAAKA;AAAhC,cAAxD;AACD,KAjCM;AAkCPuB,IAAAA,eAlCO,6BAkCW;AAChB,UAAI,KAAK1C,WAAL,CAAiByB,MAAjB,KAA4B,MAAhC,EAAwC;AACtC;AACD;;AACD,UAAI,KAAKzB,WAAL,CAAiByB,MAAjB,KAA4B,UAAhC,EAA4C;AAC1C;AAAA,6BAAsBD,WAAtB;AAAA;AAAA,6BAEkBA,WAFlB;AAAA,YAGKmB,IAAI,CAACC,GAAL,CAAS,KAAK5C,WAAL,CAAiBqB,OAA1B,EAAmC,EAAnC,CAHL,EAIK,GAJL;AAOD;AACF,KA/CM;AAgDPwB,IAAAA,QAhDO,oBAgDEC,CAhDF,EAgDK;AACV,WAAKrC,MAAL,CAAYqC,CAAZ;AACA,WAAKtC,OAAL,CAAasC,CAAb;AACD,KAnDM;AAoDPC,IAAAA,cApDO,4BAoDU;AAAA;AAAA;AAAA;;AACf;AAAA,2BAAsBvB,WAAtB;AAAA,UACG,KAAKN,OAAL,IAAgB,KAAKuB,WAAL,EADnB;AAAA,2BAEiBjB,WAFjB;AAAA;AAAA,2BAGmBA,WAHnB;AAAA;AAAA,2BAIsBA,WAJtB;AAAA,UAImDwB,WAAW,CAAC,KAAK1B,SAAN,CAJ9D,IAKO,KAAKtB,WAAL,IAAoB,KAAK0C,eAAL,EAL3B,EAMO,CAAC,KAAK1C,WAAN,IAAqB,CAAC,CAAC,KAAKH,IAA5B,kDANP;AAAA,2BAQqBR,MARrB;AAAA,UASO,gCATP,EAUO4D,cAAc,CAAC,KAAKvB,IAAN,CAVrB;AAAA,2BAYqBrC,MAZrB;AAAA,UAaO,gCAbP,EAcO6D,cAAc,EAdrB;AAAA,2BAgBmB1B,WAhBnB;AAAA,UAiBO,CAAC,UAAD,EAAa,SAAb,EAAwBnB,QAAxB,uBAAiC,KAAKL,WAAtC,uDAAiC,mBAAkByB,MAAnD;AAAA,iBAA6E,SAA7E;AAAA,mBAA+F,MAA/F;AAAA,2BAAgHD,WAAhH;AAAA,mBAAiK,KAAKlB;AAAtK;AAAA;AAAA,kBAA+K,0BAA/K;AAAA;AAAA,QAjBP,EAkBO,CAAC,KAAKK,UAAN,IAAoB,4BAAKX,WAAL,0EAAkByB,MAAlB,MAA6B,SAAjD;AAAA,iBAA6E,SAA7E;AAAA,mBAA+F,MAA/F;AAAA,mBAA+G,iBAACqB,CAAD;AAAA,iBAAO,KAAI,CAACpC,MAAL,mBAAiB,KAAI,CAACV,WAAtB,GAAqC8C,CAArC,CAAP;AAAA;AAA/G;AAAA;AAAA,kBAAgK,0BAAhK;AAAA;AAAA,QAlBP,IAoBK,KAAKnB,iBAAL;AAAA,2BAAyCH,WAAzC;AAAA;AAAA,iBACiB,SADjB;AAAA,mBACmC,MADnC;AAAA,2BACoDA,WADpD;AAAA,mBACqG,KAAKqB;AAD1G;AAAA;AAAA,kBACqH,0BADrH;AAAA;AAAA;AAAA,iBAEiB,SAFjB;AAAA,mBAEmC,MAFnC;AAAA,mBAEmD,KAAKpC;AAFxD;AAAA;AAAA,kBAEiE,cAFjE;AAAA;AAAA,UApBL;AA0BD;AA/EM,GA7DoB;AA8I7B0C,EAAAA,MA9I6B,oBA8IpB;AACP,QAAIC,OAAO,GAAG,IAAd;;AACA,QAAI,CAAC,KAAKpD,WAAL,IAAoB,KAAKH,IAA1B,KAAmC,KAAKI,OAAL,KAAiB,QAAxD,EAAkE;AAChEmD,MAAAA,OAAO,GAAG,KAAKL,cAAL,EAAV;AACD,KAFD,MAEO;AACLK,MAAAA,OAAO;AAAA,2BAAkB5B,WAAlB;AAAA,mBAAmD,KAAKhB;AAAxD,UAAkE,KAAK6C,MAAL,eAAuB,KAAKA,MAAL,YAAoB,IAApB,CAAvB,IAAoD,KAAKf,wBAAL,EAAtH,EAAP;AACD;;AACD;AAAA,eAAmB,KAAKf,OAAxB;AAAA,gBAAyC,KAAKM,UAA9C;AAAA,qBAAuE,KAAKM,eAA5E;AAAA,oBAAyG,KAAKE,cAA9G;AAAA,qBAA2I,KAAKD;AAAhJ,QAAkKgB,OAAlK;AACD;AAtJ4B,CAAD,CAA9B;;;;"}