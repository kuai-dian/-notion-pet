{"version":3,"file":"slider.js","sources":["../../src/slider/slider.tsx"],"sourcesContent":["import { defineComponent, VNode } from 'vue';\nimport { emitEvent } from '../utils/event';\nimport { ClassName, TNode } from '../common';\nimport props from './props';\nimport { prefix } from '../config';\nimport InputNumber from '../input-number/index';\nimport TSliderMark from './slider-mark';\nimport TSliderButton from './slider-button';\nimport { SliderValue, TdSliderProps } from './type';\n\nconst name = `${prefix}-slider`;\ninterface MarkItem {\n  point: number;\n  position: number;\n  mark: string | number | TNode<{ value: number }>;\n}\ninterface SliderButtonType {\n  setPosition: (param: number) => {};\n}\nexport default defineComponent({\n  name: 'TSlider',\n  components: {\n    TSliderMark,\n    TInputNumber: InputNumber,\n    TSliderButton,\n  },\n  model: {\n    prop: 'value',\n    event: 'change',\n  },\n  props: { ...props },\n  data() {\n    return {\n      firstValue: 0,\n      secondValue: 0,\n      prevValue: 0 as SliderValue,\n      dragging: false,\n      sliderSize: 1,\n      inputDecimalPlaces: 0,\n      inputFormat: null,\n      inputPlaceholder: '',\n      inputTheme: 'column',\n      showSteps: false,\n    };\n  },\n  computed: {\n    containerClass(): ClassName {\n      return [`${name}__container`, { 'is-vertical': this.vertical }];\n    },\n    sliderClass(): ClassName {\n      return [\n        `${name}`,\n        {\n          'is-vertical': this.vertical,\n          [`${name}--with-input`]: this.inputNumberProps,\n          [`${name}--vertical`]: this.vertical,\n          [`${prefix}-is-disabled`]: this.disabled,\n        },\n      ];\n    },\n    sliderRailClass(): ClassName {\n      return [`${name}__rail`, { 'show-input': this.inputNumberProps, disabled: this.disabled }];\n    },\n    sliderNumberClass(): ClassName {\n      return [\n        `${name}__input`,\n        {\n          'is-vertical': this.vertical,\n        },\n      ];\n    },\n    vertical(): boolean {\n      return this.layout === 'vertical';\n    },\n    // 差值范围\n    rangeDiff(): number {\n      return this.max - this.min;\n    },\n    steps(): number[] {\n      const { min, max, rangeDiff, step } = this;\n      if (!this.showSteps || min > max) return [];\n      if (this.step === 0) {\n        console.warn('[Element Warn][Slider]step should not be 0.');\n        return [];\n      }\n      const stepCount = rangeDiff / step;\n      const stepWidth = (100 * step) / rangeDiff;\n      const result = [];\n      for (let i = 1; i < stepCount; i++) {\n        result.push(i * stepWidth);\n      }\n      if (this.range) {\n        return result.filter(\n          (step) =>\n            step < (100 * (this.minValue - min)) / rangeDiff || step > (100 * (this.maxValue - min)) / rangeDiff,\n        );\n      }\n      return result.filter((step) => step > (100 * (this.firstValue - min)) / rangeDiff);\n    },\n    markList(): Array<MarkItem> {\n      if (!this.marks) {\n        return [];\n      }\n      const legalMarks: Array<MarkItem> = [];\n      Object.keys(this.marks)\n        .map(parseFloat)\n        .sort((a, b) => a - b)\n        .filter((point) => point <= this.max && point >= this.min)\n        .forEach((point) => {\n          const item: MarkItem = {\n            point,\n            position: ((point - this.min) * 100) / this.rangeDiff,\n            mark: this.marks[point],\n          };\n          legalMarks.push(item);\n        });\n      return legalMarks;\n    },\n    minValue(): number {\n      return Math.min(this.firstValue, this.secondValue);\n    },\n    maxValue(): number {\n      return Math.max(this.firstValue, this.secondValue);\n    },\n    barSize(): string {\n      const cuttentDiff = this.range ? this.maxValue - this.minValue : this.firstValue - this.min;\n      return `${(100 * cuttentDiff) / this.rangeDiff}%`;\n    },\n    barStart(): string {\n      return this.range ? `${(100 * (this.minValue - this.min)) / this.rangeDiff}%` : '0%';\n    },\n    precision(): number {\n      const precisions = [this.min, this.max, this.step].map((item) => {\n        const decimalArr = `${item}`.split('.');\n        return decimalArr[1] ? decimalArr[1].length : 0;\n      });\n      return Math.max.apply(null, precisions);\n    },\n    runwayStyle(): object {\n      return this.vertical ? { height: '100%' } : {};\n    },\n    barStyle(): object {\n      return this.vertical\n        ? {\n            height: this.barSize,\n            bottom: this.barStart,\n          }\n        : {\n            width: this.barSize,\n            left: this.barStart,\n          };\n    },\n  },\n  watch: {\n    value(newVal: SliderValue) {\n      if (this.dragging === true) return;\n      if (Array.isArray(newVal) && this.range) {\n        [this.firstValue, this.secondValue] = newVal;\n      } else {\n        this.firstValue = newVal as number;\n      }\n    },\n    firstValue(val: number) {\n      if (this.range) {\n        this.emitChange([this.minValue, this.maxValue]);\n      } else {\n        this.emitChange(val);\n      }\n    },\n    secondValue() {\n      if (this.range) {\n        this.emitChange([this.minValue, this.maxValue]);\n      }\n    },\n    dragging(newVal: boolean) {\n      if (newVal === false) {\n        this.init();\n      }\n    },\n  },\n  mounted() {\n    this.init();\n  },\n  beforeUnmount() {\n    window.removeEventListener('resize', this.resetSize);\n  },\n  methods: {\n    // 初始化传入的value\n    init(): void {\n      let valuetext: string | number;\n\n      const { min, max, value } = this;\n      if (this.range) {\n        if (Array.isArray(value)) {\n          this.firstValue = Math.max(min || 0, value[0]);\n          this.secondValue = Math.min(max || 100, value[1]);\n        } else {\n          this.firstValue = min || 0;\n          this.secondValue = max || 100;\n        }\n        this.prevValue = [this.firstValue, this.secondValue];\n        valuetext = `${this.firstValue}-${this.secondValue}`;\n      } else {\n        if (typeof this.value !== 'number') {\n          this.firstValue = min;\n        } else {\n          this.firstValue = Math.min(max, Math.max(min, value as number));\n        }\n        this.prevValue = this.firstValue;\n        valuetext = String(this.firstValue);\n      }\n      this.$el.setAttribute('aria-valuetext', valuetext);\n      this.resetSize();\n      window.addEventListener('resize', this.resetSize);\n    },\n    valueChanged(): boolean {\n      if (this.range) {\n        return ![this.minValue, this.maxValue].every((item, index) => item === this.prevValue[index]);\n      }\n      return this.value !== this.prevValue;\n    },\n    // 防止值越级\n    setValues(value: SliderValue): SliderValue {\n      const [min, max] = [this.min, this.max];\n      if (min > max) {\n        console.warn('[Slider] max should be greater than min.');\n        return;\n      }\n      // 双向滑块\n      if (this.range && Array.isArray(value)) {\n        let [firstValue, secondValue] = [Math.min(...value), Math.max(...value)];\n        if (firstValue > max) {\n          firstValue = this.firstValue;\n        }\n        if (firstValue < min) {\n          firstValue = min;\n        }\n        if (secondValue < min) {\n          secondValue = this.secondValue;\n        }\n        if (secondValue > max) {\n          secondValue = max;\n        }\n        [this.firstValue, this.secondValue] = [firstValue, secondValue];\n        return [firstValue, secondValue];\n      }\n      let preValue = value;\n      if (preValue < min) {\n        preValue = min;\n      }\n      if (preValue > max) {\n        preValue = max;\n      }\n      return preValue;\n    },\n    setInputProps(): void {\n      if (typeof this.inputNumberProps !== 'boolean') {\n        const {\n          decimalPlaces: inputDecimalPlaces,\n          format: inputFormat,\n          placeholder: inputPlaceholder,\n          theme: inputTheme,\n        } = this.inputNumberProps as TdSliderProps['inputNumberProps'];\n        if (typeof inputDecimalPlaces === 'number' && !Number.isNaN(inputDecimalPlaces)) {\n          this.inputDecimalPlaces = inputDecimalPlaces;\n        }\n        if (inputPlaceholder) {\n          this.inputPlaceholder = inputPlaceholder;\n        }\n        if (typeof inputFormat === 'function') {\n          this.inputFormat = inputFormat;\n        }\n        if (['column', 'row', 'normal'].includes(inputTheme)) {\n          this.inputTheme = inputTheme;\n        }\n      }\n    },\n    // 相应button的位置\n    setPosition(percent: number): void {\n      let targetValue = (percent * this.rangeDiff) / 100;\n      targetValue = this.min + targetValue;\n      if (!this.range) {\n        (this.$refs.button1 as SliderButtonType).setPosition(percent);\n        return;\n      }\n      let button;\n      if (Math.abs(this.minValue - targetValue) < Math.abs(this.maxValue - targetValue)) {\n        button = this.firstValue < this.secondValue ? 'button1' : 'button2';\n      } else {\n        button = this.firstValue > this.secondValue ? 'button1' : 'button2';\n      }\n      (this.$refs[button] as SliderButtonType).setPosition(percent);\n    },\n    // 全局点击\n    onSliderClick(event: MouseEvent): void {\n      if (this.disabled || this.dragging) {\n        return;\n      }\n      this.resetSize();\n      let value = 0;\n      if (this.vertical) {\n        const sliderOffsetBottom = (this.$refs.slider as Element).getBoundingClientRect().bottom;\n        value = ((sliderOffsetBottom - event.clientY) / this.sliderSize) * 100;\n        this.setPosition(value);\n      } else {\n        const sliderOffsetLeft = (this.$refs.slider as Element).getBoundingClientRect().left;\n        value = ((event.clientX - sliderOffsetLeft) / this.sliderSize) * 100;\n        this.setPosition(value);\n      }\n    },\n    resetSize(): void {\n      if (this.$refs.slider) {\n        this.sliderSize = this.$refs.slider[`client${this.vertical ? 'Height' : 'Width'}`];\n      }\n    },\n    // 只要触发修改就要有这个方法抛出change事件\n    emitChange(value: SliderValue) {\n      let changeValue = value;\n      if (changeValue === undefined) {\n        if (this.range) {\n          changeValue = [this.firstValue, this.secondValue];\n        } else {\n          changeValue = this.prevValue;\n        }\n      }\n      const fixValue: SliderValue = this.setValues(changeValue);\n      emitEvent<Parameters<TdSliderProps['onChange']>>(this, 'change', fixValue);\n    },\n    getStopStyle(position: number) {\n      return this.vertical ? { top: `calc(${100 - position}% - 1px)` } : { left: `${position}%` };\n    },\n\n    // mark 点击触发修改事件\n    changeValue(point: number) {\n      if (this.disabled || this.dragging) {\n        return;\n      }\n      this.resetSize();\n      const value = Number((point / this.rangeDiff) * 100);\n      this.setPosition(value);\n      this.emitChange(point);\n    },\n    renderMask(): VNode {\n      if (this.markList.length) {\n        return (\n          <div>\n            <div>\n              {this.markList.map((item, index) => (\n                <div class={`${name}__stop ${name}__mark-stop`} style={this.getStopStyle(item.position)} key={index} />\n              ))}\n            </div>\n            <div class={`${name}__mark`}>\n              {this.markList.map((item, key) => (\n                <t-slider-mark\n                  mark={item.mark}\n                  point={item.point}\n                  key={key}\n                  style={this.getStopStyle(item.position)}\n                  on-change-value={this.changeValue}\n                />\n              ))}\n            </div>\n          </div>\n        );\n      }\n    },\n    renderInputButton(): VNode {\n      const { max, min, sliderNumberClass, range } = this;\n      return (\n        <div\n          class={[\n            `${name}__input-container`,\n            {\n              'is-vertical': this.vertical,\n            },\n          ]}\n        >\n          {\n            <t-input-number\n              class={sliderNumberClass}\n              value={range ? this.firstValue : this.prevValue}\n              ref=\"input\"\n              step={this.step}\n              onChange={(v: number) => {\n                this.firstValue = v;\n                this.range ? (this.firstValue = v) : (this.prevValue = v);\n              }}\n              disabled={this.disabled}\n              min={min}\n              max={max}\n              decimalPlaces={this.inputDecimalPlaces}\n              format={this.inputFormat}\n              placeholder={this.inputPlaceholder}\n              theme={this.inputTheme}\n            />\n          }\n          {range && <div class={`${name}__center-line`} />}\n          {range && (\n            <t-input-number\n              class={this.sliderNumberClass}\n              value={this.secondValue}\n              ref=\"input\"\n              onChange={(v: number) => {\n                this.secondValue = v;\n              }}\n              step={this.step}\n              disabled={this.disabled}\n              min={min}\n              max={max}\n              decimalPlaces={this.inputDecimalPlaces}\n              format={this.inputFormat}\n              placeholder={this.inputPlaceholder}\n              theme={this.inputTheme}\n            />\n          )}\n        </div>\n      );\n    },\n  },\n  render(): VNode {\n    const { min, max, layout, disabled, vertical } = this;\n    const BUTTON_GROUP = this.inputNumberProps && this.renderInputButton();\n    const MASKS = this.renderMask();\n    return (\n      <div class={this.containerClass}>\n        <div\n          class={this.sliderClass}\n          role=\"slider\"\n          aria-valuemin={min}\n          aria-valuemax={max}\n          aria-orientation={layout}\n          aria-disabled={disabled}\n          tooltip-props={this.tooltipProps}\n        >\n          <div class={this.sliderRailClass} style={this.runwayStyle} onClick={this.onSliderClick} ref=\"slider\">\n            <div class={`${name}__track`} style={this.barStyle} />\n            <t-slider-button\n              vertical={vertical}\n              value={this.firstValue}\n              ref=\"button1\"\n              disabled={this.disabled}\n              tooltip-props={this.tooltipProps}\n              onInput={(v: number) => {\n                this.firstValue = v;\n              }}\n            />\n            {this.range && (\n              <t-slider-button\n                vertical={vertical}\n                value={this.secondValue}\n                ref=\"button2\"\n                disabled={this.disabled}\n                tooltip-props={this.tooltipProps}\n                onInput={(v: number) => {\n                  this.secondValue = v;\n                }}\n              />\n            )}\n\n            {this.showSteps && (\n              <div>\n                {this.steps.map((item, key) => (\n                  <div class={`${name}__stop`} key={key} style={this.getStopStyle(item)} />\n                ))}\n              </div>\n            )}\n            {MASKS}\n          </div>\n        </div>\n        {BUTTON_GROUP}\n      </div>\n    );\n  },\n});\n"],"names":["name","prefix","defineComponent","components","TSliderMark","TInputNumber","InputNumber","TSliderButton","model","prop","event","props","data","firstValue","secondValue","prevValue","dragging","sliderSize","inputDecimalPlaces","inputFormat","inputPlaceholder","inputTheme","showSteps","computed","containerClass","vertical","sliderClass","inputNumberProps","disabled","sliderRailClass","sliderNumberClass","layout","rangeDiff","max","min","steps","step","console","warn","stepCount","stepWidth","result","i","push","range","filter","step2","minValue","maxValue","markList","marks","legalMarks","Object","keys","map","parseFloat","sort","a","b","point","forEach","item","position","mark","Math","barSize","cuttentDiff","barStart","precision","precisions","decimalArr","split","length","apply","runwayStyle","height","barStyle","bottom","width","left","watch","value","newVal","Array","isArray","val","emitChange","init","mounted","beforeUnmount","window","removeEventListener","resetSize","methods","valuetext","String","$el","setAttribute","addEventListener","valueChanged","every","index","setValues","preValue","setInputProps","decimalPlaces","format","placeholder","theme","Number","isNaN","includes","setPosition","percent","targetValue","$refs","button1","button","abs","onSliderClick","sliderOffsetBottom","slider","getBoundingClientRect","clientY","sliderOffsetLeft","clientX","changeValue","fixValue","emitEvent","getStopStyle","top","renderMask","key","renderInputButton","v","render","BUTTON_GROUP","MASKS","tooltipProps"],"mappings":"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"}