{"version":3,"file":"useTagList.js","sources":["../../src/tag-input/useTagList.ts"],"sourcesContent":["import { ref, SetupContext, WritableComputedRef } from 'vue';\nimport { TagInputValue, TdTagInputProps } from './type';\nimport { InputValue } from '../input';\nimport useDefault from '../hooks/useDefault';\n\nexport type ChangeParams = [Parameters<TdTagInputProps['onChange']>[1]];\n\n// handle tag add and remove\nexport default function useTagList(props: TdTagInputProps, context: SetupContext) {\n  // handle controlled property and uncontrolled property\n  const [tagValue, setTagValue] = useDefault<TdTagInputProps['value'], TdTagInputProps>(\n    props,\n    context.emit,\n    'value',\n    'change',\n  );\n  // const { onChange } = props;\n  const oldInputValue = ref<InputValue>();\n\n  // 点击标签关闭按钮，删除标签\n  const onClose = (p: { e: MouseEvent; index: number; item: string | number }) => {\n    const arr = [...tagValue.value];\n    arr.splice(p.index, 1);\n    setTagValue<ChangeParams>(arr, { trigger: 'tag-remove', index: p.index, e: p.e });\n    props.onRemove?.({ ...p, trigger: 'tag-remove', value: tagValue.value });\n  };\n\n  const clearAll = (context: { e: MouseEvent }) => {\n    setTagValue<ChangeParams>([], { trigger: 'clear', e: context.e });\n  };\n\n  // 按下 Enter 键，新增标签\n  const onInnerEnter = (value: InputValue, context: { e: KeyboardEvent }) => {\n    const valueStr = String(value).trim();\n    if (!valueStr) return;\n    const isLimitExceeded = props.max && tagValue.value?.length >= props.max;\n    let newValue: TagInputValue = tagValue.value;\n    if (!isLimitExceeded) {\n      newValue = tagValue.value instanceof Array ? tagValue.value.concat(String(valueStr)) : [valueStr];\n      setTagValue<ChangeParams>(newValue, {\n        trigger: 'enter',\n        index: newValue.length - 1,\n        e: context.e,\n      });\n    }\n    props?.onEnter?.(newValue, { ...context, inputValue: value });\n  };\n\n  // 按下回退键，删除标签\n  const onInputBackspaceKeyUp = (value: InputValue, context: { e: KeyboardEvent }) => {\n    const { e } = context;\n    // 回车键删除，输入框值为空时，才允许 Backspace 删除标签\n    if (!oldInputValue.value && ['Backspace', 'NumpadDelete'].includes(e.code)) {\n      const index = tagValue.value?.length;\n      const item = tagValue.value?.[index];\n      const trigger = 'backspace';\n      setTagValue<ChangeParams>(tagValue.value.slice(0, -1), { e, index, item, trigger });\n      props.onRemove?.({ e, index, item, trigger, value: tagValue.value });\n    }\n    oldInputValue.value = value;\n  };\n\n  return {\n    tagValue,\n    clearAll,\n    onClose,\n    onInnerEnter,\n    onInputBackspaceKeyUp,\n  };\n}\n"],"names":["useTagList","props","context","useDefault","emit","tagValue","setTagValue","oldInputValue","ref","onClose","p","arr","value","splice","index","trigger","e","onRemove","clearAll","context2","onInnerEnter","valueStr","String","trim","isLimitExceeded","max","length","newValue","Array","concat","onEnter","inputValue","onInputBackspaceKeyUp","includes","code","item","slice"],"mappings":"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"}