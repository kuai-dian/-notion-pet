{"version":3,"file":"index.js","sources":["../../../src/time-picker/panel/index.tsx"],"sourcesContent":["import { defineComponent, nextTick } from 'vue';\nimport dayjs from 'dayjs';\nimport customParseFormat from 'dayjs/plugin/customParseFormat';\n\nimport mixins from '../../utils/mixins';\nimport getConfigReceiverMixins, { TimePickerConfig } from '../../config-provider/config-receiver';\nimport { TimePickerPanelColInstance } from '../interface';\nimport { COMPONENT_NAME, EPickerCols } from '../constant';\nimport { panelProps } from './props';\nimport PanelCol from './panel-col';\nimport TButton from '../../button/button';\n\nconst name = `${COMPONENT_NAME}__panel`;\n\ndayjs.extend(customParseFormat);\n\nexport default defineComponent({\n  ...mixins(getConfigReceiverMixins<TimePickerConfig>('timePicker')),\n  name,\n  components: {\n    PanelCol,\n    TButton,\n  },\n  props: panelProps(),\n\n  emits: ['sure', 'now-action', 'time-pick'],\n  data() {\n    return {\n      panel: null,\n      isSetup: false,\n    };\n  },\n  computed: {\n    sectionComponentName() {\n      return `${name}-section`;\n    },\n    classNames() {\n      return this.rangePicker ? [name, this.sectionComponentName] : [name];\n    },\n    colValues() {\n      return this.value.map((el) => el || dayjs());\n    },\n    rangePicker() {\n      return this.colValues.length > 1;\n    },\n    formatField() {\n      const match = this.format.match(/(a\\s+|A\\s+)?(h+|H+)?:?(m+)?:?(s+)?(\\s+a|\\s+A)?/);\n      const [, startAChart, hour, minute, second, endAChart] = match;\n      return {\n        startAChart,\n        hour,\n        minute,\n        second,\n        endAChart,\n      };\n    },\n    cols() {\n      if (!this.formatField) {\n        return [EPickerCols.hour, EPickerCols.minute, EPickerCols.second];\n      }\n      const { startAChart, hour, minute, second, endAChart } = this.formatField;\n      const res = [];\n      startAChart && res.push(EPickerCols.meridiem);\n      hour && res.push(EPickerCols.hour);\n      minute && res.push(EPickerCols.minute);\n      second && res.push(EPickerCols.second);\n      endAChart && res.push(EPickerCols.meridiem);\n      return res;\n    },\n    localeMeridiems() {\n      return [this.global.anteMeridiem, this.global.postMeridiem];\n    },\n  },\n  watch: {\n    isShowPanel: {\n      handler(val: boolean) {\n        if (val) {\n          this.panelColUpdate();\n        }\n      },\n      immediate: true,\n    },\n  },\n  methods: {\n    panelColUpdate() {\n      nextTick(() => {\n        const panelCol0 = this.$refs.panelCol_0 as TimePickerPanelColInstance;\n        const panelCol1 = this.$refs.panelCol_1 as TimePickerPanelColInstance;\n        panelCol0 && panelCol0.updateTimeScrollPos();\n        panelCol1 && panelCol1.updateTimeScrollPos();\n      });\n    },\n    // eslint-disable-next-line no-undef\n    scrollToTime(colIndex: number, col: EPickerCols, time: number | string, behavior: ScrollBehavior) {\n      const scroller = this.$refs[`panelCol_${colIndex}`] as TimePickerPanelColInstance;\n      scroller && scroller.scrollToTime(col, time, behavior);\n    },\n    renderFooter() {\n      const confirmAction = this.confirmBtnClick.bind(this);\n      return (\n        <div class={`${this.sectionComponentName}-footer`}>\n          {/* 样式设置为row-reverse 这样不用特地为确定写个绝对布局 */}\n          <t-button theme=\"primary\" variant=\"base\" onClick={confirmAction}>\n            {this.t(this.global.confirm)}\n          </t-button>\n          {this.rangePicker || (\n            <t-button theme=\"primary\" variant=\"text\" onClick={this.nowAction}>\n              {this.t(this.global.nowtime)}\n            </t-button>\n          )}\n        </div>\n      );\n    },\n\n    renderBody() {\n      return (\n        <div class={`${this.sectionComponentName}-body`}>\n          {this.renderSinglePicker(0)}\n          {this.rangePicker && this.renderSinglePicker(1)}\n        </div>\n      );\n    },\n    renderSinglePicker(index: number) {\n      const val = this.colValues[index];\n      const ref = `panelCol_${index}`;\n      return (\n        <panel-col\n          ref={ref}\n          value={val}\n          cols={this.cols}\n          steps={this.steps}\n          hideDisabledTime={this.hideDisabledTime}\n          disableTime={this.disableTime}\n          format={this.format}\n          onTimePick={(col: EPickerCols, time: string | number) => this.handleTimePick(col, time, index)}\n          localeMeridiems={this.localeMeridiems}\n        />\n      );\n    },\n    confirmBtnClick() {\n      this.$emit('sure');\n    },\n    nowAction() {\n      this.$emit('now-action');\n      this.panelColUpdate();\n    },\n    /**\n     * 时间 item 点击选择处理函数\n     * @param col 选择的哪一列 上午/下午 hour minute second am/pm\n     * @param time 选择的时间 如果col是：上午/下午或者am/pm 则time是 string，如果是hour或minute或second则time是 number\n     * @param index\n     */\n    handleTimePick(col: EPickerCols, time: string | number, index: number) {\n      this.$emit('time-pick', col, time, index, this.colValues[index]);\n    },\n  },\n  render() {\n    const { isFooterDisplay, classNames } = this;\n    return (\n      <div class={classNames}>\n        {this.renderBody()}\n        {isFooterDisplay ? this.renderFooter() : null}\n      </div>\n    );\n  },\n});\n"],"names":["name","COMPONENT_NAME","dayjs","extend","customParseFormat","defineComponent","mixins","getConfigReceiverMixins","components","PanelCol","TButton","props","panelProps","emits","data","panel","isSetup","computed","sectionComponentName","classNames","rangePicker","colValues","value","map","el","length","formatField","match","format","startAChart","hour","minute","second","endAChart","cols","EPickerCols","res","push","meridiem","localeMeridiems","global","anteMeridiem","postMeridiem","watch","isShowPanel","handler","val","panelColUpdate","immediate","methods","nextTick","panelCol0","$refs","panelCol_0","panelCol1","panelCol_1","updateTimeScrollPos","scrollToTime","colIndex","col","time","behavior","scroller","renderFooter","confirmAction","confirmBtnClick","bind","t","confirm","nowAction","nowtime","renderBody","renderSinglePicker","index","ref","steps","hideDisabledTime","disableTime","handleTimePick","$emit","render","isFooterDisplay"],"mappings":"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"}