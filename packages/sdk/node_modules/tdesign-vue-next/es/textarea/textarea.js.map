{"version":3,"file":"textarea.js","sources":["../../src/textarea/textarea.tsx"],"sourcesContent":["import { defineComponent } from 'vue';\nimport { prefix } from '../config';\nimport CLASSNAMES from '../utils/classnames';\nimport props from './props';\nimport { TextareaValue } from './type';\nimport { getCharacterLength } from '../utils/helper';\nimport calcTextareaHeight from './calcTextareaHeight';\nimport { emitEvent } from '../utils/event';\nimport { renderTNodeJSX } from '../utils/render-tnode';\nimport { ClassName } from '../common';\n\nconst name = `${prefix}-textarea`;\nconst TEXTAREA_WRAP_CLASS = `${prefix}-textarea__wrap`;\nconst TEXTAREA_TIPS_CLASS = `${prefix}-textarea__tips`;\nconst TEXTAREA_LIMIT = `${name}__limit`;\n\nfunction getValidAttrs(obj: object): object {\n  const newObj = {};\n  Object.keys(obj).forEach((key) => {\n    if (typeof obj[key] !== 'undefined') {\n      newObj[key] = obj[key];\n    }\n  });\n  return newObj;\n}\n\nexport default defineComponent({\n  name: 'TTextarea',\n  inheritAttrs: false,\n  props: { ...props },\n  emits: ['keydown', 'keyup', 'keypress', 'focus', 'blur', 'change', 'update:value'],\n  data() {\n    return {\n      focused: false,\n      mouseHover: false,\n      textareaStyle: {},\n    };\n  },\n  computed: {\n    textareaClasses(): ClassName {\n      return [\n        name,\n        {\n          [`${prefix}-is-disabled`]: this.disabled,\n          [`${prefix}-is-readonly`]: this.readonly,\n        },\n      ];\n    },\n    inputAttrs(): Record<string, any> {\n      return getValidAttrs({\n        autofocus: this.autofocus,\n        disabled: this.disabled,\n        readonly: this.readonly,\n        placeholder: this.placeholder,\n        maxlength: this.maxlength || undefined,\n        name: this.name || undefined,\n      });\n    },\n    characterNumber(): number {\n      const characterInfo = getCharacterLength(String(this.value));\n      if (typeof characterInfo === 'object') {\n        return characterInfo.length;\n      }\n      return characterInfo;\n    },\n  },\n\n  watch: {\n    value() {\n      this.adjustTextareaHeight();\n    },\n  },\n\n  mounted() {\n    this.adjustTextareaHeight();\n  },\n\n  methods: {\n    adjustTextareaHeight() {\n      if (this.autosize === true) {\n        this.textareaStyle = calcTextareaHeight(this.$refs.refTextareaElem as HTMLTextAreaElement);\n      } else if (typeof this.autosize === 'object') {\n        const { minRows, maxRows } = this.autosize;\n        this.textareaStyle = calcTextareaHeight(this.$refs.refTextareaElem as HTMLTextAreaElement, minRows, maxRows);\n      } else if (this.$attrs.rows) {\n        this.textareaStyle = { height: 'auto', minHeight: 'auto' };\n      }\n    },\n\n    focus(): void {\n      const input = this.$refs.refInputElem as HTMLInputElement;\n      input?.focus();\n    },\n    blur(): void {\n      const input = this.$refs.refInputElem as HTMLInputElement;\n      input?.blur();\n    },\n\n    handleInput(e: any): void {\n      if (e.isComposing || e.inputType === 'insertCompositionText') return;\n      this.inputValueChangeHandle(e);\n    },\n    onCompositionend(e: InputEvent | CompositionEvent) {\n      this.inputValueChangeHandle(e as InputEvent);\n    },\n    inputValueChangeHandle(e: InputEvent) {\n      const { target } = e;\n      let val = (target as HTMLInputElement).value;\n      if (this.maxcharacter && this.maxcharacter >= 0) {\n        const stringInfo = getCharacterLength(val, this.maxcharacter);\n        val = typeof stringInfo === 'object' && stringInfo.characters;\n      }\n      this.$emit('update:value', val);\n      emitEvent(this, 'change', val, { e });\n\n      this.$nextTick(() => this.setInputValue(val));\n      this.adjustTextareaHeight();\n    },\n    setInputValue(v: TextareaValue = ''): void {\n      const textareaElem = this.$refs.refTextareaElem as HTMLInputElement;\n      const sV = String(v);\n      if (!textareaElem) {\n        return;\n      }\n      if (textareaElem.value !== sV) {\n        textareaElem.value = sV;\n      }\n    },\n    emitKeyDown(e: KeyboardEvent) {\n      if (this.disabled) return;\n      emitEvent(this, 'keydown', this.value, { e });\n    },\n    emitKeyUp(e: KeyboardEvent) {\n      if (this.disabled) return;\n      emitEvent(this, 'keyup', this.value, { e });\n    },\n    emitKeypress(e: KeyboardEvent) {\n      if (this.disabled) return;\n      emitEvent(this, 'keypress', this.value, { e });\n    },\n    emitFocus(e: FocusEvent) {\n      if (this.disabled) return;\n      this.focused = true;\n      emitEvent(this, 'focus', this.value, { e });\n    },\n    emitBlur(e: FocusEvent) {\n      this.focused = false;\n      emitEvent(this, 'blur', this.value, { e });\n    },\n  },\n\n  render() {\n    const inputEvents = getValidAttrs({\n      onFocus: this.emitFocus,\n      onBlur: this.emitBlur,\n      onKeydown: this.emitKeyDown,\n      onKeyup: this.emitKeyUp,\n      onKeypress: this.emitKeypress,\n    });\n    const classes = [\n      `${name}__inner`,\n      {\n        [`${prefix}-is-${this.status}`]: this.status,\n        [CLASSNAMES.STATUS.disabled]: this.disabled,\n        [CLASSNAMES.STATUS.focused]: this.focused,\n        [`${prefix}-resize-none`]: this.maxlength,\n      },\n      'narrow-scrollbar',\n    ];\n\n    const textareaNode = (\n      <div class={this.textareaClasses}>\n        <textarea\n          onInput={this.handleInput}\n          onCompositionend={this.onCompositionend}\n          ref=\"refTextareaElem\"\n          value={this.value}\n          style={this.textareaStyle}\n          class={classes}\n          {...this.$attrs}\n          {...inputEvents}\n          {...this.inputAttrs}\n        ></textarea>\n        {this.maxcharacter && <span class={TEXTAREA_LIMIT}>{`${this.characterNumber}/${this.maxcharacter}`}</span>}\n        {!this.maxcharacter && this.maxlength ? (\n          <span class={TEXTAREA_LIMIT}>{`${this.value ? String(this.value)?.length : 0}/${this.maxlength}`}</span>\n        ) : null}\n      </div>\n    );\n\n    const tips = renderTNodeJSX(this, 'tips');\n    if (tips) {\n      return (\n        <div class={TEXTAREA_WRAP_CLASS}>\n          {textareaNode}\n          <div class={`${TEXTAREA_TIPS_CLASS} ${prefix}-textarea__tips--${this.status || 'normal'}`}>{tips}</div>\n        </div>\n      );\n    }\n    return textareaNode;\n  },\n});\n"],"names":["name","prefix","TEXTAREA_WRAP_CLASS","TEXTAREA_TIPS_CLASS","TEXTAREA_LIMIT","getValidAttrs","obj","newObj","Object","keys","forEach","key","defineComponent","inheritAttrs","props","emits","data","focused","mouseHover","textareaStyle","computed","textareaClasses","disabled","readonly","inputAttrs","autofocus","placeholder","maxlength","characterNumber","characterInfo","getCharacterLength","String","value","length","watch","adjustTextareaHeight","mounted","methods","autosize","calcTextareaHeight","$refs","refTextareaElem","minRows","maxRows","$attrs","rows","height","minHeight","focus","input","refInputElem","blur","handleInput","e","isComposing","inputType","inputValueChangeHandle","onCompositionend","target","val","maxcharacter","stringInfo","characters","$emit","emitEvent","$nextTick","setInputValue","v","textareaElem","sV","emitKeyDown","emitKeyUp","emitKeypress","emitFocus","emitBlur","render","inputEvents","onFocus","onBlur","onKeydown","onKeyup","onKeypress","classes","status","CLASSNAMES","STATUS","textareaNode","tips","renderTNodeJSX"],"mappings":"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"}