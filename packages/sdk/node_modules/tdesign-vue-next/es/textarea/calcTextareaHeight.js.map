{"version":3,"file":"calcTextareaHeight.js","sources":["../../src/textarea/calcTextareaHeight.ts"],"sourcesContent":["/**\n * Thanks to https://github.com/ElemeFE/element/blob/dev/packages/input/src/calcTextareaHeight.js\n */\ntype RowsType = number | null;\n\ntype ResultType = {\n  height?: string;\n  minHeight?: string;\n};\n\nlet hiddenTextarea: HTMLTextAreaElement;\n\nconst HIDDEN_TEXTAREA_STYLE = `\n  min-height:0 !important;\n  max-height:none !important;\n  height:0 !important;\n  visibility:hidden !important;\n  overflow:hidden !important;\n  position:absolute !important;\n  z-index:-1000 !important;\n  top:0 !important;\n  right:0 !important\n`;\n\nconst SIZING_PROPS = [\n  'letter-spacing',\n  'line-height',\n  'padding-top',\n  'padding-bottom',\n  'font-family',\n  'font-weight',\n  'font-size',\n  'font-variant',\n  'text-rendering',\n  'text-transform',\n  'width',\n  'text-indent',\n  'padding-left',\n  'padding-right',\n  'border-width',\n  'box-sizing',\n];\n\nfunction calculateNodeStyling(targetElement: HTMLTextAreaElement) {\n  const style = window.getComputedStyle(targetElement);\n\n  const boxSizing =\n    style.getPropertyValue('box-sizing') ||\n    style.getPropertyValue('-moz-box-sizing') ||\n    style.getPropertyValue('-webkit-box-sizing');\n\n  const paddingSize =\n    parseFloat(style.getPropertyValue('padding-bottom')) + parseFloat(style.getPropertyValue('padding-top'));\n\n  const borderSize =\n    parseFloat(style.getPropertyValue('border-bottom-width')) + parseFloat(style.getPropertyValue('border-top-width'));\n\n  const sizingStyle = SIZING_PROPS.map((name) => `${name}:${style.getPropertyValue(name)}`).join(';');\n\n  return {\n    sizingStyle,\n    paddingSize,\n    borderSize,\n    boxSizing,\n  };\n}\n\nexport default function calcTextareaHeight(\n  targetElement: HTMLTextAreaElement,\n  minRows: RowsType = 1,\n  maxRows: RowsType = null,\n) {\n  if (!hiddenTextarea) {\n    hiddenTextarea = document.createElement('textarea');\n    document.body.appendChild(hiddenTextarea);\n  }\n\n  const { paddingSize, borderSize, boxSizing, sizingStyle } = calculateNodeStyling(targetElement);\n\n  hiddenTextarea.setAttribute('style', `${sizingStyle};${HIDDEN_TEXTAREA_STYLE}`);\n  hiddenTextarea.value = targetElement.value || targetElement.placeholder || '';\n\n  let height = hiddenTextarea.scrollHeight;\n  const result: ResultType = {};\n\n  if (boxSizing === 'border-box') {\n    height += borderSize;\n  } else if (boxSizing === 'content-box') {\n    height -= paddingSize;\n  }\n\n  hiddenTextarea.value = '';\n  const singleRowHeight = hiddenTextarea.scrollHeight - paddingSize;\n\n  if (minRows !== null) {\n    let minHeight = singleRowHeight * minRows;\n    if (boxSizing === 'border-box') {\n      minHeight = minHeight + paddingSize + borderSize;\n    }\n    height = Math.max(minHeight, height);\n    result.minHeight = `${minHeight}px`;\n  }\n  if (maxRows !== null) {\n    let maxHeight = singleRowHeight * maxRows;\n    if (boxSizing === 'border-box') {\n      maxHeight = maxHeight + paddingSize + borderSize;\n    }\n    height = Math.min(maxHeight, height);\n  }\n  result.height = `${height}px`;\n  hiddenTextarea.parentNode && hiddenTextarea.parentNode.removeChild(hiddenTextarea);\n  hiddenTextarea = null;\n  return result;\n}\n"],"names":["hiddenTextarea","HIDDEN_TEXTAREA_STYLE","SIZING_PROPS","calculateNodeStyling","targetElement","style","window","getComputedStyle","boxSizing","getPropertyValue","paddingSize","parseFloat","borderSize","sizingStyle","map","name","join","calcTextareaHeight","minRows","maxRows","document","createElement","body","appendChild","setAttribute","value","placeholder","height","scrollHeight","result","singleRowHeight","minHeight","Math","max","maxHeight","min","parentNode","removeChild"],"mappings":"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"}