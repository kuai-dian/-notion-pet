{"version":3,"file":"form-item.js","sources":["../../src/form/form-item.tsx"],"sourcesContent":["import { defineComponent, VNode, nextTick, h } from 'vue';\nimport { CheckCircleFilledIcon, ErrorCircleFilledIcon, CloseCircleFilledIcon } from 'tdesign-icons-vue-next';\nimport cloneDeep from 'lodash/cloneDeep';\nimport lodashGet from 'lodash/get';\nimport lodashSet from 'lodash/set';\nimport isNil from 'lodash/isNil';\nimport { prefix } from '../config';\nimport { validate } from './form-model';\nimport {\n  Data,\n  FormRule,\n  TdFormItemProps,\n  TdFormProps,\n  ValueType,\n  ValidateTriggerType,\n  AllValidateResult,\n} from './type';\nimport props from './form-item-props';\nimport { CLASS_NAMES, FORM_ITEM_CLASS_PREFIX } from './const';\nimport Form, { FormItemInstance } from './form';\nimport { ClassName, ScopedSlot, TNodeReturnValue, Styles } from '../common';\nimport mixins from '../utils/mixins';\nimport getConfigReceiverMixins, { FormConfig } from '../config-provider/config-receiver';\nimport { emitEvent } from '../utils/event';\n\ntype IconConstructor = typeof ErrorCircleFilledIcon;\n\ntype FormInstance = InstanceType<typeof Form>;\nexport type FormItemValidateResult<T extends Data = Data> = { [key in keyof T]: boolean | AllValidateResult[] };\n\nexport const enum ValidateStatus {\n  TO_BE_VALIDATED = 'not',\n  SUCCESS = 'success',\n  FAIL = 'fail',\n}\n\nconst name = `${prefix}-form-item`;\n\nexport default defineComponent({\n  ...mixins(getConfigReceiverMixins<FormConfig>('form')),\n  name: 'TFormItem',\n\n  inject: {\n    form: { default: undefined },\n  },\n\n  props: { ...props },\n\n  data() {\n    return {\n      // 校验不通过信息列表\n      errorList: [],\n      // 校验通过显示的内容\n      successList: [],\n      // 当前校验状态 未校验、校验通过、校验不通过\n      verifyStatus: ValidateStatus.TO_BE_VALIDATED,\n      resetValidating: false as boolean,\n      needResetField: false as boolean,\n      initialValue: undefined as ValueType,\n    };\n  },\n\n  computed: {\n    classes(): ClassName {\n      return [\n        CLASS_NAMES.formItem,\n        FORM_ITEM_CLASS_PREFIX + this.name,\n        {\n          [CLASS_NAMES.formItemWithHelp]: this.help,\n          [CLASS_NAMES.formItemWithExtra]: this.renderTipsInfo(),\n        },\n      ];\n    },\n    labelClasses() {\n      const parent = this.form;\n      const labelAlign = isNil(this.labelAlign) ? parent?.labelAlign : this.labelAlign;\n      const labelWidth = isNil(this.labelWidth) ? parent?.labelWidth : this.labelWidth;\n\n      return [\n        CLASS_NAMES.label,\n        {\n          [`${prefix}-form__label--required`]: this.needRequiredMark,\n          [`${prefix}-form__label--colon`]: this.hasColon,\n          [`${prefix}-form__label--top`]: labelAlign === 'top' || !labelWidth,\n          [`${prefix}-form__label--left`]: labelAlign === 'left' && labelWidth,\n          [`${prefix}-form__label--right`]: labelAlign === 'right' && labelWidth,\n        },\n      ];\n    },\n    errorClasses(): string {\n      const parent = this.form as FormInstance;\n      if (!parent.showErrorMessage) return '';\n      if (this.verifyStatus === ValidateStatus.SUCCESS) {\n        return this.successBorder ? [CLASS_NAMES.success, CLASS_NAMES.successBorder].join(' ') : CLASS_NAMES.success;\n      }\n      if (!this.errorList.length) return;\n      const type = this.errorList[0].type || 'error';\n      return type === 'error' ? CLASS_NAMES.error : CLASS_NAMES.warning;\n    },\n    contentClasses() {\n      const getErrorClass: string = this.errorClasses;\n      return [CLASS_NAMES.controls, getErrorClass];\n    },\n    contentStyle(): Styles {\n      const parent = this.form;\n      const labelAlign = isNil(this.labelAlign) ? parent?.labelAlign : this.labelAlign;\n      const labelWidth = isNil(this.labelWidth) ? parent?.labelWidth : this.labelWidth;\n      let contentStyle = {};\n      if (labelWidth && labelAlign !== 'top') {\n        if (typeof labelWidth === 'number') {\n          contentStyle = { marginLeft: `${labelWidth}px` };\n        } else {\n          contentStyle = { marginLeft: labelWidth };\n        }\n      }\n\n      return contentStyle;\n    },\n    value(): ValueType {\n      const parent = this.form;\n      return parent && parent.data && lodashGet(parent.data, this.name);\n    },\n    hasColon(): boolean {\n      const parent = this.form;\n      return !!(parent && parent.colon && this.getLabelContent());\n    },\n    needRequiredMark(): boolean {\n      const { requiredMark } = this.$props;\n      if (typeof requiredMark === 'boolean') return requiredMark;\n      const parent = this.form;\n      const parentRequiredMark = parent?.requiredMark === undefined ? this.global.requiredMark : parent.requiredMark;\n      const isRequired = this.innerRules.filter((rule) => rule.required).length > 0;\n      return Boolean(parentRequiredMark && isRequired);\n    },\n    innerRules(): FormRule[] {\n      const parent = this.form;\n      return lodashGet(parent?.rules, this.name) || this.rules || [];\n    },\n  },\n\n  watch: {\n    value() {\n      this.validate('change');\n    },\n  },\n\n  mounted() {\n    this.initialValue = cloneDeep(this.value);\n    this.form.children.push(this);\n  },\n\n  beforeUnmount() {\n    const index = this.form.children.findIndex((item: FormItemInstance) => item === this);\n    this.form.children.splice(index, 1);\n  },\n\n  methods: {\n    async validate<T>(trigger: ValidateTriggerType): Promise<FormItemValidateResult<T>> {\n      this.resetValidating = true;\n      const rules =\n        trigger === 'all' ? this.innerRules : this.innerRules.filter((item) => (item.trigger || 'change') === trigger);\n      const r = await validate(this.value, rules);\n      const errorList = r.filter((item) => item.result !== true);\n      this.errorList = errorList;\n      // 仅有自定义校验方法才会存在 successList\n      this.successList = r.filter((item) => item.result === true && item.message && item.type === 'success');\n      // 根据校验结果设置校验状态\n      if (rules.length) {\n        this.verifyStatus = errorList.length ? ValidateStatus.FAIL : ValidateStatus.SUCCESS;\n      } else {\n        this.verifyStatus = ValidateStatus.TO_BE_VALIDATED;\n      }\n      // 重置处理\n      if (this.needResetField) {\n        this.resetHandler();\n      }\n      this.resetValidating = false;\n      return {\n        [this.name]: errorList.length === 0 ? true : r,\n      } as FormItemValidateResult<T>;\n    },\n    getLabelContent(): TNodeReturnValue {\n      if (typeof this.label === 'function') {\n        // @ts-ignore: TODO\n        return this.label(h);\n      }\n      if (typeof this.$slots.label === 'function') {\n        return this.$slots.label(null);\n      }\n      return this.label;\n    },\n    getLabel(): TNodeReturnValue {\n      const parent = this.form;\n      const labelWidth = isNil(this.labelWidth) ? parent?.labelWidth : this.labelWidth;\n      const labelAlign = isNil(this.labelAlign) ? parent?.labelAlign : this.labelAlign;\n      if (Number(labelWidth) === 0) return;\n\n      let labelStyle = {};\n      if (labelWidth && labelAlign !== 'top') {\n        if (typeof labelWidth === 'number') {\n          labelStyle = { width: `${labelWidth}px` };\n        } else {\n          labelStyle = { width: labelWidth };\n        }\n      }\n\n      return (\n        <div class={this.labelClasses} style={labelStyle}>\n          <label for={this.for}>{this.getLabelContent()}</label>\n        </div>\n      );\n    },\n    renderTipsInfo(): VNode {\n      const parent = this.form;\n      let helpVNode: VNode;\n      if (this.help) {\n        helpVNode = <div class={CLASS_NAMES.help}>{this.help}</div>;\n      }\n      const list = this.errorList;\n      if (parent.showErrorMessage && list && list[0] && list[0].message) {\n        return <p class={CLASS_NAMES.extra}>{list[0].message}</p>;\n      }\n      if (this.successList.length) {\n        return <p class={CLASS_NAMES.extra}>{this.successList[0].message}</p>;\n      }\n      return helpVNode;\n    },\n    getDefaultIcon(): TNodeReturnValue {\n      const resultIcon = (Icon: IconConstructor) => (\n        <span class={CLASS_NAMES.status}>\n          <Icon size=\"20px\"></Icon>\n        </span>\n      );\n      const list = this.errorList;\n      if (this.verifyStatus === ValidateStatus.SUCCESS) {\n        return resultIcon(CheckCircleFilledIcon);\n      }\n      if (list && list[0]) {\n        const type = this.errorList[0].type || 'error';\n        const icon =\n          {\n            error: CloseCircleFilledIcon,\n            warning: ErrorCircleFilledIcon,\n          }[type] || CheckCircleFilledIcon;\n        return resultIcon(icon as IconConstructor);\n      }\n      return null;\n    },\n    getIcon(\n      statusIcon: TdFormProps['statusIcon'] | TdFormItemProps['statusIcon'],\n      slotStatusIcon: ScopedSlot,\n    ): TNodeReturnValue {\n      const resultIcon = (otherContent?: TNodeReturnValue) => <span class={CLASS_NAMES.status}>{otherContent}</span>;\n      const withoutIcon = () => <span class={[CLASS_NAMES.status, `${CLASS_NAMES.status}-without-icon`]}></span>;\n      if (statusIcon === true) {\n        return this.getDefaultIcon();\n      }\n      if (statusIcon === false) {\n        return withoutIcon();\n      }\n      if (typeof statusIcon === 'function') {\n        return resultIcon(slotStatusIcon());\n      }\n      if (typeof slotStatusIcon === 'function') {\n        return resultIcon(slotStatusIcon());\n      }\n      return null;\n    },\n    getSuffixIcon(): TNodeReturnValue {\n      const parent = this.form;\n      const { statusIcon } = this;\n      const slotStatusIcon = this.$slots.statusIcon;\n      const parentStatusIcon = parent.statusIcon;\n      const parentSlotStatusIcon = parent.$slots.statusIcon;\n      let resultIcon: TNodeReturnValue = this.getIcon(statusIcon, slotStatusIcon);\n      if (resultIcon) return resultIcon;\n      if (resultIcon === false) return;\n      resultIcon = this.getIcon(parentStatusIcon, parentSlotStatusIcon);\n      if (resultIcon) return resultIcon;\n    },\n    getEmptyValue(): ValueType {\n      const parent = this.form;\n      const type = Object.prototype.toString.call(lodashGet(parent.data, this.name));\n      let emptyValue: ValueType;\n      if (type === '[object Array]') {\n        emptyValue = [];\n      }\n      if (type === '[object Object]') {\n        emptyValue = {};\n      }\n      return emptyValue;\n    },\n    resetField(): void {\n      const parent = this.form;\n      if (!this.name) {\n        return;\n      }\n      if (parent.resetType === 'empty') {\n        lodashSet(parent.data, this.name, this.getEmptyValue());\n      }\n      if (parent.resetType === 'initial') {\n        lodashSet(parent.data, this.name, this.initialValue);\n      }\n      nextTick(() => {\n        if (this.resetValidating) {\n          this.needResetField = true;\n        } else {\n          this.resetHandler();\n        }\n      });\n    },\n    resetHandler(): void {\n      this.needResetField = false;\n      this.errorList = [];\n      this.successList = [];\n      this.verifyStatus = ValidateStatus.TO_BE_VALIDATED;\n    },\n  },\n\n  render(): VNode {\n    return (\n      <div class={this.classes}>\n        {this.getLabel()}\n        <div class={this.contentClasses} style={this.contentStyle}>\n          <div class={CLASS_NAMES.controlsContent}>\n            {this.$slots.default ? this.$slots.default() : null}\n            {this.getSuffixIcon()}\n          </div>\n          {this.renderTipsInfo()}\n        </div>\n      </div>\n    );\n  },\n});\n"],"names":["ValidateStatus","ValidateStatus2","name","prefix","defineComponent","mixins","getConfigReceiverMixins","inject","form","props","data","errorList","successList","verifyStatus","resetValidating","needResetField","initialValue","computed","classes","CLASS_NAMES","formItem","FORM_ITEM_CLASS_PREFIX","formItemWithHelp","help","formItemWithExtra","renderTipsInfo","labelClasses","parent","labelAlign","isNil","labelWidth","label","needRequiredMark","hasColon","errorClasses","showErrorMessage","successBorder","success","join","length","type","error","warning","contentClasses","getErrorClass","controls","contentStyle","marginLeft","value","lodashGet","colon","getLabelContent","requiredMark","$props","parentRequiredMark","global","isRequired","innerRules","filter","rule","required","Boolean","rules","watch","validate","mounted","cloneDeep","children","push","beforeUnmount","index","findIndex","item","splice","methods","trigger","r","result","message","resetHandler","h","$slots","getLabel","Number","labelStyle","width","helpVNode","list","extra","getDefaultIcon","resultIcon","Icon","status","CheckCircleFilledIcon","icon","CloseCircleFilledIcon","ErrorCircleFilledIcon","getIcon","statusIcon","slotStatusIcon","otherContent","withoutIcon","getSuffixIcon","parentStatusIcon","parentSlotStatusIcon","getEmptyValue","Object","prototype","toString","call","emptyValue","resetField","resetType","lodashSet","nextTick","render","controlsContent"],"mappings":"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"}