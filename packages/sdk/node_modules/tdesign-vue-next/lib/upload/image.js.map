{"version":3,"file":"image.js","sources":["../../src/upload/image.tsx"],"sourcesContent":["import { defineComponent, PropType } from 'vue';\nimport { AddIcon, DeleteIcon, UploadIcon, BrowseIcon } from 'tdesign-icons-vue-next';\nimport { UploadFile } from './type';\nimport TLoading from '../loading';\nimport { UploadRemoveOptions } from './interface';\nimport { UPLOAD_NAME } from './util';\nimport props from './props';\nimport CLASSNAMES from '../utils/classnames';\nimport { prefix } from '../config';\n\nexport default defineComponent({\n  name: 'TImageUpload',\n\n  components: {\n    AddIcon,\n    DeleteIcon,\n    UploadIcon,\n    BrowseIcon,\n    TLoading,\n  },\n  props: {\n    showUploadProgress: props.showUploadProgress,\n    files: {\n      type: Array as PropType<Array<UploadFile>>,\n    },\n    loadingFile: {\n      type: Object as PropType<UploadFile>,\n    },\n    trigger: {\n      type: Function as PropType<(e: MouseEvent) => void>,\n    },\n    remove: {\n      type: Function as PropType<(options: UploadRemoveOptions) => void>,\n    },\n    multiple: Boolean,\n    max: Number,\n    disabled: Boolean,\n  },\n\n  emits: ['img-preview'],\n\n  computed: {\n    showTrigger(): boolean {\n      if (this.multiple) {\n        return !this.max || (this.files && this.files.length < this.max);\n      }\n      return !(this.files && this.files[0]);\n    },\n  },\n\n  methods: {\n    onMaskClick(e: MouseEvent) {\n      !this.showTrigger && this.trigger(e);\n    },\n    onViewClick(e: MouseEvent, file?: UploadFile) {\n      this.$emit('img-preview', e, file);\n    },\n  },\n\n  render() {\n    return (\n      <ul class={`${UPLOAD_NAME}__card`}>\n        {this.files &&\n          this.files.map((file, index) => (\n            <li class={`${UPLOAD_NAME}__card-item ${prefix}-is--background`}>\n              <div class={`${UPLOAD_NAME}__card-content ${UPLOAD_NAME}__card-box`}>\n                <img class={`${UPLOAD_NAME}__card-image`} src={file.url} />\n                <div class={`${UPLOAD_NAME}__card-mask`} onClick={this.onMaskClick}>\n                  <span class={`${UPLOAD_NAME}__card-mask-item`} onClick={(e: MouseEvent) => e.stopPropagation()}>\n                    <BrowseIcon onClick={({ e }: { e: MouseEvent }) => this.onViewClick(e, file)} />\n                  </span>\n                  <span class={`${UPLOAD_NAME}__card-mask-item-divider`}></span>\n\n                  <span class={`${UPLOAD_NAME}__card-mask-item`} onClick={(e: MouseEvent) => e.stopPropagation()}>\n                    <DeleteIcon onClick={({ e }: { e: MouseEvent }) => this.remove({ e, file, index })} />\n                  </span>\n                </div>\n              </div>\n            </li>\n          ))}\n        {this.showTrigger && (\n          <li\n            class={[\n              `${UPLOAD_NAME}__card-item ${prefix}-is--background`,\n              {\n                [CLASSNAMES.STATUS.disabled]: this.disabled,\n              },\n            ]}\n            onClick={this.trigger}\n          >\n            {this.showUploadProgress && this.loadingFile && (this.loadingFile as UploadFile).status === 'progress' ? (\n              <div class={`${UPLOAD_NAME}__card-container ${UPLOAD_NAME}__card-box`}>\n                <TLoading />\n                <p>上传中 {Math.min((this.loadingFile as UploadFile).percent, 99)}%</p>\n              </div>\n            ) : (\n              <div class={`${UPLOAD_NAME}__card-container ${UPLOAD_NAME}__card-box`}>\n                <AddIcon></AddIcon>\n                <p class={`${prefix}-size-s`}>点击上传图片</p>\n              </div>\n            )}\n          </li>\n        )}\n      </ul>\n    );\n  },\n});\n"],"names":["defineComponent","name","components","AddIcon","DeleteIcon","UploadIcon","BrowseIcon","TLoading","props","showUploadProgress","files","type","Array","loadingFile","Object","trigger","Function","remove","multiple","Boolean","max","Number","disabled","emits","computed","showTrigger","length","methods","onMaskClick","e","onViewClick","file","$emit","render","UPLOAD_NAME","map","index","prefix","url","stopPropagation","CLASSNAMES","STATUS","status","Math","min","percent"],"mappings":"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"}