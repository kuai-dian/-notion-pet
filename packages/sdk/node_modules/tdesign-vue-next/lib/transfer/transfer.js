/**
 * tdesign v0.8.0
 * (c) 2022 tdesign
 * @license MIT
 */

'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var _toConsumableArray = require('@babel/runtime/helpers/toConsumableArray');
var _defineProperty = require('@babel/runtime/helpers/defineProperty');
var vue = require('vue');
var pick = require('lodash/pick');
var config = require('../config.js');
var transfer_components_transferList = require('./components/transfer-list.js');
var transfer_components_transferOperations = require('./components/transfer-operations.js');
var transfer_utils = require('./utils.js');
var utils_mixins = require('../utils/mixins.js');
var configProvider_configReceiver = require('../config-provider/config-receiver.js');
var transfer_props = require('./props.js');
var utils_event = require('../utils/event.js');
require('@babel/runtime/helpers/typeof');
require('../pagination/index.js');
require('../pagination/pagination.js');
require('tdesign-icons-vue-next');
require('../input-number/index.js');
require('../input-number/input-number.js');
require('@babel/runtime/helpers/asyncToGenerator');
require('@babel/runtime/regenerator');
require('../button/index.js');
require('../button/button.js');
require('../utils/classnames.js');
require('../loading/index.js');
require('../loading/loading.js');
require('@babel/runtime/helpers/slicedToArray');
require('../loading/icon/gradient.js');
require('../_common/js/loading/circle-adapter.js');
require('../_common/js/utils/set-style.js');
require('../_common/js/utils/helper.js');
require('@babel/runtime/helpers/objectWithoutProperties');
require('../utils/dom.js');
require('../_chunks/dep-eb6b0f94.js');
require('lodash/isString');
require('../utils/easing.js');
require('../utils/render-tnode.js');
require('lodash/isEmpty');
require('lodash/isFunction');
require('lodash/isObject');
require('../utils/transfer-dom.js');
require('../loading/props.js');
require('../utils/withInstall.js');
require('../loading/style');
require('../loading/plugin.js');
require('../button/props.js');
require('../utils/ripple.js');
require('../utils/set-style.js');
require('../button/style');
require('../input-number/props.js');
require('../utils/helper.js');
require('lodash/camelCase');
require('../utils/map-props.js');
require('lodash/kebabCase');
require('../input-number/style');
require('../select/index.js');
require('../select/select.js');
require('lodash/debounce');
require('lodash/get');
require('lodash/set');
require('../input/index.js');
require('../input/addon.js');
require('../input/input.js');
require('../input/props.js');
require('../config-provider/zh_CN_config.js');
require('../input/input-group.js');
require('../input/style');
require('../tag/index.js');
require('../tag/tag.js');
require('../tag/props.js');
require('../tag/check-tag.js');
require('../tag/check-tag-props.js');
require('../tag/style');
require('../common-components/fake-arrow.js');
require('../popup/index.js');
require('../popup/popup.js');
require('@popperjs/core');
require('../popup/props.js');
require('../popup/style');
require('../select/option.js');
require('../select/option-props.js');
require('../checkbox/index.js');
require('../checkbox/checkbox.js');
require('../checkbox/props.js');
require('../checkbox/group.js');
require('lodash/intersection');
require('../checkbox/checkbox-group-props.js');
require('../checkbox/style');
require('../select/props.js');
require('../select/optionGroup.js');
require('../select/option-group-props.js');
require('../select/style');
require('../pagination/props.js');
require('../pagination/style');
require('./components/transfer-search.js');
require('lodash/cloneDeep');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var _toConsumableArray__default = /*#__PURE__*/_interopDefaultLegacy(_toConsumableArray);
var _defineProperty__default = /*#__PURE__*/_interopDefaultLegacy(_defineProperty);
var pick__default = /*#__PURE__*/_interopDefaultLegacy(pick);

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty__default["default"](target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }

function _isSlot(s) {
  return typeof s === 'function' || Object.prototype.toString.call(s) === '[object Object]' && !vue.isVNode(s);
}

var SOURCE = "source";
var TARGET = "target";
var _Transfer = vue.defineComponent(_objectSpread(_objectSpread({}, utils_mixins["default"](configProvider_configReceiver["default"]("transfer"))), {}, {
  name: transfer_utils.TRANSFER_NAME,
  components: {
    TransferList: transfer_components_transferList["default"],
    TransferOperations: transfer_components_transferOperations["default"]
  },
  props: _objectSpread({}, transfer_props["default"]),
  emits: ["checkChange", "change", "scroll", "search", "page-change", "update:checked", "checked-change", "update:value"],
  data: function data() {
    return {
      SOURCE: SOURCE,
      TARGET: TARGET
    };
  },
  computed: {
    isTreeMode: function isTreeMode() {
      var treeSlot = this.$slots.tree;
      return typeof treeSlot === "function";
    },
    leftButtonDisabled: function leftButtonDisabled() {
      return this.direction === "right";
    },
    rightButtonDisabled: function rightButtonDisabled() {
      return this.direction === "left";
    },
    transferData: function transferData() {
      return transfer_utils.getTransferData(this.data, this.keys, this.isTreeMode);
    },
    sourceList: function sourceList() {
      return transfer_utils.filterTransferData(this.transferData, this.value, false, this.isTreeMode);
    },
    targetList: function targetList() {
      return transfer_utils.filterTransferData(this.transferData, this.value, true, this.isTreeMode);
    },
    checkedValue: function checkedValue() {
      var _ref;

      return _ref = {}, _defineProperty__default["default"](_ref, SOURCE, transfer_utils.getDataValues(this.sourceList, this.checked, {
        isTreeMode: this.isTreeMode
      })), _defineProperty__default["default"](_ref, TARGET, transfer_utils.getDataValues(this.targetList, this.checked, {
        isTreeMode: this.isTreeMode
      })), _ref;
    },
    hasFooter: function hasFooter() {
      return !!this.$slots.footer || !!this.footer;
    },
    showPagination: function showPagination() {
      return !!this.pagination && !this.$slots.content;
    },
    showSearch: function showSearch() {
      return !!this.search;
    },
    footerOption: function footerOption() {
      var footer = this.footer || "";
      return transfer_utils.getTransferListOption(footer);
    },
    emptyOption: function emptyOption() {
      return transfer_utils.getTransferListOption(this.empty);
    },
    searchOption: function searchOption() {
      return transfer_utils.getTransferListOption(this.search);
    },
    checkAllOption: function checkAllOption() {
      return transfer_utils.getTransferListOption(this.showCheckAll);
    },
    disabledOption: function disabledOption() {
      return transfer_utils.getTransferListOption(this.disabled);
    },
    titleOption: function titleOption() {
      return transfer_utils.getTransferListOption(this.title);
    },
    paginationOption: function paginationOption() {
      return transfer_utils.getTransferListOption(this.pagination);
    }
  },
  methods: {
    transferTo: function transferTo(toDirection) {
      var oldTargetValue = JSON.parse(JSON.stringify(this.value));
      var newTargetValue;
      var checkedValue = toDirection === TARGET ? this.checkedValue[SOURCE] : this.checkedValue[TARGET];

      if (toDirection === SOURCE) {
        newTargetValue = oldTargetValue.filter(function (v) {
          return !checkedValue.includes(v);
        });
      } else if (this.targetSort === "original") {
        newTargetValue = transfer_utils.getDataValues(this.transferData, oldTargetValue.concat(checkedValue), {
          isTreeMode: this.isTreeMode
        });
      } else if (this.targetSort === "unshift") {
        newTargetValue = checkedValue.concat(oldTargetValue);
      } else {
        newTargetValue = oldTargetValue.concat(checkedValue);
      }

      this.handleCheckedChange([], toDirection === SOURCE ? TARGET : SOURCE);
      var params = {
        type: toDirection,
        movedValue: checkedValue
      };
      utils_event.emitEvent(this, "change", newTargetValue, params);
    },
    transferToRight: function transferToRight() {
      this.transferTo(TARGET);
    },
    transferToLeft: function transferToLeft() {
      this.transferTo(SOURCE);
    },
    handleCheckedChange: function handleCheckedChange(val, listType) {
      var sourceChecked = listType === SOURCE ? val : this.checkedValue[SOURCE];
      var targetChecked = listType === TARGET ? val : this.checkedValue[TARGET];
      var checked = [].concat(_toConsumableArray__default["default"](sourceChecked), _toConsumableArray__default["default"](targetChecked));
      var event = {
        checked: checked,
        sourceChecked: sourceChecked,
        targetChecked: targetChecked,
        type: listType
      };
      this.$emit("update:checked", checked);
      utils_event.emitEvent(this, "checked-change", event);
    },
    filterMethod: function filterMethod(transferList, targetValueList, needMatch) {
      return transferList.filter(function (item) {
        var isMatch = targetValueList.indexOf(item.value) > -1;
        return needMatch ? isMatch : !isMatch;
      });
    },
    handleScroll: function handleScroll(e, listType) {
      var target = e.target;
      var bottomDistance = target.scrollHeight - target.scrollTop - target.clientHeight;
      var event = {
        e: e,
        bottomDistance: bottomDistance,
        type: listType
      };
      utils_event.emitEvent(this, "scroll", event);
    },
    handleSearch: function handleSearch(e) {
      utils_event.emitEvent(this, "search", e);
    },
    handlePageChange: function handlePageChange(pageInfo, listType) {
      utils_event.emitEvent(this, "page-change", pageInfo, {
        type: listType
      });
    },
    renderTransferList: function renderTransferList(listType) {
      var _this = this;

      var scopedSlots = pick__default["default"](this.$slots, ["title", "empty", "footer", "operation", "transferItem", "default", "tree"]);
      return vue.createVNode(vue.resolveComponent("transfer-list"), {
        "checkboxProps": this.checkboxProps,
        "transferItem": this.transferItem,
        "list-type": listType,
        "title": this.titleOption[listType],
        "data-source": listType === SOURCE ? this.sourceList : this.targetList,
        "checked-value": this.checkedValue[listType],
        "disabled": this.disabledOption[listType],
        "search": this.searchOption[listType],
        "pagination": this.paginationOption[listType],
        "check-all": this.checkAllOption[listType],
        "footer": this.footerOption[listType],
        "empty": this.emptyOption[listType],
        "onCheckedChange": function onCheckedChange($event) {
          return _this.handleCheckedChange($event, listType);
        },
        "onScroll": function onScroll($event) {
          return _this.handleScroll($event, listType);
        },
        "onSearch": this.handleSearch,
        "onPageChange": function onPageChange($event) {
          return _this.handlePageChange($event, listType);
        },
        "t": this.t,
        "global": this.global,
        "isTreeMode": this.isTreeMode
      }, _isSlot(scopedSlots) ? scopedSlots : {
        "default": function _default() {
          return [scopedSlots];
        }
      });
    }
  },
  render: function render() {
    return vue.createVNode("div", {
      "class": ["".concat(config.prefix, "-transfer"), this.showSearch ? "".concat(config.prefix, "-transfer__search") : "", this.hasFooter ? "".concat(config.prefix, "-transfer__footer") : "", this.showPagination ? "".concat(config.prefix, "-transfer__pagination") : "", this.isTreeMode ? "".concat(config.prefix, "-transfer--with-tree") : ""]
    }, [this.renderTransferList(SOURCE), vue.createVNode(vue.resolveComponent("transfer-operations"), {
      "left-disabled": this.disabledOption[TARGET] || this.leftButtonDisabled || this.checkedValue[TARGET].length === 0,
      "right-disabled": this.disabledOption[SOURCE] || this.rightButtonDisabled || this.checkedValue[SOURCE].length === 0,
      "operation": this.operation,
      "onMoveToRight": this.transferToRight,
      "onMoveToLeft": this.transferToLeft
    }, {
      operation: this.$slots.operation
    }), this.renderTransferList(TARGET)]);
  }
}));

exports["default"] = _Transfer;
//# sourceMappingURL=transfer.js.map
