{"version":3,"file":"alert.js","sources":["../../src/alert/alert.tsx"],"sourcesContent":["import { defineComponent, h, VNode, ComponentPublicInstance, ref, onMounted, onBeforeUnmount } from 'vue';\nimport {\n  CheckCircleFilledIcon,\n  CloseIcon,\n  ErrorCircleFilledIcon,\n  HelpCircleFilledIcon,\n  InfoCircleFilledIcon,\n} from 'tdesign-icons-vue-next';\nimport { prefix } from '../config';\nimport { on, off, addClass } from '../utils/dom';\nimport props from './props';\nimport { renderTNodeJSX } from '../utils/render-tnode';\nimport { SlotReturnValue } from '../common';\nimport { useEmitEvent } from '../hooks/event';\nimport { useIcon } from '../hooks/icon';\n\nconst name = `${prefix}-alert`;\n\nexport default defineComponent({\n  name: 'TAlert',\n  props,\n  emits: ['close', 'closed'],\n  setup(props, { slots, emit }) {\n    const emitEvent = useEmitEvent(props, emit);\n    // alert的dom引用\n    const ele = ref<HTMLElement | null>(null);\n    // descriptiond的dom引用\n    const description = ref<HTMLElement | null>(null);\n    // desc高度\n    const descHeight = ref(0);\n    // 是否可见，关闭后置为false\n    const visible = ref(true);\n    // 是否已收起，使用折叠功能时有效，用于表示是否已折叠；默认折叠\n    const collapsed = ref(true);\n\n    const renderIcon = () => {\n      const Component = {\n        info: InfoCircleFilledIcon,\n        success: CheckCircleFilledIcon,\n        warning: ErrorCircleFilledIcon,\n        error: ErrorCircleFilledIcon,\n        question: HelpCircleFilledIcon,\n      };\n      const iconContent = useIcon(props, slots, 'icon', Component);\n      return iconContent ? <div class={`${name}__icon`}>{iconContent}</div> : null;\n    };\n\n    const renderClose = () => {\n      const { close } = props;\n      let closeContent = null;\n      if (close === true || close === '') {\n        closeContent = <CloseIcon />;\n      } else if (typeof close === 'string') {\n        closeContent = close;\n      } else {\n        closeContent = useIcon(props, slots, 'close');\n      }\n      return closeContent ? (\n        <div class={`${name}__close`} onClick={handleClose}>\n          {closeContent}\n        </div>\n      ) : null;\n    };\n\n    const renderTitle = (context: ComponentPublicInstance) => {\n      const titleContent = renderTNodeJSX(context, 'title');\n      return titleContent ? <div class={`${name}__title`}> {titleContent}</div> : null;\n    };\n\n    const renderMessage = (context: ComponentPublicInstance) => {\n      const operationContent = renderTNodeJSX(context, 'operation');\n      return (\n        <div class={`${name}__message`}>\n          {renderDescription(context)}\n          {operationContent ? <div class={`${name}__operation`}>{operationContent}</div> : null}\n        </div>\n      );\n    };\n\n    const renderDescription = (context: ComponentPublicInstance) => {\n      let messageContent;\n\n      messageContent = renderTNodeJSX(context, 'default');\n      if (!messageContent) {\n        messageContent = renderTNodeJSX(context, 'message');\n      }\n      const contentLength = Array.isArray(messageContent) ? (messageContent as Array<SlotReturnValue>).length : 1;\n      const hasCollapse = props.maxLine > 0 && props.maxLine < contentLength;\n      const height = (description.value?.children[0] as HTMLElement)?.offsetHeight;\n      if (hasCollapse && collapsed.value) {\n        // 折叠\n        messageContent = (messageContent as Array<SlotReturnValue>).slice(0, props.maxLine as number);\n        height && (description.value.style.height = `${descHeight.value}px`);\n      } else if (hasCollapse) {\n        // 展开\n        height && (description.value.style.height = `${height * (contentLength - props.maxLine) + descHeight.value}px`);\n      }\n\n      // 如果需要折叠，则元素之间补<br/>；否则不补\n      return (\n        <div class={`${name}__description`} ref=\"description\">\n          {hasCollapse\n            ? (messageContent as Array<string | VNode>).map((content) => <div>{content}</div>)\n            : messageContent}\n          {hasCollapse ? (\n            <div\n              class=\"t-alert__collapse\"\n              onClick={() => {\n                collapsed.value = !collapsed.value;\n              }}\n            >\n              {collapsed.value ? '展开全部' : '收起'}\n            </div>\n          ) : null}\n        </div>\n      );\n    };\n    const renderContent = (context: ComponentPublicInstance) => {\n      return (\n        <div class={`${name}__content`}>\n          {renderTitle(context)}\n          {renderMessage(context)}\n        </div>\n      );\n    };\n    const handleClose = (e: MouseEvent) => {\n      emitEvent('close', { e });\n      addClass(ele.value, `${name}--closing`);\n    };\n\n    const handleCloseEnd = (e: TransitionEvent) => {\n      if (e.propertyName === 'opacity') {\n        visible.value = false;\n        emitEvent('closed', { e });\n      }\n    };\n\n    onMounted(() => {\n      on(ele.value, 'transitionend', handleCloseEnd);\n      descHeight.value = description.value.offsetHeight;\n    });\n    onBeforeUnmount(() => {\n      off(ele.value, 'transitionend', handleCloseEnd);\n    });\n    return {\n      ele,\n      description,\n      visible,\n      collapsed,\n      renderIcon,\n      renderTitle,\n      renderMessage,\n      renderDescription,\n      renderContent,\n      renderClose,\n      handleClose,\n      handleCloseEnd,\n    };\n  },\n  render() {\n    const { theme, visible, $attrs, renderIcon, renderContent, renderClose } = this;\n    const CLASS = [\n      `${name}`,\n      `${name}--${theme}`,\n      {\n        [`${prefix}-is-hidden`]: !visible,\n      },\n    ];\n    return (\n      <div class={CLASS} {...$attrs} ref=\"ele\">\n        {renderIcon()}\n        {renderContent(this)}\n        {renderClose()}\n      </div>\n    );\n  },\n});\n"],"names":["name","prefix","defineComponent","props","emits","setup","props2","slots","emit","emitEvent","useEmitEvent","ele","ref","description","descHeight","visible","collapsed","renderIcon","Component","info","InfoCircleFilledIcon","success","CheckCircleFilledIcon","warning","ErrorCircleFilledIcon","error","question","HelpCircleFilledIcon","iconContent","useIcon","renderClose","close","closeContent","handleClose","renderTitle","context","titleContent","renderTNodeJSX","renderMessage","operationContent","renderDescription","messageContent","contentLength","Array","isArray","length","hasCollapse","maxLine","height","value","children","offsetHeight","slice","style","map","content","renderContent","e","addClass","handleCloseEnd","propertyName","onMounted","on","onBeforeUnmount","off","render","theme","$attrs","CLASS"],"mappings":"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"}