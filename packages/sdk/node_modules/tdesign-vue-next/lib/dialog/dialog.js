/**
 * tdesign v0.8.0
 * (c) 2022 tdesign
 * @license MIT
 */

'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var _defineProperty = require('@babel/runtime/helpers/defineProperty');
var vue = require('vue');
var tdesignIconsVueNext = require('tdesign-icons-vue-next');
var config = require('../config.js');
var button_index = require('../button/index.js');
var dialog_actions = require('./actions.js');
var dialog_props = require('./props.js');
var utils_renderTnode = require('../utils/render-tnode.js');
var utils_transferDom = require('../utils/transfer-dom.js');
var utils_event = require('../utils/event.js');
var utils_mixins = require('../utils/mixins.js');
var utils_dom = require('../utils/dom.js');
var configProvider_configReceiver = require('../config-provider/config-receiver.js');
require('../button/button.js');
require('@babel/runtime/helpers/toConsumableArray');
require('../utils/classnames.js');
require('../loading/index.js');
require('../loading/loading.js');
require('@babel/runtime/helpers/slicedToArray');
require('../loading/icon/gradient.js');
require('../_common/js/loading/circle-adapter.js');
require('../_common/js/utils/set-style.js');
require('../_common/js/utils/helper.js');
require('@babel/runtime/helpers/objectWithoutProperties');
require('../loading/props.js');
require('../utils/withInstall.js');
require('../loading/style');
require('../loading/plugin.js');
require('lodash/isEmpty');
require('lodash/isString');
require('lodash/isFunction');
require('lodash/isObject');
require('../_chunks/dep-eb6b0f94.js');
require('../utils/easing.js');
require('../button/props.js');
require('../utils/ripple.js');
require('../utils/set-style.js');
require('../button/style');
require('@babel/runtime/helpers/typeof');
require('../utils/helper.js');
require('lodash/camelCase');
require('../config-provider/zh_CN_config.js');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var _defineProperty__default = /*#__PURE__*/_interopDefaultLegacy(_defineProperty);

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty__default["default"](target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
var name = "".concat(config.prefix, "-dialog");
var lockClass = "".concat(config.prefix, "-dialog--lock");

function GetCSSValue(v) {
  return Number.isNaN(Number(v)) ? v : "".concat(Number(v), "px");
}

function InitDragEvent(dragBox) {
  var target = dragBox;
  target.addEventListener("mousedown", function (targetEvent) {
    var disX = targetEvent.clientX - target.offsetLeft;
    var disY = targetEvent.clientY - target.offsetTop;

    function mouseMoverHandler(documentEvent) {
      var left = documentEvent.clientX - disX;
      var top = documentEvent.clientY - disY;
      target.style.left = "".concat(left, "px");
      target.style.top = "".concat(top, "px");
    }

    function mouseUpHandler() {
      document.removeEventListener("mousemove", mouseMoverHandler);
      document.removeEventListener("mouseup", mouseUpHandler);
    }

    document.addEventListener("mousemove", mouseMoverHandler);
    document.addEventListener("mouseup", mouseUpHandler);
    document.addEventListener("dragend", mouseUpHandler);
  });
}

var _Dialog = vue.defineComponent(_objectSpread(_objectSpread({}, utils_mixins["default"](dialog_actions["default"], configProvider_configReceiver["default"]("dialog"))), {}, {
  name: "TDialog",
  components: {
    CloseIcon: tdesignIconsVueNext.CloseIcon,
    InfoCircleFilledIcon: tdesignIconsVueNext.InfoCircleFilledIcon,
    CheckCircleFilledIcon: tdesignIconsVueNext.CheckCircleFilledIcon,
    ErrorCircleFilledIcon: tdesignIconsVueNext.ErrorCircleFilledIcon,
    TButton: button_index.Button,
    Transition: vue.Transition
  },
  directives: {
    TransferDom: utils_transferDom["default"],
    draggable: function draggable(el, binding) {
      if (el && binding && binding.value) {
        InitDragEvent(el);
      }
    }
  },
  props: _objectSpread({}, dialog_props["default"]),
  emits: ["esc-keydown", "update:visible", "overlay-click", "close-btn-click", "cancel", "confirm", "opened", "closed", "close"],
  data: function data() {
    return {
      scrollWidth: 0
    };
  },
  computed: {
    isModal: function isModal() {
      return this.mode === "modal";
    },
    isModeless: function isModeless() {
      return this.mode === "modeless";
    },
    maskClass: function maskClass() {
      return ["".concat(name, "__mask"), !this.showOverlay && "".concat(config.prefix, "-is-hidden")];
    },
    dialogClass: function dialogClass() {
      var dialogClass = ["".concat(name), "".concat(name, "--default"), "".concat(name, "--").concat(this.placement), "".concat(name, "__modal-").concat(this.theme)];

      if (["modeless", "modal"].includes(this.mode)) {
        dialogClass.push("".concat(name, "--fixed"));
      }

      return dialogClass;
    },
    dialogStyle: function dialogStyle() {
      var top = this.top,
          placement = this.placement;
      var topStyle = {};

      if (top) {
        var topValue = GetCSSValue(top);
        topStyle = {
          top: topValue,
          transform: "translate(-50%, 0)",
          transformOrigin: "25% 25%",
          maxHeight: "calc(100% - ".concat(topValue, ")")
        };
      } else if (placement === "top") {
        topStyle = {
          maxHeight: "calc(100% - 20%)"
        };
      }

      return _objectSpread({
        width: GetCSSValue(this.width)
      }, topStyle);
    }
  },
  watch: {
    visible: function visible(value) {
      if (value) {
        var scrollWidth = this.scrollWidth;

        if (scrollWidth > 0) {
          var bodyCssText = "position: relative;width: calc(100% - ".concat(scrollWidth, "px);");
          document.body.style.cssText = bodyCssText;
        }

        utils_dom.addClass(document.body, lockClass);
      } else {
        document.body.style.cssText = "";
        utils_dom.removeClass(document.body, lockClass);
      }

      this.addKeyboardEvent(value);
    }
  },
  mounted: function mounted() {
    this.scrollWidth = window.innerWidth - document.body.offsetWidth;
  },
  beforeUnmount: function beforeUnmount() {
    this.addKeyboardEvent(false);
  },
  methods: {
    addKeyboardEvent: function addKeyboardEvent(status) {
      if (status) {
        document.addEventListener("keydown", this.keyboardEvent);
      } else {
        document.removeEventListener("keydown", this.keyboardEvent);
      }
    },
    keyboardEvent: function keyboardEvent(e) {
      if (e.code === "Escape") {
        utils_event.emitEvent(this, "esc-keydown", {
          e: e
        });

        if (this.closeOnEscKeydown) {
          this.emitCloseEvent({
            trigger: "esc",
            e: e
          });
        }
      }
    },
    overlayAction: function overlayAction(e) {
      utils_event.emitEvent(this, "overlay-click", {
        e: e
      });

      if (this.closeOnOverlayClick) {
        this.emitCloseEvent({
          trigger: "overlay",
          e: e
        });
      }
    },
    closeBtnAcion: function closeBtnAcion(e) {
      utils_event.emitEvent(this, "close-btn-click", {
        e: e
      });
      this.emitCloseEvent({
        trigger: "close-btn",
        e: e
      });
    },
    cancelBtnAction: function cancelBtnAction(e) {
      utils_event.emitEvent(this, "cancel", {
        e: e
      });
      this.emitCloseEvent({
        trigger: "cancel",
        e: e
      });
    },
    confirmBtnAction: function confirmBtnAction(e) {
      utils_event.emitEvent(this, "confirm", {
        e: e
      });
    },
    afterEnter: function afterEnter() {
      utils_event.emitEvent(this, "opened");
    },
    afterLeave: function afterLeave() {
      utils_event.emitEvent(this, "closed");
    },
    emitCloseEvent: function emitCloseEvent(context) {
      utils_event.emitEvent(this, "close", context);
      utils_event.emitEvent(this, "update:visible", false);
    },
    hasEventOn: function hasEventOn(name2) {
      var _this$_events;

      var eventFuncs = (_this$_events = this["_events"]) === null || _this$_events === void 0 ? void 0 : _this$_events[name2];
      return !!(eventFuncs !== null && eventFuncs !== void 0 && eventFuncs.length);
    },
    getIcon: function getIcon() {
      var icon = {
        info: vue.createVNode(tdesignIconsVueNext.InfoCircleFilledIcon, {
          "class": "t-is-info"
        }, null),
        warning: vue.createVNode(tdesignIconsVueNext.ErrorCircleFilledIcon, {
          "class": "t-is-warning"
        }, null),
        danger: vue.createVNode(tdesignIconsVueNext.ErrorCircleFilledIcon, {
          "class": "t-is-error"
        }, null),
        success: vue.createVNode(tdesignIconsVueNext.CheckCircleFilledIcon, {
          "class": "t-is-success"
        }, null)
      };
      return icon[this.theme];
    },
    renderDialog: function renderDialog() {
      var defaultHeader = vue.createVNode("h5", {
        "class": "title"
      }, null);

      var defaultCloseBtn = vue.createVNode(tdesignIconsVueNext.CloseIcon, null, null);

      var body = utils_renderTnode.renderContent(this, "default", "body");

      var defaultFooter = vue.createVNode("div", null, [this.getCancelBtn({
        cancelBtn: this.cancelBtn,
        globalCancel: this.global.cancel,
        className: "".concat(config.prefix, "-dialog__cancel")
      }), this.getConfirmBtn({
        theme: this.theme,
        confirmBtn: this.confirmBtn,
        globalConfirm: this.global.confirm,
        globalConfirmBtnTheme: this.global.confirmBtnTheme,
        className: "".concat(config.prefix, "-dialog__confirm")
      })]);

      var bodyClassName = this.theme === "default" ? "".concat(name, "__body") : "".concat(name, "__body__icon");
      return vue.withDirectives(vue.createVNode("div", {
        "key": "dialog",
        "class": this.dialogClass,
        "style": this.dialogStyle
      }, [vue.createVNode("div", {
        "class": "".concat(name, "__header")
      }, [this.getIcon(), utils_renderTnode.renderTNodeJSX(this, "header", defaultHeader)]), vue.createVNode("span", {
        "class": "".concat(name, "__close"),
        "onClick": this.closeBtnAcion
      }, [utils_renderTnode.renderTNodeJSX(this, "closeBtn", defaultCloseBtn)]), vue.createVNode("div", {
        "class": bodyClassName
      }, [body]), vue.createVNode("div", {
        "class": "".concat(name, "__footer")
      }, [utils_renderTnode.renderTNodeJSX(this, "footer", defaultFooter)])]), [[vue.resolveDirective("draggable"), this.isModeless && this.draggable]]);
    }
  },
  render: function render() {
    var _this = this;

    var maskView = this.isModal && vue.createVNode("div", {
      "key": "mask",
      "class": this.maskClass,
      "onClick": this.overlayAction
    }, null);

    var dialogView = this.renderDialog();
    var view = [maskView, dialogView];
    var ctxStyle = {
      zIndex: this.zIndex
    };
    var ctxClass = ["".concat(name, "__ctx"), {
      "t-dialog__ctx--fixed": this.mode === "modal"
    }];
    return vue.createVNode(vue.resolveComponent("transition"), {
      "duration": 300,
      "name": "".concat(name, "-zoom__vue"),
      "onAfterEnter": this.afterEnter,
      "onAfterLeave": this.afterLeave
    }, {
      "default": function _default() {
        return [(!_this.destroyOnClose || _this.visible) && vue.withDirectives(vue.createVNode("div", {
          "class": ctxClass,
          "style": ctxStyle
        }, [view]), [[vue.vShow, _this.visible], [vue.resolveDirective("transfer-dom"), _this.attach]])];
      }
    });
  }
}));

exports["default"] = _Dialog;
//# sourceMappingURL=dialog.js.map
