{"version":3,"file":"form-item.js","sources":["../../src/form/form-item.tsx"],"sourcesContent":["import { defineComponent, VNode, nextTick, h } from 'vue';\nimport { CheckCircleFilledIcon, ErrorCircleFilledIcon, CloseCircleFilledIcon } from 'tdesign-icons-vue-next';\nimport cloneDeep from 'lodash/cloneDeep';\nimport lodashGet from 'lodash/get';\nimport lodashSet from 'lodash/set';\nimport isNil from 'lodash/isNil';\nimport { prefix } from '../config';\nimport { validate } from './form-model';\nimport {\n  Data,\n  FormRule,\n  TdFormItemProps,\n  TdFormProps,\n  ValueType,\n  ValidateTriggerType,\n  AllValidateResult,\n} from './type';\nimport props from './form-item-props';\nimport { CLASS_NAMES, FORM_ITEM_CLASS_PREFIX } from './const';\nimport Form, { FormItemInstance } from './form';\nimport { ClassName, ScopedSlot, TNodeReturnValue, Styles } from '../common';\nimport mixins from '../utils/mixins';\nimport getConfigReceiverMixins, { FormConfig } from '../config-provider/config-receiver';\nimport { emitEvent } from '../utils/event';\n\ntype IconConstructor = typeof ErrorCircleFilledIcon;\n\ntype FormInstance = InstanceType<typeof Form>;\nexport type FormItemValidateResult<T extends Data = Data> = { [key in keyof T]: boolean | AllValidateResult[] };\n\nexport const enum ValidateStatus {\n  TO_BE_VALIDATED = 'not',\n  SUCCESS = 'success',\n  FAIL = 'fail',\n}\n\nconst name = `${prefix}-form-item`;\n\nexport default defineComponent({\n  ...mixins(getConfigReceiverMixins<FormConfig>('form')),\n  name: 'TFormItem',\n\n  inject: {\n    form: { default: undefined },\n  },\n\n  props: { ...props },\n\n  data() {\n    return {\n      // 校验不通过信息列表\n      errorList: [],\n      // 校验通过显示的内容\n      successList: [],\n      // 当前校验状态 未校验、校验通过、校验不通过\n      verifyStatus: ValidateStatus.TO_BE_VALIDATED,\n      resetValidating: false as boolean,\n      needResetField: false as boolean,\n      initialValue: undefined as ValueType,\n    };\n  },\n\n  computed: {\n    classes(): ClassName {\n      return [\n        CLASS_NAMES.formItem,\n        FORM_ITEM_CLASS_PREFIX + this.name,\n        {\n          [CLASS_NAMES.formItemWithHelp]: this.help,\n          [CLASS_NAMES.formItemWithExtra]: this.renderTipsInfo(),\n        },\n      ];\n    },\n    labelClasses() {\n      const parent = this.form;\n      const labelAlign = isNil(this.labelAlign) ? parent?.labelAlign : this.labelAlign;\n      const labelWidth = isNil(this.labelWidth) ? parent?.labelWidth : this.labelWidth;\n\n      return [\n        CLASS_NAMES.label,\n        {\n          [`${prefix}-form__label--required`]: this.needRequiredMark,\n          [`${prefix}-form__label--colon`]: this.hasColon,\n          [`${prefix}-form__label--top`]: labelAlign === 'top' || !labelWidth,\n          [`${prefix}-form__label--left`]: labelAlign === 'left' && labelWidth,\n          [`${prefix}-form__label--right`]: labelAlign === 'right' && labelWidth,\n        },\n      ];\n    },\n    errorClasses(): string {\n      const parent = this.form as FormInstance;\n      if (!parent.showErrorMessage) return '';\n      if (this.verifyStatus === ValidateStatus.SUCCESS) {\n        return this.successBorder ? [CLASS_NAMES.success, CLASS_NAMES.successBorder].join(' ') : CLASS_NAMES.success;\n      }\n      if (!this.errorList.length) return;\n      const type = this.errorList[0].type || 'error';\n      return type === 'error' ? CLASS_NAMES.error : CLASS_NAMES.warning;\n    },\n    contentClasses() {\n      const getErrorClass: string = this.errorClasses;\n      return [CLASS_NAMES.controls, getErrorClass];\n    },\n    contentStyle(): Styles {\n      const parent = this.form;\n      const labelAlign = isNil(this.labelAlign) ? parent?.labelAlign : this.labelAlign;\n      const labelWidth = isNil(this.labelWidth) ? parent?.labelWidth : this.labelWidth;\n      let contentStyle = {};\n      if (labelWidth && labelAlign !== 'top') {\n        if (typeof labelWidth === 'number') {\n          contentStyle = { marginLeft: `${labelWidth}px` };\n        } else {\n          contentStyle = { marginLeft: labelWidth };\n        }\n      }\n\n      return contentStyle;\n    },\n    value(): ValueType {\n      const parent = this.form;\n      return parent && parent.data && lodashGet(parent.data, this.name);\n    },\n    hasColon(): boolean {\n      const parent = this.form;\n      return !!(parent && parent.colon && this.getLabelContent());\n    },\n    needRequiredMark(): boolean {\n      const { requiredMark } = this.$props;\n      if (typeof requiredMark === 'boolean') return requiredMark;\n      const parent = this.form;\n      const parentRequiredMark = parent?.requiredMark === undefined ? this.global.requiredMark : parent.requiredMark;\n      const isRequired = this.innerRules.filter((rule) => rule.required).length > 0;\n      return Boolean(parentRequiredMark && isRequired);\n    },\n    innerRules(): FormRule[] {\n      const parent = this.form;\n      return lodashGet(parent?.rules, this.name) || this.rules || [];\n    },\n  },\n\n  watch: {\n    value() {\n      this.validate('change');\n    },\n  },\n\n  mounted() {\n    this.initialValue = cloneDeep(this.value);\n    this.form.children.push(this);\n  },\n\n  beforeUnmount() {\n    const index = this.form.children.findIndex((item: FormItemInstance) => item === this);\n    this.form.children.splice(index, 1);\n  },\n\n  methods: {\n    async validate<T>(trigger: ValidateTriggerType): Promise<FormItemValidateResult<T>> {\n      this.resetValidating = true;\n      const rules =\n        trigger === 'all' ? this.innerRules : this.innerRules.filter((item) => (item.trigger || 'change') === trigger);\n      const r = await validate(this.value, rules);\n      const errorList = r.filter((item) => item.result !== true);\n      this.errorList = errorList;\n      // 仅有自定义校验方法才会存在 successList\n      this.successList = r.filter((item) => item.result === true && item.message && item.type === 'success');\n      // 根据校验结果设置校验状态\n      if (rules.length) {\n        this.verifyStatus = errorList.length ? ValidateStatus.FAIL : ValidateStatus.SUCCESS;\n      } else {\n        this.verifyStatus = ValidateStatus.TO_BE_VALIDATED;\n      }\n      // 重置处理\n      if (this.needResetField) {\n        this.resetHandler();\n      }\n      this.resetValidating = false;\n      return {\n        [this.name]: errorList.length === 0 ? true : r,\n      } as FormItemValidateResult<T>;\n    },\n    getLabelContent(): TNodeReturnValue {\n      if (typeof this.label === 'function') {\n        // @ts-ignore: TODO\n        return this.label(h);\n      }\n      if (typeof this.$slots.label === 'function') {\n        return this.$slots.label(null);\n      }\n      return this.label;\n    },\n    getLabel(): TNodeReturnValue {\n      const parent = this.form;\n      const labelWidth = isNil(this.labelWidth) ? parent?.labelWidth : this.labelWidth;\n      const labelAlign = isNil(this.labelAlign) ? parent?.labelAlign : this.labelAlign;\n      if (Number(labelWidth) === 0) return;\n\n      let labelStyle = {};\n      if (labelWidth && labelAlign !== 'top') {\n        if (typeof labelWidth === 'number') {\n          labelStyle = { width: `${labelWidth}px` };\n        } else {\n          labelStyle = { width: labelWidth };\n        }\n      }\n\n      return (\n        <div class={this.labelClasses} style={labelStyle}>\n          <label for={this.for}>{this.getLabelContent()}</label>\n        </div>\n      );\n    },\n    renderTipsInfo(): VNode {\n      const parent = this.form;\n      let helpVNode: VNode;\n      if (this.help) {\n        helpVNode = <div class={CLASS_NAMES.help}>{this.help}</div>;\n      }\n      const list = this.errorList;\n      if (parent.showErrorMessage && list && list[0] && list[0].message) {\n        return <p class={CLASS_NAMES.extra}>{list[0].message}</p>;\n      }\n      if (this.successList.length) {\n        return <p class={CLASS_NAMES.extra}>{this.successList[0].message}</p>;\n      }\n      return helpVNode;\n    },\n    getDefaultIcon(): TNodeReturnValue {\n      const resultIcon = (Icon: IconConstructor) => (\n        <span class={CLASS_NAMES.status}>\n          <Icon size=\"20px\"></Icon>\n        </span>\n      );\n      const list = this.errorList;\n      if (this.verifyStatus === ValidateStatus.SUCCESS) {\n        return resultIcon(CheckCircleFilledIcon);\n      }\n      if (list && list[0]) {\n        const type = this.errorList[0].type || 'error';\n        const icon =\n          {\n            error: CloseCircleFilledIcon,\n            warning: ErrorCircleFilledIcon,\n          }[type] || CheckCircleFilledIcon;\n        return resultIcon(icon as IconConstructor);\n      }\n      return null;\n    },\n    getIcon(\n      statusIcon: TdFormProps['statusIcon'] | TdFormItemProps['statusIcon'],\n      slotStatusIcon: ScopedSlot,\n    ): TNodeReturnValue {\n      const resultIcon = (otherContent?: TNodeReturnValue) => <span class={CLASS_NAMES.status}>{otherContent}</span>;\n      const withoutIcon = () => <span class={[CLASS_NAMES.status, `${CLASS_NAMES.status}-without-icon`]}></span>;\n      if (statusIcon === true) {\n        return this.getDefaultIcon();\n      }\n      if (statusIcon === false) {\n        return withoutIcon();\n      }\n      if (typeof statusIcon === 'function') {\n        return resultIcon(slotStatusIcon());\n      }\n      if (typeof slotStatusIcon === 'function') {\n        return resultIcon(slotStatusIcon());\n      }\n      return null;\n    },\n    getSuffixIcon(): TNodeReturnValue {\n      const parent = this.form;\n      const { statusIcon } = this;\n      const slotStatusIcon = this.$slots.statusIcon;\n      const parentStatusIcon = parent.statusIcon;\n      const parentSlotStatusIcon = parent.$slots.statusIcon;\n      let resultIcon: TNodeReturnValue = this.getIcon(statusIcon, slotStatusIcon);\n      if (resultIcon) return resultIcon;\n      if (resultIcon === false) return;\n      resultIcon = this.getIcon(parentStatusIcon, parentSlotStatusIcon);\n      if (resultIcon) return resultIcon;\n    },\n    getEmptyValue(): ValueType {\n      const parent = this.form;\n      const type = Object.prototype.toString.call(lodashGet(parent.data, this.name));\n      let emptyValue: ValueType;\n      if (type === '[object Array]') {\n        emptyValue = [];\n      }\n      if (type === '[object Object]') {\n        emptyValue = {};\n      }\n      return emptyValue;\n    },\n    resetField(): void {\n      const parent = this.form;\n      if (!this.name) {\n        return;\n      }\n      if (parent.resetType === 'empty') {\n        lodashSet(parent.data, this.name, this.getEmptyValue());\n      }\n      if (parent.resetType === 'initial') {\n        lodashSet(parent.data, this.name, this.initialValue);\n      }\n      nextTick(() => {\n        if (this.resetValidating) {\n          this.needResetField = true;\n        } else {\n          this.resetHandler();\n        }\n      });\n    },\n    resetHandler(): void {\n      this.needResetField = false;\n      this.errorList = [];\n      this.successList = [];\n      this.verifyStatus = ValidateStatus.TO_BE_VALIDATED;\n    },\n  },\n\n  render(): VNode {\n    return (\n      <div class={this.classes}>\n        {this.getLabel()}\n        <div class={this.contentClasses} style={this.contentStyle}>\n          <div class={CLASS_NAMES.controlsContent}>\n            {this.$slots.default ? this.$slots.default() : null}\n            {this.getSuffixIcon()}\n          </div>\n          {this.renderTipsInfo()}\n        </div>\n      </div>\n    );\n  },\n});\n"],"names":["ValidateStatus","ValidateStatus2","defineComponent","mixins","getConfigReceiverMixins","name","inject","form","props","data","errorList","successList","verifyStatus","resetValidating","needResetField","initialValue","computed","classes","CLASS_NAMES","formItem","FORM_ITEM_CLASS_PREFIX","formItemWithHelp","help","formItemWithExtra","renderTipsInfo","labelClasses","parent","labelAlign","isNil","labelWidth","label","prefix","needRequiredMark","hasColon","errorClasses","showErrorMessage","successBorder","success","join","length","type","error","warning","contentClasses","getErrorClass","controls","contentStyle","marginLeft","value","lodashGet","colon","getLabelContent","requiredMark","$props","parentRequiredMark","global","isRequired","innerRules","filter","rule","required","Boolean","rules","watch","validate","mounted","cloneDeep","children","push","beforeUnmount","index","findIndex","item","splice","methods","trigger","r","result","message","resetHandler","h","$slots","getLabel","Number","labelStyle","width","helpVNode","list","extra","getDefaultIcon","resultIcon","Icon","status","CheckCircleFilledIcon","icon","CloseCircleFilledIcon","ErrorCircleFilledIcon","getIcon","statusIcon","slotStatusIcon","otherContent","withoutIcon","getSuffixIcon","parentStatusIcon","parentSlotStatusIcon","getEmptyValue","Object","prototype","toString","call","emptyValue","resetField","resetType","lodashSet","nextTick","render","controlsContent"],"mappings":"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"}