{"version":3,"file":"dropdown-menu.js","sources":["../../src/dropdown/dropdown-menu.tsx"],"sourcesContent":["import { defineComponent, VNode } from 'vue';\nimport DropdownItem from './dropdown-item';\nimport { prefix } from '../config';\nimport { DropdownOption } from './type';\nimport { TNodeReturnValue } from '../common';\nimport { renderTNodeJSX } from '../utils/render-tnode';\nimport { pxCompat } from '../utils/helper';\nimport { emitEvent } from '../utils/event';\n\nconst name = `${prefix}-dropdown__menu`;\n\nexport default defineComponent({\n  name: 'TDropdownMenu',\n  components: {\n    DropdownItem,\n  },\n  inject: {\n    dropdown: {\n      default: undefined,\n    },\n  },\n  props: {\n    options: {\n      type: Array,\n      default: (): [] => [],\n    },\n    maxHeight: {\n      type: Number,\n      default: 300,\n    },\n    maxColumnWidth: {\n      type: Number,\n      default: 100,\n    },\n    minColumnWidth: {\n      type: Number,\n      default: 10,\n    },\n  },\n  emits: ['click'],\n  data() {\n    return {\n      path: '', // 当前选中路径，形如{/id1/id2/id3}\n    };\n  },\n  methods: {\n    isActive(item: DropdownOption, pathPrefix: string, excludeSelf = true): boolean {\n      const itemPath = `${pathPrefix}/${item.value}`;\n      if (excludeSelf && this.path === itemPath) {\n        return false;\n      }\n      return this.path.indexOf(itemPath) === 0;\n    },\n    handleHoverItem(path: string) {\n      this.path = path;\n    },\n    handleItemClick(data: DropdownOption, context: { e: MouseEvent }, idx: number) {\n      (this.options as DropdownOption[])[idx].onClick?.(data, context);\n      emitEvent(this, 'click', data, context);\n    },\n    renderMenuColumn(children: Array<DropdownOption>, showSubmenu: boolean, pathPrefix: string): VNode {\n      const menuClass = [`${name}-column`, 'narrow-scrollbar', { submenu__visible: showSubmenu }];\n      const { maxHeight, maxColumnWidth, minColumnWidth } = this.dropdown;\n      return (\n        <div\n          class={menuClass}\n          style={{\n            maxHeight: `${maxHeight}px`,\n            maxWidth: pxCompat(maxColumnWidth),\n            minWidth: pxCompat(minColumnWidth),\n          }}\n        >\n          {children.map((item, idx) => (\n            <DropdownItem\n              key={idx}\n              disabled={item.disabled}\n              active={this.isActive(item, pathPrefix) || item.active}\n              value={item.value}\n              content={item.content}\n              divider={item.divider}\n              hasChildren={item.children && item.children.length > 0}\n              path={`${pathPrefix}/${item.value}`}\n              maxColumnWidth={this.maxColumnWidth}\n              minColumnWidth={this.minColumnWidth}\n              onClick={(data: DropdownOption, context: { e: MouseEvent }) => this.handleItemClick(data, context, idx)}\n              onHover={this.handleHoverItem}\n            />\n          ))}\n        </div>\n      );\n    },\n  },\n  render() {\n    const columns: TNodeReturnValue[] = [];\n    let menuItems = this.options as DropdownOption[];\n    let pathPrefix = '';\n    if (this.$slots.default) {\n      return (\n        <div class={name}>\n          <div\n            class={[`${name}-column`, 'narrow-scrollbar']}\n            style={{\n              maxHeight: `${this.dropdown.maxHeight}px`,\n              maxWidth: `${this.dropdown.maxColumnWidth}px`,\n              minWidth: `${this.dropdown.minColumnWidth}px`,\n            }}\n          >\n            {renderTNodeJSX(this, 'default')}\n          </div>\n        </div>\n      );\n    }\n    // 根据path渲染\n    while (menuItems && menuItems.length) {\n      // eslint-disable-next-line no-loop-func\n      const activeItem = menuItems.find((item) => this.isActive(item, pathPrefix, false));\n\n      columns.push(this.renderMenuColumn(menuItems, !!activeItem, pathPrefix));\n\n      if (activeItem) {\n        pathPrefix = `${pathPrefix}/${activeItem.value}`;\n        menuItems = activeItem.children || [];\n      } else {\n        menuItems = [];\n      }\n    }\n    return <div class={name}>{columns}</div>;\n  },\n});\n"],"names":["name","prefix","defineComponent","components","DropdownItem","inject","dropdown","props","options","type","Array","maxHeight","Number","maxColumnWidth","minColumnWidth","emits","data","path","methods","isActive","item","pathPrefix","excludeSelf","itemPath","value","indexOf","handleHoverItem","handleItemClick","context","idx","onClick","emitEvent","renderMenuColumn","children","showSubmenu","menuClass","submenu__visible","maxWidth","pxCompat","minWidth","map","disabled","active","content","divider","length","render","columns","menuItems","$slots","renderTNodeJSX","activeItem","find","push"],"mappings":"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"}