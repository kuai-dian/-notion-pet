{"version":3,"file":"useTagScroll.js","sources":["../../src/tag-input/useTagScroll.ts"],"sourcesContent":["/**\n * 当标签数量过多时，输入框显示不下，则需要滚动查看，以下为滚动逻辑\n * 如果标签过多时的处理方式，是标签省略，则不需要此功能\n */\n\nimport { onMounted, onUnmounted, ref, Ref } from 'vue';\nimport { TdTagInputProps } from './type';\nimport { on, off } from '../utils/dom';\n\nexport default function useTagScroll(props: TdTagInputProps, root: Ref<any>) {\n  // 允许向右滚动的最大距离\n  const scrollDistance = ref(0);\n  const scrollElement = ref<HTMLElement>(null);\n  const wheelTimer = ref();\n  const mouseEnterTimer = ref();\n\n  const setScrollElement = (element: HTMLElement) => {\n    scrollElement.value = element;\n  };\n\n  const setScrollDistance = () => {\n    scrollDistance.value = scrollElement.value.scrollWidth - scrollElement.value.clientWidth;\n  };\n\n  const scrollTo = (distance: number) => {\n    scrollElement?.value.scroll({ left: distance, behavior: 'smooth' });\n  };\n\n  const scrollToRight = () => {\n    setScrollDistance();\n    scrollTo(scrollDistance.value);\n  };\n\n  const scrollToLeft = () => {\n    scrollTo(0);\n  };\n\n  const clearTimer = (timer: Ref<any>) => {\n    clearTimeout(timer.value);\n    timer.value = null;\n  };\n\n  // TODO：MAC 电脑横向滚动，Windows 纵向滚动。当前只处理了横向滚动\n  const onWheel = (e: WheelEvent) => {\n    if (!scrollElement.value || wheelTimer.value) return;\n    if (e.deltaX > 0) {\n      const distance = Math.min(scrollElement.value.scrollLeft + 120, scrollDistance.value);\n      scrollTo(distance);\n    } else {\n      const distance = Math.max(scrollElement.value.scrollLeft - 120, 0);\n      scrollTo(distance);\n    }\n    wheelTimer.value = setTimeout(() => {\n      clearTimer(wheelTimer);\n    }, 300);\n  };\n\n  // 鼠标 hover，自动滑动到最右侧，以便输入新标签\n  const scrollToRightOnEnter = () => {\n    if (props.excessTagsDisplayType !== 'scroll') return;\n    // 一闪而过的 mousenter 不需要执行\n    mouseEnterTimer.value = setTimeout(() => {\n      scrollToRight();\n      clearTimer(mouseEnterTimer);\n    }, 100);\n  };\n\n  const scrollToLeftOnLeave = () => {\n    if (props.excessTagsDisplayType !== 'scroll') return;\n    scrollTo(0);\n    clearTimer(mouseEnterTimer);\n  };\n\n  const addListeners = (element: HTMLElement) => {\n    if (props.readonly || props.disabled) return;\n    on(element, 'mousewheel', onWheel);\n  };\n\n  const removeListeners = (element: HTMLElement) => {\n    if (props.readonly || props.disabled) return;\n    off(element, 'mousewheel', onWheel);\n  };\n\n  onMounted(() => {\n    const element = root.value?.$el;\n    setScrollElement(element);\n    addListeners(element);\n  });\n\n  onUnmounted(() => {\n    clearTimer(wheelTimer);\n    clearTimer(mouseEnterTimer);\n    removeListeners(root.value?.$el);\n  });\n\n  return {\n    scrollElement,\n    scrollDistance,\n    scrollTo,\n    scrollToRight,\n    scrollToLeft,\n    setScrollElement,\n    setScrollDistance,\n    onWheel,\n    addListeners,\n    removeListeners,\n    scrollToRightOnEnter,\n    scrollToLeftOnLeave,\n  };\n}\n"],"names":["useTagScroll","props","root","scrollDistance","ref","scrollElement","wheelTimer","mouseEnterTimer","setScrollElement","element","value","setScrollDistance","scrollWidth","clientWidth","scrollTo","distance","scroll","left","behavior","scrollToRight","scrollToLeft","clearTimer","timer","clearTimeout","onWheel","e","deltaX","Math","min","scrollLeft","max","setTimeout","scrollToRightOnEnter","excessTagsDisplayType","scrollToLeftOnLeave","addListeners","readonly","disabled","on","removeListeners","off","onMounted","$el","onUnmounted"],"mappings":"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"}