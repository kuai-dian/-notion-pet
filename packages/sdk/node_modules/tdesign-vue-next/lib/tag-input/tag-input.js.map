{"version":3,"file":"tag-input.js","sources":["../../src/tag-input/tag-input.tsx"],"sourcesContent":["import { defineComponent, ref, nextTick, computed } from 'vue';\nimport { CloseCircleFilledIcon } from 'tdesign-icons-vue-next';\nimport { prefix } from '../config';\nimport TInput, { InputValue } from '../input';\nimport { TdTagInputProps } from './type';\nimport Tag from '../tag';\nimport props from './props';\nimport { renderTNodeJSX } from '../utils/render-tnode';\nimport useTagScroll from './useTagScroll';\nimport useTagList from './useTagList';\nimport useHover from './useHover';\n\nconst NAME_CLASS = `${prefix}-tag-input`;\nconst CLEAR_CLASS = `${prefix}-tag-input__suffix-clear`;\nconst BREAK_LINE_CLASS = `${prefix}-tag-input--break-line`;\n\nexport default defineComponent({\n  name: 'TTagInput',\n\n  props: { ...props },\n\n  setup(props: TdTagInputProps, context) {\n    const root = ref(null);\n    const inputValueRef = ref<InputValue>();\n    const { isHoverRef, addHover, cancelHover } = useHover(props);\n    const scrollFunctions = useTagScroll(props, root);\n    // handle tag add and remove\n    const { tagValue, onClose, onInnerEnter, onInputBackspaceKeyUp, clearAll } = useTagList(props, context);\n\n    const classes = computed(() => {\n      return [\n        NAME_CLASS,\n        {\n          [BREAK_LINE_CLASS]: props.excessTagsDisplayType === 'break-line',\n        },\n      ];\n    });\n\n    const tagInputPlaceholder = computed(() => {\n      return isHoverRef.value || !tagValue.value?.length ? props.placeholder : '';\n    });\n\n    const showClearIcon = computed(() => {\n      return Boolean(\n        !props.readonly && !props.disabled && props.clearable && isHoverRef.value && tagValue.value?.length,\n      );\n    });\n\n    const onInputEnter = (value: InputValue, context: { e: KeyboardEvent }) => {\n      inputValueRef.value = '';\n      onInnerEnter(value, context);\n      nextTick(() => {\n        scrollFunctions.scrollToRight();\n      });\n    };\n\n    return {\n      tagValue,\n      root,\n      inputValueRef,\n      isHoverRef,\n      tagInputPlaceholder,\n      showClearIcon,\n      addHover,\n      cancelHover,\n      ...scrollFunctions,\n      onInputEnter,\n      onClose,\n      onInnerEnter,\n      onInputBackspaceKeyUp,\n      clearAll,\n      classes,\n    };\n  },\n\n  methods: {\n    renderLabel() {\n      const displayNode = renderTNodeJSX(this, 'valueDisplay', { params: { value: this.tagValue } });\n      const newList = this.minCollapsedNum ? this.tagValue.slice(0, this.minCollapsedNum) : this.tagValue;\n      const list =\n        displayNode ??\n        newList?.map((item, index) => {\n          const tagContent = renderTNodeJSX(this, 'tag', { params: { value: item } });\n          return (\n            <Tag\n              size={this.size}\n              disabled={this.disabled}\n              onClose={(context: { e: MouseEvent }) => this.onClose({ e: context.e, item, index })}\n              closable={!this.readonly && !this.disabled}\n              {...this.tagProps}\n            >\n              {tagContent ?? item}\n            </Tag>\n          );\n        });\n      // 左侧文本\n      const label = renderTNodeJSX(this, 'label');\n      if (![null, undefined, ''].includes(label)) {\n        list.unshift(<div class={`${prefix}-tag-input__prefix`}>{label}</div>);\n      }\n      // 超出省略\n      if (newList.length !== this.tagValue.length) {\n        const len = this.tagValue.length - newList.length;\n        const more = renderTNodeJSX(this, 'collapsedItems', {\n          params: {\n            value: this.tagValue,\n            count: this.tagValue.length,\n            collapsedTags: this.tagValue.slice(this.minCollapsedNum, this.tagValue.length),\n          },\n        });\n        list.push(more ?? <Tag>+{len}</Tag>);\n      }\n      return list;\n    },\n\n    renderSuffixIcon() {\n      const suffixIcon = renderTNodeJSX(this, 'suffixIcon');\n      if (this.showClearIcon) {\n        return <CloseCircleFilledIcon class={CLEAR_CLASS} onClick={this.clearAll} />;\n      }\n      return suffixIcon;\n    },\n  },\n\n  render() {\n    return (\n      <TInput\n        ref=\"root\"\n        {...this.inputProps}\n        value={this.inputValueRef}\n        onChange={(val: InputValue) => {\n          this.inputValueRef = val;\n        }}\n        size={this.size}\n        readonly={this.readonly}\n        disabled={this.disabled}\n        label={this.renderLabel}\n        class={this.classes}\n        tips={this.tips}\n        status={this.status}\n        placeholder={this.tagInputPlaceholder}\n        suffix={this.suffix}\n        suffixIcon={this.renderSuffixIcon}\n        onPaste={this.onPaste}\n        onEnter={this.onInputEnter}\n        onKeyup={this.onInputBackspaceKeyUp}\n        onMouseenter={(context: { e: MouseEvent }) => {\n          this.addHover(context);\n          this.scrollToRightOnEnter();\n        }}\n        onMouseleave={(context: { e: MouseEvent }) => {\n          this.cancelHover(context);\n          this.scrollToLeftOnLeave();\n        }}\n        onFocus={(inputValue: InputValue, context: { e: MouseEvent }) => {\n          this.onFocus?.(this.tagValue, { e: context.e, inputValue });\n        }}\n        onBlur={(inputValue: InputValue, context: { e: MouseEvent }) => {\n          this.onBlur?.(this.tagValue, { e: context.e, inputValue });\n        }}\n      />\n    );\n  },\n});\n"],"names":["NAME_CLASS","prefix","CLEAR_CLASS","BREAK_LINE_CLASS","defineComponent","name","props","setup","props2","context","root","ref","inputValueRef","useHover","isHoverRef","addHover","cancelHover","scrollFunctions","useTagScroll","useTagList","tagValue","onClose","onInnerEnter","onInputBackspaceKeyUp","clearAll","classes","computed","excessTagsDisplayType","tagInputPlaceholder","value","length","placeholder","showClearIcon","Boolean","readonly","disabled","clearable","onInputEnter","context2","nextTick","scrollToRight","methods","renderLabel","displayNode","renderTNodeJSX","params","newList","minCollapsedNum","slice","list","map","item","index","tagContent","size","e","tagProps","label","includes","unshift","len","more","count","collapsedTags","push","renderSuffixIcon","suffixIcon","render","inputProps","val","tips","status","suffix","onPaste","scrollToRightOnEnter","scrollToLeftOnLeave","inputValue","onFocus","onBlur"],"mappings":"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"}