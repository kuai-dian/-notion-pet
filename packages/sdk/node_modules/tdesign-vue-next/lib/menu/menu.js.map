{"version":3,"file":"menu.js","sources":["../../src/menu/menu.tsx"],"sourcesContent":["import { defineComponent, ref, computed, provide, watchEffect, watch, onMounted } from 'vue';\nimport { useEmitEvent } from '../hooks/event';\nimport { prefix } from '../config';\nimport props from './props';\nimport { MenuValue } from './type';\nimport { TdMenuInterface, TdOpenType } from './const';\nimport { renderContent, renderTNodeJSX } from '../utils/render-tnode';\nimport VMenu from './v-menu';\nimport { ClassName } from '../common';\nimport log from '../_common/js/log/log';\n\nexport default defineComponent({\n  name: 'TMenu',\n  props: { ...props },\n  emits: ['collapsed', 'change', 'expand'],\n  setup(props, ctx) {\n    const emitEvent = useEmitEvent(props, ctx.emit);\n    watchEffect(() => {\n      if (ctx.slots.options) {\n        log.warnOnce('TMenu', '`options` slot is going to be deprecated, please use `operations` for slot instead.');\n      }\n    });\n    const mode = ref(props.expandType);\n    const theme = computed(() => props.theme);\n    const isMutex = computed(() => props.expandMutex);\n    const menuClass = computed(() => [\n      `${prefix}-default-menu`,\n      `${prefix}-menu--${props.theme}`,\n      {\n        [`${prefix}-is-collapsed`]: props.collapsed,\n      },\n    ]);\n    const innerClasses = computed(() => [\n      `${prefix}-menu`,\n      { [`${prefix}-menu--scroll`]: mode.value !== 'popup' },\n      'narrow-scrollbar',\n    ]);\n    const expandWidth = typeof props.width === 'number' ? `${props.width}px` : props.width;\n    const styles: ClassName = computed(() => ({\n      height: '100%',\n      width: props.collapsed ? '64px' : expandWidth,\n    }));\n\n    const activeValue = ref(props.defaultValue || props.value);\n    const activeValues = ref([]);\n    const expandValues = ref(props.expanded || []);\n\n    watchEffect(() => {\n      mode.value = props.collapsed ? 'popup' : 'normal';\n      emitEvent('collapsed', mode.value);\n    });\n\n    const vMenu = new VMenu({ isMutex: isMutex.value, expandValues: expandValues.value });\n    provide<TdMenuInterface>('TdMenu', {\n      activeValue,\n      activeValues,\n      expandValues,\n      mode,\n      theme,\n      isHead: false,\n      vMenu,\n      select: (value: MenuValue) => {\n        activeValue.value = value;\n        emitEvent('change', value);\n      },\n      open: (value: MenuValue, type: TdOpenType) => {\n        if (mode.value === 'normal') {\n          expandValues.value = vMenu.expand(value);\n        } else if (type === 'add') {\n          if (expandValues.value.indexOf(value) === -1) {\n            // 可能初始expanded里包含了该value\n            expandValues.value.push(value);\n          }\n        } else if (type === 'remove') {\n          const index = expandValues.value.indexOf(value);\n          expandValues.value.splice(index, 1);\n        }\n        emitEvent('expand', expandValues.value);\n      },\n    });\n\n    // watch\n    watch(\n      () => props.expanded,\n      (value) => {\n        expandValues.value = value;\n        vMenu.expandValues = new Set(value);\n      },\n    );\n    const updateActiveValues = (value: MenuValue) => {\n      activeValue.value = value;\n      activeValues.value = vMenu.select(value);\n    };\n    watch(() => props.value, updateActiveValues);\n    watch(() => props.defaultValue, updateActiveValues);\n\n    // timelifes\n    onMounted(() => {\n      activeValues.value = vMenu.select(activeValue.value);\n    });\n\n    return {\n      styles,\n      menuClass,\n      innerClasses,\n      activeValue,\n      activeValues,\n      expandValues,\n    };\n  },\n  render() {\n    const operations = renderContent(this, 'operations', 'options');\n    const logo = renderTNodeJSX(this, 'logo');\n    return (\n      <div class={this.menuClass} style={this.styles}>\n        <div class={`${prefix}-default-menu__inner`}>\n          {logo && <div class={`${prefix}-menu__logo`}>{logo}</div>}\n          <ul class={this.innerClasses}>{renderContent(this, 'default', 'content')}</ul>\n          {operations && <div class={`${prefix}-menu__operations`}>{operations}</div>}\n        </div>\n      </div>\n    );\n  },\n});\n"],"names":["defineComponent","name","props","emits","setup","props2","ctx","emitEvent","useEmitEvent","emit","watchEffect","slots","options","log","warnOnce","mode","ref","expandType","theme","computed","isMutex","expandMutex","menuClass","prefix","collapsed","innerClasses","value","expandWidth","width","styles","height","activeValue","defaultValue","activeValues","expandValues","expanded","vMenu","VMenu","provide","isHead","select","open","type","expand","indexOf","push","index","splice","watch","Set","updateActiveValues","onMounted","render","operations","renderContent","logo","renderTNodeJSX"],"mappings":"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"}