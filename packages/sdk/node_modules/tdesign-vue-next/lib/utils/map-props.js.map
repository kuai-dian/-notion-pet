{"version":3,"file":"map-props.js","sources":["../../src/utils/map-props.ts"],"sourcesContent":["import { ComponentOptions, defineComponent, ComponentPublicInstance, h } from 'vue';\nimport kebabCase from 'lodash/kebabCase';\n\nfunction toCamel(str: string): string {\n  return str.replace(/-([a-z])/gi, (m, letter) => letter.toUpperCase());\n}\n\ntype PropOption = {\n  name: string;\n  event?: string | string[];\n  alias?: string[];\n};\n\ntype ParsedPropOption = {\n  defaultName: string;\n  dataName: string;\n  events: string[];\n  alias?: string[];\n  [propName: string]: any;\n};\n\nfunction getPropOptionMap(props: (string | PropOption)[]): { [name: string]: ParsedPropOption } {\n  const propOptionMap = {};\n\n  function parseProp(propOption: PropOption): ParsedPropOption {\n    const { name: propName, alias, ...others } = propOption;\n    const camelName = propName.replace(/^[a-z]/, (letter: string) => letter.toUpperCase());\n    const defaultName = `default${camelName}`;\n    const dataName = `data${camelName}`;\n\n    let events: string[] = [];\n    if (propOption.event) {\n      events = events.concat(propOption.event);\n    }\n    events.push(`update:${propName}`);\n    if (alias) {\n      events = events.concat(alias.map((item) => `update:${item}`));\n    }\n\n    return {\n      events,\n      defaultName,\n      dataName,\n      alias,\n      ...others,\n    };\n  }\n\n  props.forEach((prop: string | PropOption) => {\n    const defaultOption = {\n      alias: [] as string[],\n    };\n    let propOption: PropOption;\n    if (typeof prop === 'string') {\n      propOption = { ...defaultOption, name: prop };\n    } else {\n      propOption = { ...defaultOption, ...prop };\n    }\n\n    propOptionMap[propOption.name] = parseProp(propOption);\n  });\n\n  return propOptionMap;\n}\n\nexport default function (props: (string | PropOption)[]): any {\n  function mapProps(componentConstructor: ComponentPublicInstance): any {\n    const component: ComponentOptions<ComponentPublicInstance> = componentConstructor;\n    const propOptionMap = getPropOptionMap(props);\n\n    const defineProps: Record<string, any> = { ...component.props };\n    const defineWatches = {};\n    let defineEvents: string[] = [];\n    const defineMethods = {};\n\n    const camelPropsKeys = Object.keys(component.props).map((key) => toCamel(key));\n\n    Object.keys(propOptionMap).forEach((propName) => {\n      const { events, alias, defaultName, dataName } = propOptionMap[propName];\n\n      defineProps[propName] = component.props[propName];\n      defineProps[defaultName] = component.props[defaultName];\n      if (alias) {\n        alias.forEach((prop: string) => {\n          defineProps[prop] = defineProps[propName];\n        });\n      }\n      defineEvents = defineEvents.concat(events);\n\n      // does not destroy the original defaultValue logic\n      const defaultList: string[] = [];\n\n      // watch default prop\n      defineWatches[defaultName] = {\n        handler(v: any): void {\n          if (defaultList.indexOf(defaultName + this.$.uid) > -1) return;\n          const { props } = this.$.vnode;\n          const hasDefault = props && (defaultName in props || kebabCase(defaultName) in props);\n          if (hasDefault && !(propName in props)) {\n            this.$data[dataName] = v;\n          }\n          defaultList.push(defaultName + this.$.uid);\n        },\n        immediate: true,\n      };\n\n      // watch alias\n      alias.forEach((aliasItem) => {\n        defineWatches[aliasItem] = {\n          handler(v: any): void {\n            const { props } = this.$.vnode;\n            if (props && aliasItem in props && !(propName in props)) {\n              this.$data[dataName] = v;\n            }\n          },\n          immediate: true,\n        };\n      });\n\n      // watch prop\n      defineWatches[propName] = {\n        handler(v: any): void {\n          const { props } = this.$.vnode;\n          if (props && (propName in props || kebabCase(propName) in props)) {\n            this.$data[dataName] = v;\n          }\n        },\n        immediate: true,\n      };\n    });\n    if (component.methods) {\n      Object.keys(component.methods).forEach((key) => {\n        defineMethods[key] = function (this: any, ...args: any[]): any {\n          if (this.$refs.component) {\n            return this.$refs.component[key](...args);\n          }\n        };\n      });\n    }\n\n    const { name } = component;\n    return defineComponent({\n      name: `${name}-mapprops`,\n      inheritAttrs: false,\n      props: {\n        ...defineProps,\n      },\n      data() {\n        const data = {};\n        Object.keys(propOptionMap).forEach((propName: string): void => {\n          const { dataName } = propOptionMap[propName];\n          data[dataName] = undefined;\n        });\n        return { ...data };\n      },\n      computed: {\n        _listeners(): Record<string, any> {\n          const others = {};\n          Object.keys(this.$attrs).forEach((attr: string): void => {\n            const event = attr.startsWith('on') ? attr[2].toLowerCase() + attr.substr(2) : null;\n            if (event && defineEvents.indexOf(event) === -1) {\n              others[attr] = (...args: any[]): void => {\n                // (this.$listeners[event] as Function)(...args);\n                this.$emit(event, ...args);\n              };\n            }\n          });\n          return others;\n        },\n      },\n      watch: defineWatches,\n      methods: {\n        updateData(this: any, propName: string, v: any, ...args: any[]): any {\n          propOptionMap[propName].events.forEach((event) => {\n            this.$emit(event, v, ...args);\n          });\n          const { props } = this.$.vnode;\n          if (!props || !(propName in props)) {\n            this[propOptionMap[propName].dataName] = v;\n            return true;\n          }\n        },\n        ...defineMethods,\n      },\n      render() {\n        const propMap = {};\n        const handlerMap = {};\n\n        Object.keys(propOptionMap).forEach((propName: string): void => {\n          const { dataName, events } = propOptionMap[propName];\n          const eventName = `on${events[0].charAt(0).toUpperCase()}${events[0].substr(1)}`;\n          const { props } = this.$.vnode;\n          if ((props && propName in props) || typeof this[dataName] !== 'undefined') {\n            propMap[propName] = this[dataName];\n          }\n          // 只监听第一个定义的事件，参数取第一个事件参数\n          handlerMap[eventName] = (v: any, ...args: any[]): any => this.updateData(propName, v, ...args);\n        });\n\n        const attrs = {};\n        Object.keys(this.$attrs).forEach((attrName) => {\n          const camelAttrKey = toCamel(attrName);\n          if (camelPropsKeys.indexOf(camelAttrKey) === -1) {\n            attrs[attrName] = this.$attrs[attrName];\n          }\n        });\n\n        return h(\n          componentConstructor,\n          {\n            // props\n            ...this.$props,\n            ...propMap,\n\n            // attrs\n            ...attrs,\n\n            // events\n            ...(this._listeners as Record<string, any>),\n            ...handlerMap,\n\n            ref: 'component',\n          },\n          this.$slots,\n        );\n      },\n    });\n  }\n\n  return mapProps;\n}\n"],"names":["toCamel","str","replace","m","letter","toUpperCase","getPropOptionMap","props","propOptionMap","parseProp","propOption","propName","name","alias","others","camelName","defaultName","dataName","events","event","concat","push","map","item","forEach","prop","defaultOption","mapProps","componentConstructor","component","defineProps","defineWatches","defineEvents","defineMethods","camelPropsKeys","Object","keys","key","defaultList","handler","v","indexOf","$","uid","props2","vnode","hasDefault","kebabCase","$data","immediate","aliasItem","methods","$refs","defineComponent","inheritAttrs","data","computed","_listeners","$attrs","attr","startsWith","toLowerCase","substr","args","$emit","watch","updateData","render","propMap","handlerMap","eventName","charAt","attrs","attrName","camelAttrKey","h","$props","ref","$slots"],"mappings":"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"}