{"version":3,"file":"plugin.js","sources":["../../src/message/plugin.tsx"],"sourcesContent":["/**\n * Vue.prototype.$message = MessagePlugin;\n *\n * this.$message({ theme: 'info', default: '这是信息', duration: 3000 })\n * this.$message.info('这是信息')\n * this.$message.info('这是信息', 3000)\n * this.$message.info({ content: '这是信息', duration: 3000 })\n * this.$message.success({ content: '这是信息', duration: 3000 })\n * this.$message.warning()\n * this.$message.error()\n * this.$message.question()\n * this.$message.loading()\n * 上述函数返回值：promise: Promise<{close: Function}>\n *\n * // close all message\n * this.$message.closeAll()\n *\n * // close one message. 参数 p 为 this.$message 系列函数返回值，promise: Promise<{close: Function}>\n * this.$message.close(p)\n *\n * // close one message.\n * const msg = this.$message.info({ content: '这是信息', duration: 0 })\n * msg.then(instance => instance.close())\n *\n */\nimport { App, createApp, nextTick, Plugin, ComponentPublicInstance } from 'vue';\nimport MessageList, { DEFAULT_Z_INDEX } from './messageList';\nimport { getAttach } from '../utils/dom';\nimport {\n  MessageOptions,\n  MessageMethod,\n  MessageInstance,\n  MessageInfoMethod,\n  MessageErrorMethod,\n  MessageWarningMethod,\n  MessageSuccessMethod,\n  MessageLoadingMethod,\n  MessageQuestionMethod,\n  MessageCloseMethod,\n  MessageCloseAllMethod,\n} from './type';\nimport { AttachNodeReturnValue } from '../common';\n\n// 存储不同 attach 和 不同 placement 消息列表实例\nconst instanceMap: Map<AttachNodeReturnValue, Record<string, ComponentPublicInstance>> = new Map();\n\nfunction handleParams(params: MessageOptions): MessageOptions {\n  const options: MessageOptions = {\n    duration: 3000,\n    attach: 'body',\n    zIndex: DEFAULT_Z_INDEX,\n    placement: 'top',\n    ...params,\n  };\n  options.content = params.content;\n  return options;\n}\n\nconst MessageFunction = (props: MessageOptions): Promise<MessageInstance> => {\n  const options = handleParams(props);\n  const { attach, placement } = options;\n  const attachDom = getAttach(attach);\n  if (!instanceMap.get(attachDom)) {\n    instanceMap.set(attachDom, {});\n  }\n  const p = instanceMap.get(attachDom)[placement];\n  if (!p) {\n    const wrapper = document.createElement('div');\n\n    const instance = createApp(MessageList, {\n      zIndex: options.zIndex,\n      placement: options.placement,\n    }).mount(wrapper);\n\n    instance.add(options);\n    instanceMap.get(attachDom)[placement] = instance;\n    attachDom.appendChild(wrapper);\n  } else {\n    p.add(options);\n  }\n  // 返回最新消息的 Element\n  return new Promise((resolve) => {\n    const ins = instanceMap.get(attachDom)[placement];\n    nextTick(() => {\n      const msg: Array<MessageInstance> = ins.messageList;\n      resolve(msg[msg.length - 1]);\n    });\n  });\n};\n\nconst showThemeMessage: MessageMethod = (theme, params, duration) => {\n  let options: MessageOptions = { theme };\n  if (typeof params === 'string') {\n    options.content = params;\n  } else if (typeof params === 'object' && !(params instanceof Array)) {\n    options = { ...options, ...params };\n  }\n  (duration || duration === 0) && (options.duration = duration);\n  return MessageFunction(options);\n};\n\ninterface ExtraApi {\n  info: MessageInfoMethod;\n  success: MessageSuccessMethod;\n  warning: MessageWarningMethod;\n  error: MessageErrorMethod;\n  question: MessageQuestionMethod;\n  loading: MessageLoadingMethod;\n  close: MessageCloseMethod;\n  closeAll: MessageCloseAllMethod;\n}\n\nexport type MessagePluginType = Plugin & ExtraApi & MessageMethod;\n\nconst extraApi: ExtraApi = {\n  info: (params, duration) => showThemeMessage('info', params, duration),\n  success: (params, duration) => showThemeMessage('success', params, duration),\n  warning: (params, duration) => showThemeMessage('warning', params, duration),\n  error: (params, duration) => showThemeMessage('error', params, duration),\n  question: (params, duration) => showThemeMessage('question', params, duration),\n  loading: (params, duration) => showThemeMessage('loading', params, duration),\n  close: (promise) => {\n    promise.then((instance) => instance.close());\n  },\n  closeAll: () => {\n    if (instanceMap instanceof Map) {\n      instanceMap.forEach((attach) => {\n        Object.keys(attach).forEach((placement) => {\n          const instance = attach[placement];\n          instance.list = [];\n        });\n      });\n    }\n  },\n};\n\nconst MessagePlugin: MessagePluginType = showThemeMessage as MessagePluginType;\n\nMessagePlugin.install = (app: App): void => {\n  app.config.globalProperties.$message = showThemeMessage;\n  // 这样定义后，可以通过 this.$message 调用插件\n  Object.keys(extraApi).forEach((funcName) => {\n    app.config.globalProperties.$message[funcName] = extraApi[funcName];\n  });\n};\n\n/**\n * 这样定义后，用户可以直接引入方法然后调用，示例如下：\n * import { showMessage } from 'message/index.ts';\n * showMessage();\n */\nObject.keys(extraApi).forEach((funcName) => {\n  MessagePlugin[funcName] = extraApi[funcName];\n});\n\nexport default MessagePlugin;\n"],"names":["instanceMap","Map","handleParams","params","options","duration","attach","zIndex","DEFAULT_Z_INDEX","placement","content","MessageFunction","props","attachDom","getAttach","get","set","p","wrapper","document","createElement","instance","createApp","MessageList","mount","add","appendChild","Promise","resolve","ins","nextTick","msg","messageList","length","showThemeMessage","theme","_typeof","Array","extraApi","info","success","warning","error","question","loading","close","promise","then","closeAll","forEach","Object","keys","list","MessagePlugin","install","app","config","globalProperties","$message","funcName"],"mappings":"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"}