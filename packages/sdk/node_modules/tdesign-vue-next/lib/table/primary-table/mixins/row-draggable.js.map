{"version":3,"file":"row-draggable.js","sources":["../../../../src/table/primary-table/mixins/row-draggable.tsx"],"sourcesContent":["import { defineComponent, VNode } from 'vue';\nimport { DataType, TdPrimaryTableProps } from '../../type';\nimport { prefix } from '../../../config';\nimport { emitEvent } from '../../../utils/event';\n\nexport interface RowDragEventArgs {\n  index: number;\n  row: any;\n  targetElm: HTMLElement;\n}\nexport default defineComponent({\n  name: `${prefix}-primary-table-row-draggable`,\n  emits: ['drag-sort'],\n  data() {\n    return {\n      draggingRowCurrentIndex: -1,\n      currentRowData: null,\n    };\n  },\n  computed: {\n    dragging(): boolean {\n      return this.draggingRowCurrentIndex !== -1;\n    },\n  },\n  methods: {\n    onDragStart({ index, row }: RowDragEventArgs) {\n      this.draggingRowCurrentIndex = index;\n      this.currentRowData = row;\n      this.addDragEndListener();\n    },\n    onDragOver({ index: overIndex, row, targetElm }: RowDragEventArgs) {\n      // target行在过渡时（即有v-move）触发了dragover事件，无需处理交换;\n      if ([...targetElm.classList].includes('v-move')) return;\n\n      const { draggingRowCurrentIndex } = this;\n      if (draggingRowCurrentIndex === -1 || draggingRowCurrentIndex === overIndex) return;\n\n      this.emitChange(this.currentRowData, row, draggingRowCurrentIndex, overIndex);\n      this.draggingRowCurrentIndex = overIndex;\n    },\n    addDragEndListener() {\n      const onDragEnd = () => {\n        this.draggingRowCurrentIndex = -1;\n        document.removeEventListener('dragend', onDragEnd);\n      };\n      document.addEventListener('dragend', onDragEnd);\n    },\n    emitChange(current: DataType, target: DataType, currentIndex: number, targetIndex: number) {\n      emitEvent<Parameters<TdPrimaryTableProps['onDragSort']>>(this, 'drag-sort', {\n        current,\n        target,\n        currentIndex,\n        targetIndex,\n      });\n    },\n  },\n});\n"],"names":["defineComponent","name","prefix","emits","data","draggingRowCurrentIndex","currentRowData","computed","dragging","methods","onDragStart","index","row","addDragEndListener","onDragOver","overIndex","targetElm","_toConsumableArray","classList","includes","emitChange","onDragEnd","document","removeEventListener","addEventListener","current","target","currentIndex","targetIndex","emitEvent"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAGA,mBAAeA,mBAAe,CAAC;AAC7BC,EAAAA,IAAI,YAAKC,aAAL,iCADyB;AAE7BC,EAAAA,KAAK,EAAE,CAAC,WAAD,CAFsB;AAG7BC,EAAAA,IAH6B,kBAGtB;AACL,WAAO;AACLC,MAAAA,uBAAuB,EAAE,CAAC,CADrB;AAELC,MAAAA,cAAc,EAAE;AAFX,KAAP;AAID,GAR4B;AAS7BC,EAAAA,QAAQ,EAAE;AACRC,IAAAA,QADQ,sBACG;AACT,aAAO,KAAKH,uBAAL,KAAiC,CAAC,CAAzC;AACD;AAHO,GATmB;AAc7BI,EAAAA,OAAO,EAAE;AACPC,IAAAA,WADO,6BACqB;AAAA,UAAdC,KAAc,QAAdA,KAAc;AAAA,UAAPC,GAAO,QAAPA,GAAO;AAC1B,WAAKP,uBAAL,GAA+BM,KAA/B;AACA,WAAKL,cAAL,GAAsBM,GAAtB;AACA,WAAKC,kBAAL;AACD,KALM;AAMPC,IAAAA,UANO,6BAM0C;AAAA,UAA7BC,SAA6B,SAApCJ,KAAoC;AAAA,UAAlBC,GAAkB,SAAlBA,GAAkB;AAAA,UAAbI,SAAa,SAAbA,SAAa;AAC/C,UAAIC,uCAAID,SAAS,CAACE,SAAd,EAAyBC,QAAzB,CAAkC,QAAlC,CAAJ,EACE;AACF,UAAQd,uBAAR,GAAoC,IAApC,CAAQA,uBAAR;AACA,UAAIA,uBAAuB,KAAK,CAAC,CAA7B,IAAkCA,uBAAuB,KAAKU,SAAlE,EACE;AACF,WAAKK,UAAL,CAAgB,KAAKd,cAArB,EAAqCM,GAArC,EAA0CP,uBAA1C,EAAmEU,SAAnE;AACA,WAAKV,uBAAL,GAA+BU,SAA/B;AACD,KAdM;AAePF,IAAAA,kBAfO,gCAec;AAAA;;AACnB,UAAMQ,SAAS,GAAG,SAAZA,SAAY,GAAM;AACtB,QAAA,KAAI,CAAChB,uBAAL,GAA+B,CAAC,CAAhC;AACAiB,QAAAA,QAAQ,CAACC,mBAAT,CAA6B,SAA7B,EAAwCF,SAAxC;AACD,OAHD;;AAIAC,MAAAA,QAAQ,CAACE,gBAAT,CAA0B,SAA1B,EAAqCH,SAArC;AACD,KArBM;AAsBPD,IAAAA,UAtBO,sBAsBIK,OAtBJ,EAsBaC,MAtBb,EAsBqBC,YAtBrB,EAsBmCC,WAtBnC,EAsBgD;AACrDC,MAAAA,qBAAS,CAAC,IAAD,EAAO,WAAP,EAAoB;AAC3BJ,QAAAA,OAAO,EAAPA,OAD2B;AAE3BC,QAAAA,MAAM,EAANA,MAF2B;AAG3BC,QAAAA,YAAY,EAAZA,YAH2B;AAI3BC,QAAAA,WAAW,EAAXA;AAJ2B,OAApB,CAAT;AAMD;AA7BM;AAdoB,CAAD,CAA9B;;;;"}