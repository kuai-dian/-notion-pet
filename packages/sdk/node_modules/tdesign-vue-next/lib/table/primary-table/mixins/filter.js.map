{"version":3,"file":"filter.js","sources":["../../../../src/table/primary-table/mixins/filter.tsx"],"sourcesContent":["import { defineComponent, h } from 'vue';\nimport isFunction from 'lodash/isFunction';\nimport { FilterIcon as TIconFilter } from 'tdesign-icons-vue-next';\nimport { PrimaryTableCol, TdPrimaryTableProps, FilterValue } from '../../type';\nimport primaryTableProps from '../../primary-table-props';\nimport baseTableProps from '../../base-table-props';\nimport { prefix } from '../../../config';\nimport { CheckboxGroup } from '../../../checkbox';\nimport { RadioGroup } from '../../../radio';\nimport Input from '../../../input';\nimport Popup from '../../../popup';\nimport TButton from '../../../button';\nimport { getTitle } from '../../util/common';\nimport { emitEvent } from '../../../utils/event';\nimport { renderTNodeJSXDefault } from '../../../utils/render-tnode';\n\ntype FilterChangeContext = Parameters<TdPrimaryTableProps['onFilterChange']>;\ntype ChangeContext = Parameters<TdPrimaryTableProps['onChange']>;\n\n// 筛选条件不为空，才需要显示筛选结果行\nfunction filterEmptyData(data: FilterValue) {\n  const newFilterValue: FilterValue = {};\n  Object.keys(data).forEach((key) => {\n    const item = data[key];\n    const isArrayTrue = item instanceof Array && item.length;\n    const isObject = typeof item === 'object' && !(item instanceof Array);\n    const isObjectTrue = isObject && Object.keys(item).length;\n    if (isArrayTrue || isObjectTrue || !['null', '', 'undefined'].includes(String(item))) {\n      newFilterValue[key] = item;\n    }\n  });\n  return newFilterValue;\n}\n\nexport default defineComponent({\n  name: `${prefix}-primary-table-filter`,\n  props: {\n    columns: primaryTableProps.columns,\n    pagination: baseTableProps.pagination,\n    filterValue: primaryTableProps.filterValue,\n    filterIcon: primaryTableProps.filterIcon,\n    data: baseTableProps.data,\n    filterRow: primaryTableProps.filterRow,\n  },\n  emits: ['filter-change', 'filter'],\n  data() {\n    return {\n      tableWidth: 0,\n      innerFilterValue: this.filterValue,\n      filterPopupVisible: {},\n    };\n  },\n  computed: {\n    fixedLeftColumn(): boolean {\n      return !!this.columns?.filter((col) => col.fixed === 'left').length;\n    },\n    hasFilterCondition(): boolean {\n      return !!this.columns?.filter((col) => col.filter).length;\n    },\n  },\n  watch: {\n    filterValue(val) {\n      this.innerFilterValue = { ...val };\n    },\n  },\n  mounted() {\n    // using timer for getting right width\n    let timer = setTimeout(() => {\n      this.updateTableWidth();\n      clearTimeout(timer);\n      timer = null;\n    }, 0);\n  },\n  methods: {\n    updateTableWidth() {\n      if (!this.$el) return;\n      const tbody = this.$el?.querySelector(`.${prefix}-table__body`);\n      if (tbody) {\n        this.tableWidth = tbody.clientWidth;\n      } else {\n        const el = this.$el.querySelector(`.${prefix}-table-content`);\n        el && (this.tableWidth = el.clientWidth);\n      }\n    },\n\n    onFilterPopupVisibleChange(visible: boolean, colKey: string) {\n      this.filterPopupVisible[colKey] = visible;\n    },\n\n    renderFirstFilterRow() {\n      const filterEmpty = filterEmptyData(this.filterValue);\n      if (!this.filterValue || !Object.keys(filterEmpty).length) return null;\n      const defaultNode = (\n        <div class={`${prefix}-table__filter-result`}>\n          <span>搜索 “{this.getFilterResultContent()}”，</span>\n          <span>找到 {(this.pagination as TdPrimaryTableProps['pagination'])?.total || this.data?.length} 条结果</span>\n          <TButton theme=\"primary\" variant=\"text\" onClick={this.onResetAll}>\n            清空筛选\n          </TButton>\n        </div>\n      );\n      const filterContent = renderTNodeJSXDefault(this, 'filterRow', {\n        defaultNode,\n      });\n      return (\n        <div\n          style={{ width: this.fixedLeftColumn ? `${this.tableWidth}px` : undefined }}\n          class={`${prefix}-table__row-filter-inner`}\n        >\n          {filterContent}\n        </div>\n      );\n    },\n\n    // 获取搜索条件内容，存在 options 需要获取其 label 显示\n    getFilterResultContent(): string {\n      const arr: string[] = [];\n      this.columns\n        .filter((col) => col.filter)\n        .forEach((col) => {\n          let value = this.filterValue[col.colKey];\n          if (col.filter.list && !['null', '', 'undefined'].includes(String(value))) {\n            const formattedValue = value instanceof Array ? value : [value];\n            const label: string[] = [];\n            col.filter.list.forEach((option) => {\n              if (formattedValue.includes(option.value)) {\n                label.push(option.label);\n              }\n            });\n            value = label.join();\n          }\n          if (value) {\n            arr.push(`${col.title}：${value}`);\n          }\n        });\n      return arr.join('；');\n    },\n\n    onInnerFilterChange(val: any, column: PrimaryTableCol) {\n      const filterValue = {\n        ...this.innerFilterValue,\n        [column.colKey]: val,\n      };\n      this.innerFilterValue = filterValue;\n      if (!column.filter.showConfirmAndReset) {\n        this.emitFilterChange(filterValue, column);\n      }\n    },\n\n    emitFilterChange(filterValue: FilterValue, column?: PrimaryTableCol) {\n      emitEvent<FilterChangeContext>(this, 'filter-change', filterValue, { col: column });\n      emitEvent<ChangeContext>(this, 'change', { filter: filterValue }, { trigger: 'filter' });\n    },\n\n    onReset(column: PrimaryTableCol) {\n      const filterValue: FilterValue = {\n        ...this.innerFilterValue,\n        [column.colKey]:\n          {\n            single: '',\n            multiple: [],\n            input: '',\n          }[column.filter.type] ||\n          column.filter.resetValue ||\n          '',\n      };\n      this.innerFilterValue = filterValue;\n      this.emitFilterChange(filterValue, column);\n      this.filterPopupVisible[column.colKey] = false;\n    },\n\n    onResetAll() {\n      this.innerFilterValue = {};\n      this.emitFilterChange({});\n      this.filterPopupVisible = {};\n    },\n\n    onConfirm(column: PrimaryTableCol) {\n      this.emitFilterChange(this.innerFilterValue, column);\n      this.filterPopupVisible[column.colKey] = false;\n    },\n\n    getBottomButtons(column: PrimaryTableCol) {\n      if (!column.filter.showConfirmAndReset) return;\n      return (\n        <div class={`${prefix}-table__filter--bottom-buttons`}>\n          <TButton theme=\"default\" size=\"small\" onClick={() => this.onReset(column)}>\n            重置\n          </TButton>\n          <TButton theme=\"primary\" size=\"small\" onClick={() => this.onConfirm(column)}>\n            确认\n          </TButton>\n        </div>\n      );\n    },\n\n    getFilterContent(column: PrimaryTableCol) {\n      const types = ['single', 'multiple', 'input'];\n      if (column.type && !types.includes(column.filter.type)) {\n        console.error(`TDesign Table Error: column.filter.type must be the following: ${JSON.stringify(types)}`);\n        return;\n      }\n      if (column?.filter?.component && typeof column?.filter?.component !== 'function') {\n        console.error('TDesign Table Error: column.filter.component must be a function');\n        return;\n      }\n      const component = {\n        single: RadioGroup,\n        multiple: CheckboxGroup,\n        input: Input,\n      }[column.filter.type];\n      if (!component && !column?.filter?.component) return;\n      const props = {\n        options: ['single', 'multiple'].includes(column.filter.type) ? column.filter?.list : undefined,\n        ...(column.filter?.props || {}),\n        value: this.innerFilterValue[column.colKey],\n        onChange: (val: any) => this.onInnerFilterChange(val, column),\n      };\n\n      return (\n        <div class={`${prefix}-table__filter-pop-content-inner`}>\n          {column?.filter?.component ? (\n            column?.filter?.component((v: any) => {\n              return this.$createElement(v, {\n                props,\n              });\n            })\n          ) : (\n            <component value={this.innerFilterValue[column.colKey]} {...props}></component>\n          )}\n        </div>\n      );\n    },\n\n    getFilterColumns(columns: PrimaryTableCol[]): PrimaryTableCol[] {\n      return columns.map((item, index: number) => {\n        const column: PrimaryTableCol = { ...item };\n        if (column.filter) {\n          const title = getTitle(this, column, index);\n          column.title = () => (\n            <div class={`${prefix}-table__cell--title`}>\n              <div>{title}</div>\n              <div class={`${prefix}-table__cell--filter`}>\n                <Popup\n                  visible={this.filterPopupVisible[column.colKey]}\n                  trigger=\"click\"\n                  placement=\"bottom\"\n                  showArrow\n                  overlayClassName={`${prefix}-table__filter-pop`}\n                  onVisibleChange={(val: boolean) => this.onFilterPopupVisibleChange(val, column.colKey)}\n                  v-slots={{\n                    content: () => (\n                      <div class={`${prefix}-table__filter-pop-content`}>\n                        {this.getFilterContent(column)}\n                        {this.getBottomButtons(column)}\n                      </div>\n                    ),\n                  }}\n                >\n                  {isFunction(this.filterIcon) ? (\n                    this.filterIcon(h)\n                  ) : (\n                    <TIconFilter name=\"filter\" class={`${prefix}-table__filter-icon`} />\n                  )}\n                </Popup>\n              </div>\n            </div>\n          );\n        }\n        const { children } = item;\n        if (children && children.length) {\n          column.children = this.getFilterColumns(children);\n        }\n        return column;\n      });\n    },\n  },\n});\n"],"names":["filterEmptyData","data","newFilterValue","Object","keys","forEach","key","item","isArrayTrue","Array","length","isObject","_typeof","isObjectTrue","includes","String","defineComponent","name","prefix","props","columns","primaryTableProps","pagination","baseTableProps","filterValue","filterIcon","filterRow","emits","tableWidth","innerFilterValue","filterPopupVisible","computed","fixedLeftColumn","filter","col","fixed","hasFilterCondition","watch","val","mounted","timer","setTimeout","updateTableWidth","clearTimeout","methods","$el","tbody","querySelector","clientWidth","el","onFilterPopupVisibleChange","visible","colKey","renderFirstFilterRow","filterEmpty","defaultNode","getFilterResultContent","total","onResetAll","filterContent","renderTNodeJSXDefault","width","arr","value","list","formattedValue","label","option","push","join","title","onInnerFilterChange","column","showConfirmAndReset","emitFilterChange","emitEvent","trigger","onReset","single","multiple","input","type","resetValue","onConfirm","getBottomButtons","getFilterContent","types","console","error","JSON","stringify","component","RadioGroup","CheckboxGroup","Input","options","onChange","v","$createElement","getFilterColumns","map","index","getTitle","isFunction","h","content","children"],"mappings":"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"}