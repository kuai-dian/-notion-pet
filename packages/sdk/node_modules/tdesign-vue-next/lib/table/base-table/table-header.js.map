{"version":3,"file":"table-header.js","sources":["../../../src/table/base-table/table-header.tsx"],"sourcesContent":["import { VNode, defineComponent } from 'vue';\nimport TableCell from './table-cell';\nimport { BaseTableCol, CellData } from '../type';\nimport baseTableProps from '../base-table-props';\nimport { prefix } from '../../config';\n\ntype ThProps = {\n  rowspan: number;\n  colspan: number;\n  column: BaseTableCol;\n  index: number;\n  hasChildren: boolean;\n  isFirstColumn: boolean;\n};\n\nexport default defineComponent({\n  name: `${prefix}-table-header`,\n  components: {\n    TableCell,\n  },\n\n  props: {\n    columns: baseTableProps.columns,\n    bordered: baseTableProps.bordered,\n  },\n\n  data() {\n    return {\n      cacheRowMaxRowspan: [],\n    };\n  },\n\n  methods: {\n    renderHeader(): Array<VNode> {\n      const { bordered, cacheRowMaxRowspan } = this;\n      const trPropsList: Array<Array<ThProps>> = [];\n      this.renderTr(this.columns, 0, trPropsList, true);\n      return trPropsList.map((thPropsList, rowindex) => {\n        const currentRowMaxRowspan = cacheRowMaxRowspan[rowindex] || 1;\n        return (\n          <tr>\n            {thPropsList.map(({ column, rowspan, colspan, index, hasChildren, isFirstColumn }) => {\n              const withBorder = bordered && index === 0 && !isFirstColumn;\n              return this.renderCell(column, hasChildren ? rowspan : currentRowMaxRowspan, colspan, index, withBorder);\n            })}\n          </tr>\n        );\n      });\n    },\n    renderTr(\n      columns: Array<BaseTableCol>,\n      currentRowIndex: number,\n      trPropsList: Array<any>,\n      isParentFirstColumn: boolean,\n    ): any {\n      const { cacheRowMaxRowspan } = this;\n      const currentRowThProps: Array<ThProps> = [];\n      // 当前行\n      if (typeof trPropsList[currentRowIndex] === 'undefined') {\n        // eslint-disable-next-line no-param-reassign\n        trPropsList[currentRowIndex] = [];\n      }\n      if (typeof cacheRowMaxRowspan[currentRowIndex] === 'undefined') {\n        cacheRowMaxRowspan[currentRowIndex] = 1;\n      }\n      // 占用的列\n      let colspan = 0;\n      // 占用的行\n      let rowspan = 1;\n      columns.forEach((column: BaseTableCol, index: number) => {\n        const { children } = column;\n        if (children?.length) {\n          const isFirstColumn = isParentFirstColumn && index === 0;\n          const { colspan: occupiedCol, rowspan: occupiedRow } = this.renderTr(\n            children,\n            currentRowIndex + 1,\n            trPropsList,\n            isFirstColumn,\n          );\n          colspan += occupiedCol;\n          rowspan += occupiedRow;\n          cacheRowMaxRowspan[currentRowIndex] = Math.max(rowspan, cacheRowMaxRowspan[currentRowIndex]);\n          currentRowThProps[index] = {\n            rowspan: 1,\n            colspan: occupiedCol,\n            column,\n            index,\n            hasChildren: true,\n            isFirstColumn: index === 0 && isParentFirstColumn,\n          };\n        }\n      });\n      // 普通单元格\n      columns.forEach((column, index: number) => {\n        const { children } = column;\n        if (!children || children?.length === 0) {\n          currentRowThProps[index] = {\n            rowspan,\n            colspan: 1,\n            column,\n            index,\n            hasChildren: false,\n            isFirstColumn: index === 0 && isParentFirstColumn,\n          };\n          colspan += 1;\n        }\n      });\n      trPropsList[currentRowIndex].push(...currentRowThProps);\n      return {\n        colspan,\n        rowspan,\n      };\n    },\n\n    renderCell(column: BaseTableCol, rowspan: number, colspan: number, index: number, withBorder?: boolean): VNode {\n      const { title, render } = column;\n      const customData = {\n        type: 'title',\n        func: 'title',\n      };\n      let customRender;\n      if (typeof title === 'string') {\n        if (typeof this.$slots?.[title] === 'function') {\n          customRender = (params: any) => this.$slots[title](params);\n        } else {\n          customRender = () => title;\n        }\n      } else if (typeof title === 'function') {\n        customRender = (h: any, params: CellData<any>) =>\n          title(h, {\n            colIndex: params.colIndex,\n            col: params.col,\n          });\n      } else if (typeof render === 'function') {\n        customRender = render;\n        customData.func = 'render';\n      } else {\n        customRender = () => '';\n      }\n\n      const cellData = {\n        col: column,\n        colIndex: index,\n        customData,\n        customRender,\n        type: 'th',\n        withBorder,\n      };\n\n      return <table-cell cellData={cellData} colspan={colspan} rowspan={rowspan} />;\n    },\n  },\n  render() {\n    return <thead>{this.renderHeader()}</thead>;\n  },\n});\n"],"names":["defineComponent","name","prefix","components","TableCell","props","columns","baseTableProps","bordered","data","cacheRowMaxRowspan","methods","renderHeader","trPropsList","renderTr","map","thPropsList","rowindex","currentRowMaxRowspan","column","rowspan","colspan","index","hasChildren","isFirstColumn","withBorder","renderCell","currentRowIndex","isParentFirstColumn","currentRowThProps","forEach","children","length","occupiedCol","occupiedRow","Math","max","push","title","render","customData","type","func","customRender","$slots","params","h","colIndex","col","cellData"],"mappings":"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"}