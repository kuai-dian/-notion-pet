{"version":3,"file":"table-cell.js","sources":["../../../src/table/base-table/table-cell.tsx"],"sourcesContent":["import { VNode, defineComponent, h, ComponentPublicInstance } from 'vue';\nimport { prefix } from '../../config';\nimport Popup from '../../popup';\nimport { isNodeOverflow } from '../../utils/dom';\nimport { TdInstance } from '../util/interface';\nimport { getRecord } from '../util/common';\nimport { emitEvent } from '../../utils/event';\nimport { TdBaseTableProps } from '../type';\nimport baseTableProps from '../base-table-props';\n\nconst overlayStyle = {\n  width: '100%',\n  maxWidth: '400px',\n  wordBreak: 'break-all',\n};\n\nexport default defineComponent({\n  name: `${prefix}-table-cell`,\n  components: {\n    Popup,\n  },\n  props: {\n    onCellClick: baseTableProps.onCellClick,\n    cellData: {\n      type: Object,\n      default() {\n        return {};\n      },\n    },\n  },\n  data() {\n    return {\n      offsetLeft: 0,\n      isBoundary: false,\n      isCutOff: false,\n    };\n  },\n  mounted() {\n    this.init();\n  },\n  updated() {\n    this.init();\n  },\n  methods: {\n    init() {\n      const { fixed } = this.cellData.col;\n      const children = this.$parent.$refs;\n      // 计算当前固定列偏移的宽度\n      if (fixed) {\n        let offsetLeft = 0;\n        const fixedColumns: Array<ComponentPublicInstance> = [];\n        Object.keys(children).forEach((refKey) => {\n          const el = children[refKey] as TdInstance;\n          if (el?.cellData?.col?.fixed === fixed) {\n            fixedColumns.push(el);\n          }\n        });\n        const indexInFixedColumns = fixedColumns.findIndex((el: ComponentPublicInstance) => el === this);\n        fixedColumns.forEach((el: any, cur: number) => {\n          if ((fixed === 'right' && cur > indexInFixedColumns) || (fixed === 'left' && cur < indexInFixedColumns)) {\n            const { width } = el.cellData.col;\n            const { clientWidth } = el.$el;\n            offsetLeft += width > 0 ? width : clientWidth;\n          }\n        });\n        this.isBoundary =\n          fixed === 'left' ? indexInFixedColumns === fixedColumns.length - 1 : indexInFixedColumns === 0;\n        this.offsetLeft = offsetLeft;\n      }\n      this.isCutOff = isNodeOverflow(this.$el);\n    },\n  },\n  render() {\n    const { cellData } = this;\n    const { col, colIndex, row, rowIndex, customData, customRender, withoutBorder, withBorder } = cellData;\n    const { colKey, attrs, align, ellipsis, width, className, title, fixed } = col;\n\n    // 固定列 单元格属性\n    const style: Record<string, any> = {\n      ...col.attrs?.style,\n    };\n    const fixedClass = [];\n    // 普通样式\n    const attrClass = attrs?.class || [];\n    if (fixed) {\n      style.position = 'sticky';\n      style[fixed] = `${this.offsetLeft}px`;\n      fixedClass.push(`${prefix}-table__cell--fixed-${fixed}`);\n      if (this.isBoundary) {\n        fixedClass.push(`${prefix}-table__cell--fixed-${fixed}-${fixed === 'left' ? 'last' : 'first'}`);\n      }\n    }\n    if (align) {\n      attrClass.push(`${prefix}-align-${align}`);\n    }\n    if (width && !fixed) {\n      style.overflow = 'hidden';\n    }\n    if (withoutBorder === true) {\n      style.borderLeftWidth = '0px';\n    }\n    if (withBorder) {\n      style.borderLeft = '1px solid #E7E7E7';\n    }\n    if (ellipsis === true || typeof ellipsis === 'function') {\n      attrClass.push(`${prefix}-text-ellipsis`);\n    }\n    if (className) {\n      if (typeof className === 'function') {\n        attrClass.push(\n          className({\n            type: cellData.type,\n            col,\n            colIndex,\n            row,\n            rowIndex,\n          }),\n        );\n      } else {\n        attrClass.push(className);\n      }\n    }\n    if (['single', 'multiple'].indexOf(col.type) > -1) {\n      attrClass.push(`${prefix}-table__cell--selectable`);\n    }\n    const record = getRecord(row);\n    // 自定义单元格渲染\n    let cellContent: VNode;\n    if (typeof customRender === 'function') {\n      const { type, func } = customData;\n      const baseData = {\n        col,\n        colIndex,\n        row,\n        rowIndex,\n        record,\n      };\n      if (func === 'title') {\n        cellContent = customRender(h, { col, colIndex, type });\n      } else if (func === 'cell') {\n        cellContent = customRender(h, baseData);\n      } else if (func === 'render') {\n        cellContent = customRender(h, { type, ...baseData });\n      }\n    } else {\n      cellContent = h(title || '');\n    }\n    const tdAttrs = {\n      ...attrs,\n      class: [...fixedClass, ...attrClass].filter((notEmpty) => notEmpty).join(' '),\n      key: colKey,\n      style,\n      onClick: (e: MouseEvent) => {\n        emitEvent<Parameters<TdBaseTableProps['onCellClick']>>(this, 'cell-click', {\n          col,\n          colIndex,\n          row,\n          rowIndex,\n          e,\n        });\n      },\n    };\n    // 如果被截断给加上 Tooltip 提示\n    if (ellipsis && this.isCutOff) {\n      let popupCellContent = cellContent;\n      if (typeof ellipsis === 'function') {\n        popupCellContent = ellipsis(h, {\n          row,\n          col,\n          rowIndex,\n          colIndex,\n        });\n      }\n      return (\n        <td {...tdAttrs}>\n          <Popup\n            style=\"display: inline;\"\n            overlayStyle={overlayStyle}\n            placement=\"bottom-left\"\n            showArrow={false}\n            v-slots={{\n              default: () => cellContent,\n              content: () => popupCellContent,\n            }}\n          />\n        </td>\n      );\n    }\n    return <td {...tdAttrs}>{cellContent}</td>;\n  },\n});\n"],"names":["overlayStyle","width","maxWidth","wordBreak","defineComponent","name","prefix","components","Popup","props","onCellClick","baseTableProps","cellData","type","Object","data","offsetLeft","isBoundary","isCutOff","mounted","init","updated","methods","fixed","col","children","$parent","$refs","fixedColumns","keys","forEach","refKey","el","push","indexInFixedColumns","findIndex","cur","clientWidth","$el","length","isNodeOverflow","render","colIndex","row","rowIndex","customData","customRender","withoutBorder","withBorder","colKey","attrs","align","ellipsis","className","title","style","fixedClass","attrClass","position","overflow","borderLeftWidth","borderLeft","indexOf","record","getRecord","cellContent","func","baseData","h","tdAttrs","filter","notEmpty","join","key","onClick","e","emitEvent","popupCellContent","content"],"mappings":"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"}