{"version":3,"file":"plugin.js","sources":["../../src/notification/plugin.ts"],"sourcesContent":["import { App, Plugin, createApp, nextTick, ComponentPublicInstance } from 'vue';\nimport NotificationList from './notificationList';\nimport { getAttach } from '../utils/dom';\nimport {\n  NotificationOptions,\n  NotificationInstance,\n  NotificationMethod,\n  NotificationInfoMethod,\n  NotificationWarningMethod,\n  NotificationErrorMethod,\n  NotificationSuccessMethod,\n  NotificationCloseMethod,\n  NotificationCloseAllMethod,\n} from './type';\nimport { AttachNodeReturnValue } from '../common';\n\nlet seed = 0;\n// 存储不同 attach 和 不同 placement 消息列表实例\nconst instanceMap: Map<AttachNodeReturnValue, Record<string, ComponentPublicInstance>> = new Map();\n\nconst NotificationFunction = (options: NotificationOptions): Promise<NotificationInstance> => {\n  seed += 1;\n  const hackOptions = {\n    placement: 'top-right',\n    zIndex: 6000,\n    attach: 'body',\n    id: seed,\n    ...options,\n  };\n  hackOptions.content = options.content ? options.content : '';\n\n  const a = getAttach(hackOptions.attach);\n\n  if (!instanceMap.get(a)) {\n    instanceMap.set(a, {});\n  }\n  let p = instanceMap.get(a)[hackOptions.placement];\n  if (!p) {\n    const wrapper = document.createElement('div');\n\n    const instance = createApp(NotificationList, {\n      placement: hackOptions.placement,\n    }).mount(wrapper);\n\n    instance.add(hackOptions);\n    instanceMap.get(a)[hackOptions.placement] = instance;\n    p = instance;\n    a.appendChild(instance.$el);\n  } else {\n    p.add(hackOptions);\n  }\n\n  return new Promise((resolve) => {\n    nextTick(() => {\n      const lastChild = p.getLastChild();\n      resolve(lastChild);\n    });\n  });\n};\n\nconst showThemeNotification: NotificationMethod = (theme, options) => {\n  const hackOptions = { ...options, theme };\n  return NotificationFunction(hackOptions);\n};\n\ninterface ExtraApi {\n  info: NotificationInfoMethod;\n  success: NotificationSuccessMethod;\n  warning: NotificationWarningMethod;\n  error: NotificationErrorMethod;\n  close: NotificationCloseMethod;\n  closeAll: NotificationCloseAllMethod;\n}\n\nconst extraApi: ExtraApi = {\n  info: (options) => showThemeNotification('info', options),\n  success: (options) => showThemeNotification('success', options),\n  warning: (options) => showThemeNotification('warning', options),\n  error: (options) => showThemeNotification('error', options),\n  close: (promise) => {\n    promise.then((instance) => instance.close());\n  },\n  closeAll: () => {\n    instanceMap.forEach((attach) => {\n      Object.keys(attach).forEach((placement) => {\n        attach[placement].removeAll();\n      });\n    });\n  },\n};\nexport type NotificationPluginType = Plugin & ExtraApi & NotificationMethod;\n\nconst NotificationPlugin: NotificationPluginType = showThemeNotification as NotificationPluginType;\n\nNotificationPlugin.install = (app: App) => {\n  app.config.globalProperties.$notify = showThemeNotification;\n  Object.keys(extraApi).forEach((funcName) => {\n    app.config.globalProperties.$notify[funcName] = extraApi[funcName];\n  });\n};\n\nObject.keys(extraApi).forEach((funcName) => {\n  NotificationPlugin[funcName] = extraApi[funcName];\n});\n\nexport default NotificationPlugin;\n"],"names":["seed","instanceMap","Map","NotificationFunction","options","hackOptions","placement","zIndex","attach","id","content","a","getAttach","get","set","p","wrapper","document","createElement","instance","createApp","NotificationList","mount","add","appendChild","$el","Promise","resolve","nextTick","lastChild","getLastChild","showThemeNotification","theme","extraApi","info","success","warning","error","close","promise","then","closeAll","forEach","Object","keys","removeAll","NotificationPlugin","install","app","config","globalProperties","$notify","funcName"],"mappings":"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"}