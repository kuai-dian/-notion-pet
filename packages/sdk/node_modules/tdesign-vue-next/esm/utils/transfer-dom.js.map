{"version":3,"file":"transfer-dom.js","sources":["../../src/utils/transfer-dom.ts"],"sourcesContent":["/* eslint-disable no-param-reassign */\n// Thanks to: https://github.com/airyland/vux/blob/v2/src/directives/transfer-dom/index.js\n\nimport { DirectiveBinding } from 'vue';\nimport { getAttach } from './dom';\n\n// Thanks to: https://github.com/calebroseland/vue-dom-portal\ninterface TransferData {\n  parentNode: HTMLElement;\n  home: Comment;\n  hasMovedOut: boolean;\n  target: HTMLElement;\n}\ninterface TransferElement extends HTMLElement {\n  __transferDomData?: TransferData;\n  parentNode: HTMLElement;\n}\n\nfunction getShouldUpdate(node: any) {\n  // do not updated by default\n  if (!node) {\n    return false;\n  }\n  if (typeof node === 'string' && node.indexOf('?') > 0) {\n    try {\n      const config = JSON.parse(node.split('?')[1]);\n      return config.autoUpdate || false;\n    } catch (e) {\n      return false;\n    }\n  }\n  return false;\n}\n\nconst TransferDom = {\n  mounted(el: TransferElement, binding: DirectiveBinding) {\n    const { value } = binding;\n    el.className = el.className ? `${el.className} v-transfer-dom` : 'v-transfer-dom';\n    const { parentNode } = el;\n    const home = document.createComment('');\n    let hasMovedOut = false;\n    const target = getAttach(value);\n    if (value && target) {\n      parentNode.replaceChild(home, el); // moving out, el is no longer in the document\n      target.appendChild(el); // moving into new place\n      hasMovedOut = true;\n    }\n    if (!el.__transferDomData) {\n      el.__transferDomData = {\n        parentNode,\n        home,\n        target,\n        hasMovedOut,\n      };\n    }\n  },\n  updated(el: TransferElement, binding: DirectiveBinding) {\n    const { value } = binding;\n    const shouldUpdate = getShouldUpdate(value);\n    if (!shouldUpdate) {\n      return;\n    }\n    // need to make sure children are done updating (vs. `update`)\n    const ref$1 = el.__transferDomData;\n    // homes.get(el)\n    const { parentNode, home, hasMovedOut } = ref$1;\n\n    // recall where home is\n    if (!hasMovedOut && value) {\n      // remove from document and leave placeholder\n      parentNode.replaceChild(home, el);\n      // append to target\n      getAttach(value)?.appendChild?.(el);\n      el.__transferDomData = {\n        ...el.__transferDomData,\n        hasMovedOut: true,\n        target: getAttach(value),\n      };\n    } else if (hasMovedOut && !value) {\n      // previously moved, coming back home\n      parentNode.replaceChild(el, home);\n      el.__transferDomData = {\n        ...el.__transferDomData,\n        hasMovedOut: false,\n        target: getAttach(value),\n      };\n    } else if (value) {\n      // already moved, going somewhere else\n      getAttach(value)?.appendChild?.(el);\n    }\n  },\n  unmounted: function unbind(el: TransferElement) {\n    el.className = el.className.replace('v-transfer-dom', '');\n    if (el.__transferDomData && el.__transferDomData.hasMovedOut === true) {\n      el.__transferDomData.parentNode?.appendChild?.(el);\n    }\n    el.__transferDomData = null;\n  },\n};\n\nexport default TransferDom;\n"],"names":["getShouldUpdate","node","indexOf","config","JSON","parse","split","autoUpdate","e","TransferDom","mounted","el","binding","value","className","parentNode","home","document","createComment","hasMovedOut","target","getAttach","replaceChild","appendChild","__transferDomData","updated","shouldUpdate","ref$1","unmounted","unbind","replace"],"mappings":"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"}