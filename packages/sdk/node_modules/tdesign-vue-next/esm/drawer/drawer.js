/**
 * tdesign v0.8.0
 * (c) 2022 tdesign
 * @license MIT
 */

import _typeof from '@babel/runtime/helpers/typeof';
import _defineProperty from '@babel/runtime/helpers/defineProperty';
import { defineComponent, nextTick, createVNode, resolveComponent, withDirectives, mergeProps, resolveDirective } from 'vue';
import { CloseIcon } from 'tdesign-icons-vue-next';
import { addClass, removeClass } from '../utils/dom.js';
import { prefix } from '../config.js';
import { Button } from '../button/index.js';
import props from './props.js';
import { renderContent, renderTNodeJSX } from '../utils/render-tnode.js';
import TransferDom from '../utils/transfer-dom.js';
import ActionMixin from '../dialog/actions.js';
import { emitEvent } from '../utils/event.js';
import mixins from '../utils/mixins.js';
import getConfigReceiverMixins from '../config-provider/config-receiver.js';
import '../_chunks/dep-b66bfe36.js';
import 'lodash/isString';
import '../utils/easing.js';
import '../button/button.js';
import '@babel/runtime/helpers/toConsumableArray';
import '../utils/classnames.js';
import '../loading/index.js';
import '../loading/loading.js';
import '@babel/runtime/helpers/slicedToArray';
import '../loading/icon/gradient.js';
import '../_common/js/loading/circle-adapter.js';
import '../_common/js/utils/set-style.js';
import '../_common/js/utils/helper.js';
import '@babel/runtime/helpers/objectWithoutProperties';
import '../loading/props.js';
import '../utils/withInstall.js';
import '../loading/style';
import '../loading/type.js';
import '../loading/plugin.js';
import 'lodash/isEmpty';
import 'lodash/isFunction';
import 'lodash/isObject';
import '../button/props.js';
import '../utils/ripple.js';
import '../utils/set-style.js';
import '../button/style';
import '../button/type.js';
import '../utils/helper.js';
import 'lodash/camelCase';
import '../config-provider/zh_CN_config.js';
import '../config-provider/type.js';

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
var name = "".concat(prefix, "-drawer");
var lockClass = "".concat(prefix, "-drawer--lock");
var _Drawer = defineComponent(_objectSpread(_objectSpread({}, mixins(ActionMixin, getConfigReceiverMixins("drawer"))), {}, {
  name: "TDrawer",
  components: {
    CloseIcon: CloseIcon,
    TButton: Button
  },
  directives: {
    TransferDom: TransferDom
  },
  props: _objectSpread({}, props),
  emits: ["open", "close", "opened", "closed", "update:visible", "overlay", "close-btn", "esc-keydown", "confirm", "cancel"],
  computed: {
    drawerClasses: function drawerClasses() {
      return ["t-drawer", "t-drawer--".concat(this.placement), {
        "t-drawer--open": this.visible,
        "t-drawer--attach": this.showInAttachedElement,
        "t-drawer--without-mask": !this.showOverlay
      }];
    },
    sizeValue: function sizeValue() {
      var defaultSize = isNaN(Number(this.size)) ? this.size : "".concat(this.size, "px");
      return {
        small: "300px",
        medium: "500px",
        large: "760px"
      }[this.size] || defaultSize;
    },
    wrapperStyles: function wrapperStyles() {
      return {
        transform: this.visible ? "translateX(0)" : void 0,
        width: ["left", "right"].includes(this.placement) ? this.sizeValue : "",
        height: ["top", "bottom"].includes(this.placement) ? this.sizeValue : ""
      };
    },
    wrapperClasses: function wrapperClasses() {
      return ["t-drawer__content-wrapper", "t-drawer__content-wrapper--".concat(this.placement)];
    },
    parentNode: function parentNode() {
      return this.$el && this.$el.parentNode;
    },
    modeAndPlacement: function modeAndPlacement() {
      return [this.mode, this.placement].join();
    },
    footerStyle: function footerStyle() {
      return {
        display: "flex",
        justifyContent: this.placement === "right" ? "flex-start" : "flex-end"
      };
    }
  },
  watch: {
    modeAndPlacement: {
      handler: function handler() {
        this.handlePushMode();
      },
      immediate: true
    },
    visible: {
      handler: function handler(value) {
        if (value && !this.showInAttachedElement) {
          this.preventScrollThrough && addClass(document.body, lockClass);
        } else {
          this.preventScrollThrough && removeClass(document.body, lockClass);
        }
      },
      immediate: true
    }
  },
  updated: function updated() {
    this.updatePushMode();
  },
  methods: {
    handlePushMode: function handlePushMode() {
      var _this = this;

      if (this.mode !== "push") return;
      nextTick(function () {
        if (!_this.parentNode) return;
        _this.parentNode.style.cssText = "transition: margin 300ms cubic-bezier(0.7, 0.3, 0.1, 1) 0s;";
      });
    },
    updatePushMode: function updatePushMode() {
      if (!this.parentNode) return;
      if (this.mode !== "push" || !this.parentNode) return;
      var marginStr = {
        left: "margin: 0 0 0 ".concat(this.sizeValue),
        right: "margin: 0 0 0 -".concat(this.sizeValue),
        top: "margin: ".concat(this.sizeValue, " 0 0 0"),
        bottom: "margin: -".concat(this.sizeValue, " 0 0 0")
      }[this.placement];

      if (this.visible) {
        this.parentNode.style.cssText += marginStr;
      } else {
        this.parentNode.style.cssText = this.parentNode.style.cssText.replace(/margin:.+;/, "");
      }
    },
    getDefaultBtn: function getDefaultBtn(btnType, btnApi) {
      var isCancel = btnType === "cancel";
      var clickAction = isCancel ? this.cancelBtnAction : this.confirmBtnAction;
      var theme = isCancel ? "default" : "primary";
      var isApiObject = _typeof(btnApi) === "object";
      return createVNode(resolveComponent("t-button"), {
        "theme": theme,
        "onClick": clickAction,
        "props": isApiObject ? btnApi : {},
        "class": "".concat(name, "-").concat(btnType)
      }, {
        "default": function _default() {
          return [btnApi && _typeof(btnApi) === "object" ? btnApi.content : btnApi];
        }
      });
    },
    isUseDefault: function isUseDefault(btnApi) {
      var baseTypes = ["string", "object"];
      return Boolean(btnApi && baseTypes.includes(_typeof(btnApi)));
    },
    getDefaultFooter: function getDefaultFooter() {
      var confirmBtn = this.getConfirmBtn({
        confirmBtn: this.confirmBtn,
        globalConfirm: this.global.confirm,
        className: "".concat(prefix, "-drawer__confirm")
      });
      var cancelBtn = this.getCancelBtn({
        cancelBtn: this.cancelBtn,
        globalCancel: this.global.cancel,
        className: "".concat(prefix, "-drawer__cancel")
      });
      return createVNode("div", {
        "style": this.footerStyle
      }, [this.placement === "right" ? confirmBtn : null, cancelBtn, this.placement !== "right" ? confirmBtn : null]);
    },
    handleCloseBtnClick: function handleCloseBtnClick(e) {
      emitEvent(this, "close-btn", e);
      this.closeDrawer({
        trigger: "close-btn",
        e: e
      });
    },
    handleWrapperClick: function handleWrapperClick(e) {
      emitEvent(this, "overlay", e);

      if (this.closeOnOverlayClick) {
        this.closeDrawer({
          trigger: "overlay",
          e: e
        });
      }
    },
    onKeyDown: function onKeyDown(e) {
      if (this.closeOnEscKeydown && e.key === "Escape") {
        emitEvent(this, "esc-keydown", e);
        this.closeDrawer({
          trigger: "esc",
          e: e
        });
      }
    },
    confirmBtnAction: function confirmBtnAction(e) {
      emitEvent(this, "confirm", e);
    },
    cancelBtnAction: function cancelBtnAction(e) {
      emitEvent(this, "cancel", e);
      this.closeDrawer({
        trigger: "cancel",
        e: e
      });
    },
    closeDrawer: function closeDrawer(params) {
      emitEvent(this, "close", params);
      this.$emit("update:visible", false);
    }
  },
  render: function render() {
    if (this.destroyOnClose && !this.visible) return;

    var defaultCloseBtn = createVNode(resolveComponent("close-icon"), {
      "class": "t-submenu-icon"
    }, null);

    var body = renderContent(this, "default", "body");
    var defaultFooter = this.getDefaultFooter();
    return withDirectives(createVNode("div", mergeProps({
      "class": this.drawerClasses,
      "style": {
        zIndex: this.zIndex
      },
      "onKeydown": this.onKeyDown
    }, this.$attrs), [this.showOverlay && createVNode("div", {
      "class": "".concat(name, "__mask"),
      "onClick": this.handleWrapperClick
    }, null), createVNode("div", {
      "class": this.wrapperClasses,
      "style": this.wrapperStyles
    }, [this.header && createVNode("div", {
      "class": "".concat(name, "__header")
    }, [renderTNodeJSX(this, "header")]), this.closeBtn && createVNode("div", {
      "class": "".concat(name, "__close-btn"),
      "onClick": this.handleCloseBtnClick
    }, [renderTNodeJSX(this, "closeBtn", defaultCloseBtn)]), createVNode("div", {
      "class": ["".concat(name, "__body"), "narrow-scrollbar"]
    }, [body]), this.footer && createVNode("div", {
      "class": "".concat(name, "__footer")
    }, [renderTNodeJSX(this, "footer", defaultFooter)])])]), [[resolveDirective("transfer-dom"), this.attach]]);
  }
}));

export { _Drawer as default };
//# sourceMappingURL=drawer.js.map
