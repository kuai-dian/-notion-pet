{"version":3,"file":"util.js","sources":["../../src/tree/util.ts"],"sourcesContent":["import { VNode, h } from 'vue';\nimport TreeStore from '../_common/js/tree/tree-store';\nimport TreeNode from '../_common/js/tree/tree-node';\nimport { TypeMark, TypeLineModel, TypeTNodeProp, TypeGetTNodeOption, TypeTargetNode } from './interface';\n\nexport { emitEvent } from '../utils/event';\n\nexport function getParentsToRoot(element?: HTMLElement, root?: HTMLElement): HTMLElement[] {\n  const list = [];\n  let el: HTMLElement = element;\n  while (el && el.parentNode) {\n    list.push(el);\n    if (el === root) {\n      break;\n    }\n    el = el.parentNode as HTMLElement;\n  }\n  return list;\n}\n\nexport function getParentMarks(name: string, element?: HTMLElement, root?: HTMLElement): TypeMark[] {\n  const list = getParentsToRoot(element, root);\n  return list\n    .map((el) => {\n      const mark: TypeMark = {\n        name,\n        value: el.getAttribute(name) || '',\n        el,\n      };\n      return mark;\n    })\n    .filter((mark) => mark.value);\n}\n\nexport function getMark(name: string, element?: HTMLElement, root?: HTMLElement): TypeMark {\n  const list = getParentMarks(name, element, root);\n  const info = list.pop() || null;\n  return info;\n}\n\nexport function getTNode(prop: TypeTNodeProp, options: TypeGetTNodeOption = {}): string | VNode {\n  let tnode = null;\n  let item = null;\n  const conf = {\n    ...options,\n  };\n  if (typeof prop === 'function') {\n    item = prop(h, conf.node?.getModel());\n  } else if (typeof prop === 'string') {\n    item = prop;\n  }\n  if (typeof item === 'string') {\n    tnode = item;\n  } else if (item) {\n    tnode = item as VNode;\n  }\n  return tnode;\n}\n\n// 获取一个节点层级位置的连线模型\nexport function getLineModel(nodes: TreeNode[], node: TreeNode, index: number): TypeLineModel {\n  // 标记 [上，右，下，左] 是否有连线\n  const lineModel: TypeLineModel = {\n    top: false,\n    right: false,\n    bottom: false,\n    left: false,\n  };\n\n  let nodeChildren = [];\n  if (Array.isArray(node.children)) {\n    nodeChildren = node.children;\n  }\n  const childNode = nodes[index - 1] || null;\n  const nodeItemIndex = childNode ? childNode.getIndex() : 0;\n\n  if (index === 0) {\n    lineModel.left = !!node.parent;\n    lineModel.bottom = node.children && node.expanded;\n    lineModel.right = node.parent && !node.children;\n  } else if (index === 1) {\n    lineModel.top = true;\n    lineModel.right = true;\n    lineModel.bottom = nodeItemIndex < nodeChildren.length - 1;\n  } else if (nodeItemIndex < nodeChildren.length - 1) {\n    lineModel.top = true;\n    lineModel.bottom = true;\n  }\n\n  return lineModel;\n}\n\nexport function isTreeNodeValue(item: unknown): boolean {\n  return typeof item === 'string' || typeof item === 'number';\n}\n\nexport function getNode(store: TreeStore, item: TypeTargetNode): TreeNode {\n  let node = null;\n  let val = null;\n  if (typeof item === 'string' || typeof item === 'number') {\n    val = item;\n  } else if (item && isTreeNodeValue(item.value)) {\n    val = item.value;\n  }\n  node = store.getNode(val);\n  return node;\n}\n"],"names":["getParentsToRoot","element","root","list","el","parentNode","push","getParentMarks","name","map","mark","value","getAttribute","filter","getMark","info","pop","getTNode","prop","options","tnode","item","conf","h","node","getModel","getLineModel","nodes","index","lineModel","top","right","bottom","left","nodeChildren","Array","isArray","children","childNode","nodeItemIndex","getIndex","parent","expanded","length","isTreeNodeValue","getNode","store","val"],"mappings":"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"}