{"version":3,"file":"panel.js","sources":["../../../src/cascader/utils/panel.ts"],"sourcesContent":["import isNumber from 'lodash/isNumber';\nimport { TreeNode, CascaderContextType, CascaderProps, TreeNodeValue } from '../interface';\n\n/**\n * 面板数据计算方法\n * @param treeNodes\n * @returns\n */\nexport function getPanels(treeNodes: CascaderContextType['treeNodes']) {\n  const panels: TreeNode[][] = [];\n  treeNodes.forEach((node: TreeNode) => {\n    if (panels[node.level]) {\n      panels[node.level].push(node);\n    } else {\n      panels[node.level] = [node];\n    }\n  });\n  return panels;\n}\n\n/**\n * 点击item的副作用\n * @param propsTrigger\n * @param trigger\n * @param node\n * @param cascaderContext\n * @param onChange\n * @param ctx\n */\nexport function expendClickEffect(\n  propsTrigger: CascaderProps['trigger'],\n  trigger: CascaderProps['trigger'],\n  node: TreeNode,\n  cascaderContext: CascaderContextType,\n) {\n  const {\n    checkStrictly,\n    filterActive,\n    multiple,\n    treeStore,\n    setFilterActive,\n    setVisible,\n    setValue,\n    setTreeNodes,\n    setExpend,\n    value,\n    max,\n    valueType,\n  } = cascaderContext;\n\n  const isDisabled = node.disabled || (multiple && (value as TreeNodeValue[]).length >= max && max !== 0);\n\n  if (isDisabled) return;\n  // 点击展开节点，设置展开状态\n  if (propsTrigger === trigger && !node.isLeaf()) {\n    const expanded = node.setExpanded(true);\n    treeStore.refreshNodes();\n    treeStore.replaceExpanded(expanded);\n    const nodes = treeStore.getNodes().filter((node: TreeNode) => node.visible);\n    setTreeNodes(nodes);\n\n    // 多选条件下\b手动维护expend\n    if (multiple) {\n      setExpend(expanded);\n    }\n  }\n\n  if (!multiple && (node.isLeaf() || checkStrictly) && trigger === 'click') {\n    treeStore.resetChecked();\n    const checked = node.setChecked(!node.isChecked());\n    const [value] = checked;\n\n    // 过滤状态下，点击后清除过滤状态\n    if (filterActive) {\n      setFilterActive(false);\n    }\n\n    // 非过滤状态下，关闭\n    if (!filterActive && !checkStrictly) {\n      setVisible(false);\n    }\n\n    // 非受控状态下更新状态\n    setValue(valueType === 'single' ? value : node.getPath().map((item) => item.value), 'checked', node.getModel());\n  }\n}\n\n/**\n * 多选状态下选中状态数据变化的副作用\n * @param node\n * @param cascaderContext\n * @returns\n */\nexport function valueChangeEffect(node: TreeNode, cascaderContext: CascaderContextType) {\n  const {\n    disabled,\n    max,\n    multiple,\n    setVisible,\n    setValue,\n    filterActive,\n    setFilterActive,\n    treeNodes,\n    treeStore,\n    valueType,\n  } = cascaderContext;\n\n  if (!node || disabled || node.disabled) {\n    return;\n  }\n  const checked = node.setChecked(!node.isChecked());\n\n  if (isNumber(max) && max < 0) {\n    console.warn('TDesign Warn:', 'max should > 0');\n  }\n\n  if (checked.length > max && isNumber(max) && max > 0) {\n    return;\n  }\n\n  if (checked.length === 0) {\n    const expanded = treeStore.getExpanded();\n    setTimeout(() => {\n      treeStore.replaceExpanded(expanded);\n      treeStore.refreshNodes();\n    }, 0);\n  }\n\n  if (!multiple) {\n    setVisible(false);\n  }\n\n  const isSelectAll = treeNodes.every((item) => checked.indexOf(item.value) > -1);\n\n  if (filterActive && isSelectAll) {\n    setVisible(false);\n    setFilterActive(false);\n  }\n\n  // 处理不同数据类型\n  const resValue =\n    valueType === 'single'\n      ? checked\n      : checked.map((val) =>\n          treeStore\n            .getNode(val)\n            .getPath()\n            .map((item) => item.value),\n        );\n  setValue(resValue, 'checked', node.getModel());\n}\n"],"names":["getPanels","treeNodes","panels","forEach","node","level","push","expendClickEffect","propsTrigger","trigger","cascaderContext","checkStrictly","filterActive","multiple","treeStore","setFilterActive","setVisible","setValue","setTreeNodes","setExpend","value","max","valueType","isDisabled","disabled","length","isLeaf","expanded","setExpanded","refreshNodes","replaceExpanded","nodes","getNodes","filter","node2","visible","resetChecked","checked","setChecked","isChecked","value2","getPath","map","item","getModel","valueChangeEffect","isNumber","console","warn","getExpanded","setTimeout","isSelectAll","every","indexOf","resValue","val","getNode"],"mappings":"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"}