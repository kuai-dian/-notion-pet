{"version":3,"file":"common.js","sources":["../../../src/table/util/common.ts"],"sourcesContent":["import { h, ComponentPublicInstance, VNodeChild } from 'vue';\nimport isFunction from 'lodash/isFunction';\nimport isString from 'lodash/isString';\nimport { PrimaryTableCol } from '../type';\n\nexport function toString<T>(obj: T): string {\n  return Object.prototype.toString.call(obj).slice(8, -1).toLowerCase();\n}\n\nexport function debounce<T = any>(fn: Function, delay = 200): () => void {\n  let timer: ReturnType<typeof setTimeout>;\n  return function newFn(this: T, ...args: Array<any>): void {\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const context = this;\n    clearTimeout(timer);\n    timer = setTimeout(() => {\n      fn.apply(context, args);\n    }, delay);\n  };\n}\n\nexport function filterDataByIds<T>(data: Array<T> = [], ids: Array<string | number> = [], byId = 'id'): Array<T> {\n  return data.filter((d: Record<string, any> = {}) => ids.includes(d[byId]));\n}\n\nexport const INNER_PRE_NAME = '@@inner-';\n\nexport enum ScrollDirection {\n  X = 'x',\n  Y = 'y',\n  UNKNOWN = 'unknown',\n}\n\nlet preScrollLeft: any;\nlet preScrollTop: any;\n\nexport const getScrollDirection = (scrollLeft: number, scrollTop: number): ScrollDirection => {\n  let direction = ScrollDirection.UNKNOWN;\n  if (preScrollTop !== scrollTop) {\n    direction = ScrollDirection.Y;\n  } else if (preScrollLeft !== scrollLeft) {\n    direction = ScrollDirection.X;\n  }\n  preScrollTop = scrollTop;\n  preScrollLeft = scrollLeft;\n  return direction;\n};\n\nexport const getRecord = (record: Record<any, any>) => {\n  if (!record) {\n    return record;\n  }\n  const result = {};\n  Object.keys(record).forEach((key) => {\n    const descriptor = Object.getOwnPropertyDescriptor(record, key);\n    descriptor &&\n      Reflect.defineProperty(result, key, {\n        set(val) {\n          descriptor.set(val);\n        },\n        get() {\n          console.warn('The parameter `record` will be deprecated, please use `row` instead');\n          return descriptor.get();\n        },\n      });\n  });\n  return result;\n};\n\n// 该方法主要用于排序、过滤等需要调整表头的功能\nexport function getTitle(vm: ComponentPublicInstance, column: PrimaryTableCol, colIndex: number): VNodeChild | number {\n  let result = null;\n  if (isFunction(column.title)) {\n    result = column.title(h, { col: column, colIndex });\n  } else if (isString(column.title)) {\n    result = vm.$slots[column.title] ? vm.$slots[column.title](null) : column.title;\n  } else if (isFunction(column.render)) {\n    result = column.render(h, {\n      type: 'title',\n      col: column,\n      colIndex,\n      row: undefined,\n      rowIndex: undefined,\n    });\n  }\n  return result;\n}\n\nexport interface GetCellParams {\n  row: Record<string, any>;\n  rowIndex: number;\n  col: PrimaryTableCol;\n  colIndex: number;\n}\n\n// 该方法主要用于设置单元格（树形结构等功能会使用）\nexport function getCell(vm: ComponentPublicInstance, p: GetCellParams) {\n  const { col, row } = p;\n  let result = null;\n  if (isFunction(col.cell)) {\n    result = col.cell(h, { ...p });\n  } else if (isString(col.cell)) {\n    result = vm.$slots[col.cell] ? vm.$slots[col.cell](p) : row[col.colKey];\n  } else if (isFunction(col.render)) {\n    result = col.render(h, {\n      type: 'cell',\n      ...p,\n    });\n  }\n  return result || row[col.colKey];\n}\n\nexport function isRowSelectedDisabled(\n  selectColumn: PrimaryTableCol,\n  row: Record<string, any>,\n  rowIndex: number,\n): boolean {\n  let disabled = isFunction(selectColumn.disabled) ? selectColumn.disabled({ row, rowIndex }) : selectColumn.disabled;\n  if (selectColumn.checkProps) {\n    if (isFunction(selectColumn.checkProps)) {\n      disabled = disabled || selectColumn.checkProps({ row, rowIndex }).disabled;\n    } else if (selectColumn.checkProps === 'object') {\n      disabled = disabled || selectColumn.checkProps.disabled;\n    }\n  }\n  return !!disabled;\n}\n"],"names":["toString","obj","Object","prototype","call","slice","toLowerCase","debounce","fn","delay","timer","newFn","args","context","clearTimeout","setTimeout","apply","filterDataByIds","data","ids","byId","filter","d","includes","INNER_PRE_NAME","ScrollDirection","ScrollDirection2","preScrollLeft","preScrollTop","getScrollDirection","scrollLeft","scrollTop","direction","getRecord","record","result","keys","forEach","key","descriptor","getOwnPropertyDescriptor","Reflect","defineProperty","set","val","get","console","warn","getTitle","vm","column","colIndex","isFunction","title","h","col","isString","$slots","render","type","row","rowIndex","getCell","p","cell","colKey","isRowSelectedDisabled","selectColumn","disabled","checkProps"],"mappings":"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"}