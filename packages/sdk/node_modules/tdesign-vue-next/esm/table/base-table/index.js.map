{"version":3,"file":"index.js","sources":["../../../src/table/base-table/index.tsx"],"sourcesContent":["import { defineComponent, VNode, ref, toRefs, provide } from 'vue';\nimport throttle from 'lodash/throttle';\nimport mixins from '../../utils/mixins';\nimport getConfigReceiverMixins, { TableConfig } from '../../config-provider/config-receiver';\nimport { prefix } from '../../config';\nimport { flatColumns } from '../util/props-util';\nimport baseTableProps from '../base-table-props';\nimport { ClassName } from '../../common';\nimport { DataType, BaseTableCol, TdBaseTableProps, RowEventContext } from '../type';\nimport TableBody from './table-body';\nimport TableHeader from './table-header';\nimport TableColGroup from './col-group';\nimport Pagination from '../../pagination';\nimport TLoading from '../../loading';\nimport { debounce, getScrollDirection, ScrollDirection } from '../util/common';\nimport { PageInfo } from '../../pagination/type';\nimport { renderTNodeJSX } from '../../utils/render-tnode';\nimport { EVENT_NAME_WITH_KEBAB } from '../util/interface';\nimport { emitEvent } from '../../utils/event';\nimport { getPropsApiByEvent } from '../../utils/helper';\nimport { SIZE_CLASSNAMES } from '../../utils/classnames';\nimport useVirtualScroll from '../../hooks/virtualScroll';\n\ntype PageChangeContext = Parameters<TdBaseTableProps['onPageChange']>;\n\nexport default defineComponent({\n  ...mixins(getConfigReceiverMixins<TableConfig>('table')),\n  name: 'TBaseTable',\n  components: {\n    TableBody,\n    TableHeader,\n    TableColGroup,\n    Pagination,\n  },\n  props: {\n    ...baseTableProps,\n    onRowDragover: Function,\n    onRowDragstart: Function,\n    provider: {\n      type: Object,\n      default() {\n        return {};\n      },\n    },\n  },\n  emits: ['page-change', 'scroll-x', 'scroll-y', ...EVENT_NAME_WITH_KEBAB],\n  setup(props: any) {\n    const scrollBody = ref(null);\n    provide('scrollBody', scrollBody);\n    const { type, rowHeight, bufferSize = 20, isFixedRowHeight = false } = props.scroll || {};\n    const { data } = toRefs<any>(props);\n    const {\n      trs = null,\n      scrollHeight = null,\n      visibleData = null,\n      translateY = null,\n      handleScroll = null,\n      handleRowMounted = null,\n    } = type === 'virtual'\n      ? useVirtualScroll({\n          container: scrollBody,\n          data,\n          fixedHeight: isFixedRowHeight,\n          lineHeight: rowHeight,\n          bufferSize,\n        })\n      : {};\n    return {\n      scrollType: type,\n      rowHeight,\n      trs,\n      bufferSize,\n      scrollBody,\n      scrollHeight,\n      visibleData,\n      translateY,\n      handleRowMounted,\n      handleVirtualScroll: handleScroll,\n    };\n  },\n  data() {\n    return {\n      scrollableToLeft: false,\n      scrollableToRight: false,\n      scrollBarWidth: 0,\n      // 用于兼容处理 Pagination 的非受控属性（非受控属性仅有 change 事件变化，无 props 变化，因此只需监听事件）\n      defaultCurrent: 0,\n      // 用于兼容处理 Pagination 的非受控属性\n      defaultPageSize: 0,\n      useFixedHeader: false,\n    };\n  },\n  computed: {\n    // this.defaultCurrent 属于分页组件抛出的事件参数，非受控的情况也会有该事件触发\n    // this.pagination.defaultCurrent 为表格组件传入的非受控属性\n    current(): number {\n      return this.pagination?.current || this.defaultCurrent || this.pagination?.defaultCurrent;\n    },\n    pageSize(): number {\n      return this.pagination?.pageSize || this.defaultPageSize || this.pagination?.defaultPageSize;\n    },\n    dataSource(): Array<DataType> {\n      if (!this.hasPagination) return this.data.slice(0);\n      const { current, pageSize } = this;\n      if (this.data.length > pageSize) {\n        return this.data.slice((current - 1) * pageSize, current * pageSize);\n      }\n      return this.data;\n    },\n    flattedColumns(): Array<BaseTableCol> {\n      return flatColumns(this.columns);\n    },\n    isEmpty(): boolean {\n      return (!this.dataSource || this.dataSource.length === 0) && !this.loading;\n    },\n    hasFixedColumns(): boolean {\n      const { columns } = this;\n      return columns.some((item: BaseTableCol) => item.fixed === 'right' || item.fixed === 'left');\n    },\n    hasPagination(): boolean {\n      return !!this.pagination;\n    },\n    isLoading(): boolean {\n      return !!this.loading;\n    },\n    tableHeight(): number | string {\n      const { height, maxHeight, useFixedHeader, isEmpty } = this;\n      if (isEmpty) {\n        return 'auto';\n      }\n      if (height !== 'auto' && height) {\n        return height;\n      }\n      if (maxHeight && useFixedHeader) {\n        return maxHeight;\n      }\n      return 'auto';\n    },\n    // 是否固定表头\n    fixedHeader(): boolean {\n      const { tableHeight } = this;\n      return tableHeight !== 'auto';\n    },\n    // common class\n    commonClass(): ClassName {\n      const classes = [\n        `${prefix}-table`,\n        {\n          [SIZE_CLASSNAMES.small]: this.size === 'small',\n          [SIZE_CLASSNAMES.large]: this.size === 'large',\n          [`${prefix}-table--bordered`]: this.bordered,\n          [`${prefix}-table--striped`]: this.stripe,\n          [`${prefix}-table--hoverable`]: this.hover,\n          [`${prefix}-table__row--draggable`]: this.provider.sortOnRowDraggable,\n          [`${prefix}-table-table--align-top`]: this.verticalAlign === 'top',\n          [`${prefix}-table-table--align-bottom`]: this.verticalAlign === 'bottom',\n          [`${prefix}-table__cell--fixed`]: this.hasFixedColumns,\n          [`${prefix}-table--has-fixed`]: this.hasFixedColumns,\n          [`${prefix}-table__header--fixed`]: this.fixedHeader,\n        },\n      ];\n      return classes;\n    },\n    usePadding(): boolean {\n      return this.fixedHeader || this.scrollableToRight || this.scrollableToLeft;\n    },\n  },\n  mounted() {\n    if (this.hasFixedColumns) {\n      // 首次检查滚动条状态；设置settimeout 是为了等待父组件渲染完\n      setTimeout(() => {\n        this.checkScrollableToLeftOrRight();\n      }, 0);\n      this.addWindowResizeEventListener();\n    }\n    const scrollDiv = document.createElement('div');\n    scrollDiv.style.cssText = `\n      width: 99px;\n      height: 99px;\n      overflow: scroll;\n      position: absolute;\n      top: -9999px;`;\n    scrollDiv.classList.add('scrollbar');\n    document.body.appendChild(scrollDiv);\n    this.scrollBarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth;\n    document.body.removeChild(scrollDiv);\n    const { maxHeight } = this;\n    this.checkMaxHeight();\n  },\n  unmounted() {\n    window.removeEventListener('resize', debounce(this.checkScrollableToLeftOrRight));\n  },\n  updated() {\n    this.checkMaxHeight();\n  },\n  methods: {\n    // 检查是否还可以向左或者向右滚动\n    checkScrollableToLeftOrRight() {\n      const scrollContainer = this.$refs[this.fixedHeader ? 'scrollBody' : 'tableContent'] as HTMLElement;\n      if (!scrollContainer) return;\n      const { scrollLeft, scrollWidth, clientWidth } = scrollContainer;\n      this.scrollableToLeft = scrollLeft > 0;\n      this.scrollableToRight = scrollLeft + clientWidth < scrollWidth;\n    },\n    // 窗口大小变化时横向滚动条可能出现或消失，故检查滚动条状态;\n    addWindowResizeEventListener() {\n      window.addEventListener('resize', debounce(this.checkScrollableToLeftOrRight));\n    },\n    renderHeader(): VNode {\n      const { columns, $slots, bordered } = this;\n      return <TableHeader columns={columns} bordered={bordered} v-slots={$slots} />;\n    },\n    renderBody(): VNode {\n      const { $slots } = this;\n      const rowEvents = {};\n      EVENT_NAME_WITH_KEBAB.concat(['row-dragstart', 'row-dragover']).forEach((eventName) => {\n        rowEvents[getPropsApiByEvent(eventName)] = (params: RowEventContext<any>) => {\n          emitEvent(this, eventName, params);\n        };\n      });\n      const props = {\n        rowKey: this.rowKey,\n        data: this.scrollType === 'virtual' ? this.visibleData : this.dataSource,\n        provider: this.provider,\n        columns: this.flattedColumns,\n        rowClassName: this.rowClassName,\n        current: this.current,\n        rowspanAndColspan: this.rowspanAndColspan,\n        firstFullRow: this.firstFullRow,\n        lastFullRow: this.lastFullRow,\n        scrollType: this.scrollType,\n        rowHeight: this.rowHeight,\n        trs: this.trs,\n        bufferSize: this.bufferSize,\n        handleRowMounted: this.handleRowMounted,\n      };\n      return (\n        <TableBody {...props} {...rowEvents}>\n          {$slots}\n        </TableBody>\n      );\n    },\n    renderEmptyTable(): VNode {\n      const useLocale = !this.empty && !this.$slots.empty;\n      const { height } = this;\n      const wrapperStyle: { height?: string | number } = {};\n      if (height !== 'auto') {\n        wrapperStyle.height = isNaN(Number(height)) ? height : `${height}px`;\n      }\n      return (\n        <div style={wrapperStyle} class={`${prefix}-table__empty`}>\n          {useLocale ? this.global.empty : renderTNodeJSX(this, 'empty')}\n        </div>\n      );\n    },\n    renderPagination(): VNode {\n      const paginationProps = this.pagination;\n      return (\n        <div class={`${prefix}-table__pagination`}>\n          <Pagination\n            {...paginationProps}\n            {...{\n              onChange: (pageInfo: PageInfo) => {\n                paginationProps.onChange && paginationProps.onChange(pageInfo);\n              },\n              onCurrentChange: (current: number, pageInfo: PageInfo) => {\n                emitEvent<PageChangeContext>(this, 'page-change', pageInfo, this.dataSource);\n                this.defaultCurrent = current;\n                paginationProps.onCurrentChange && paginationProps.onCurrentChange(current, pageInfo);\n              },\n              onPageSizeChange: (pageSize: number, pageInfo: PageInfo) => {\n                emitEvent<PageChangeContext>(this, 'page-change', pageInfo, this.dataSource);\n                this.defaultPageSize = pageSize;\n                paginationProps.onPageSizeChange && paginationProps.onPageSizeChange(pageSize, pageInfo);\n              },\n            }}\n          />\n        </div>\n      );\n    },\n    renderTableWithFixedHeader(): Array<VNode> {\n      const fixedTable: Array<VNode> = [];\n      const {\n        columns,\n        provider: { asyncLoadingProps },\n        tableLayout,\n        scrollBarWidth,\n        hasFixedColumns,\n        tableHeight,\n        usePadding,\n      } = this;\n      // handle scroll\n      const handleScroll = throttle((e: Event) => {\n        const { target } = e;\n        const { scrollLeft } = target as HTMLElement;\n        (this.$refs.scrollHeader as HTMLElement).scrollLeft = scrollLeft;\n        this.handleScroll(e as WheelEvent);\n        this.scrollType === 'virtual' && this.handleVirtualScroll();\n      }, 10);\n      //  fixed table header\n      const paddingRight = `${scrollBarWidth}px`;\n      const headerContainerStyle = columns.length > 1 && usePadding ? { paddingRight } : {};\n      fixedTable.push(\n        <div class={`${prefix}-table__header`} style={headerContainerStyle} ref=\"scrollHeader\">\n          <table style={{ tableLayout }}>\n            <TableColGroup columns={columns} />\n            {this.renderHeader()}\n          </table>\n        </div>,\n      );\n      const containerStyle = {\n        height: isNaN(Number(tableHeight)) ? tableHeight : `${Number(tableHeight)}px`,\n        width: hasFixedColumns ? '100%' : undefined,\n        position: 'relative',\n        overscrollBehavior: 'none',\n      };\n      const isVirtual = this.scrollType === 'virtual';\n      fixedTable.push(\n        <div\n          class={`${prefix}-table__body`}\n          style={containerStyle}\n          {...asyncLoadingProps}\n          ref=\"scrollBody\"\n          onScroll={handleScroll}\n        >\n          {isVirtual && (\n            <div\n              style={{\n                position: 'absolute',\n                width: '1px',\n                height: '1px',\n                transition: 'transform .2s',\n                transform: `translate(0, ${this.scrollHeight}px)`,\n              }}\n            />\n          )}\n          <table ref=\"table\" style={{ tableLayout, transform: isVirtual && `translate(0, ${this.translateY}px)` }}>\n            <TableColGroup columns={columns} />\n            {this.renderBody()}\n            {this.renderFooter()}\n          </table>\n        </div>,\n      );\n      return fixedTable;\n    },\n    renderLoadingContent(): VNode {\n      return renderTNodeJSX(this, 'loading', <div />);\n    },\n    renderFooter() {\n      const {\n        flattedColumns: { length: colspan },\n      } = this;\n      const footerContent: VNode = renderTNodeJSX(this, 'footer');\n      return footerContent ? (\n        <tfoot>\n          <tr>\n            <td colspan={colspan}>{footerContent}</td>\n          </tr>\n        </tfoot>\n      ) : null;\n    },\n    handleScroll(e: WheelEvent) {\n      this.checkScrollableToLeftOrRight();\n      const { scrollLeft, scrollTop } = e.target as HTMLElement;\n      const direction = getScrollDirection(scrollLeft, scrollTop);\n      if (direction !== ScrollDirection.UNKNOWN) {\n        const scrollListenerName = direction === ScrollDirection.X ? 'scroll-x' : 'scroll-y';\n        emitEvent(this, scrollListenerName, {\n          e,\n        });\n      }\n    },\n    checkMaxHeight() {\n      const { maxHeight } = this;\n      if (maxHeight && (this.$refs.tableContent as HTMLElement).clientHeight > maxHeight) {\n        this.useFixedHeader = true;\n      }\n    },\n  },\n  render() {\n    const {\n      hasPagination,\n      commonClass,\n      fixedHeader,\n      columns,\n      tableLayout,\n      isLoading,\n      isEmpty,\n      useFixedHeader,\n      hasFixedColumns,\n    } = this;\n    const body: Array<VNode> = [];\n    // colgroup\n    const tableColGroup = <TableColGroup columns={columns} />;\n    // header\n    const tableHeader = this.renderHeader();\n    // table content\n    const tableContent: Array<VNode> = [tableColGroup, tableHeader];\n    // fixed table\n    let fixedTableContent: Array<VNode>;\n    // loading\n    if (fixedHeader || useFixedHeader) {\n      fixedTableContent = this.renderTableWithFixedHeader();\n    } else {\n      // table body\n      tableContent.push(this.renderBody());\n      tableContent.push(this.renderFooter());\n    }\n    if (isEmpty) {\n      body.push(this.renderEmptyTable());\n    }\n    // 渲染分页\n    if (hasPagination) {\n      body.push(this.renderPagination());\n    }\n    const handleScroll = throttle(this.handleScroll, 100);\n    const tableContentClass = [\n      `${prefix}-table__content`,\n      {\n        [`${prefix}-table__content--scrollable-to-right`]: this.scrollableToRight,\n        [`${prefix}-table__content--scrollable-to-left`]: this.scrollableToLeft,\n      },\n    ];\n    let width;\n    const { tableContent: tableContentEl, table: tableEl } = this.$refs as Record<string, HTMLElement>;\n    if (!hasFixedColumns && tableContentEl?.clientWidth < tableEl?.clientWidth) {\n      width = `${tableEl.clientWidth}px`;\n    }\n    return (\n      <div class={commonClass} style={{ width }}>\n        <TLoading loading={isLoading} showOverlay text={this.renderLoadingContent}>\n          <div ref=\"tableContent\" class={tableContentClass} onScroll={handleScroll}>\n            {fixedTableContent || (\n              <table ref=\"table\" style={{ tableLayout }}>\n                {tableContent}\n              </table>\n            )}\n          </div>\n          {body}\n        </TLoading>\n      </div>\n    );\n  },\n});\n"],"names":["defineComponent","mixins","getConfigReceiverMixins","name","components","TableBody","TableHeader","TableColGroup","Pagination","props","baseTableProps","onRowDragover","Function","onRowDragstart","provider","type","Object","emits","EVENT_NAME_WITH_KEBAB","setup","scrollBody","ref","provide","scroll","rowHeight","bufferSize","isFixedRowHeight","toRefs","data","useVirtualScroll","container","fixedHeight","lineHeight","trs","scrollHeight","visibleData","translateY","handleScroll","handleRowMounted","scrollType","handleVirtualScroll","scrollableToLeft","scrollableToRight","scrollBarWidth","defaultCurrent","defaultPageSize","useFixedHeader","computed","current","pagination","pageSize","dataSource","hasPagination","slice","length","flattedColumns","flatColumns","columns","isEmpty","loading","hasFixedColumns","some","item","fixed","isLoading","tableHeight","height","maxHeight","fixedHeader","commonClass","classes","prefix","SIZE_CLASSNAMES","small","size","large","bordered","stripe","hover","sortOnRowDraggable","verticalAlign","usePadding","mounted","setTimeout","checkScrollableToLeftOrRight","addWindowResizeEventListener","scrollDiv","document","createElement","style","cssText","classList","add","body","appendChild","offsetWidth","clientWidth","removeChild","checkMaxHeight","unmounted","window","removeEventListener","debounce","updated","methods","scrollContainer","$refs","scrollLeft","scrollWidth","addEventListener","renderHeader","$slots","renderBody","rowEvents","concat","forEach","eventName","getPropsApiByEvent","params","emitEvent","rowKey","rowClassName","rowspanAndColspan","firstFullRow","lastFullRow","renderEmptyTable","useLocale","empty","wrapperStyle","isNaN","Number","global","renderTNodeJSX","renderPagination","paginationProps","onChange","pageInfo","onCurrentChange","onPageSizeChange","renderTableWithFixedHeader","fixedTable","asyncLoadingProps","tableLayout","throttle","e","target","scrollHeader","paddingRight","headerContainerStyle","push","containerStyle","width","position","overscrollBehavior","isVirtual","transition","transform","renderFooter","renderLoadingContent","colspan","footerContent","scrollTop","direction","getScrollDirection","ScrollDirection","UNKNOWN","scrollListenerName","X","tableContent","clientHeight","render","tableColGroup","tableHeader","fixedTableContent","tableContentClass","tableContentEl","tableEl","table"],"mappings":"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"}