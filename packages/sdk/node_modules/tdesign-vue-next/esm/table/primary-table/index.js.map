{"version":3,"file":"index.js","sources":["../../../src/table/primary-table/index.tsx"],"sourcesContent":["import { defineComponent } from 'vue';\nimport baseTableProps from '../base-table-props';\nimport { DataType, TdBaseTableProps, TdPrimaryTableProps, PrimaryTableCol, RowEventContext } from '../type';\nimport primaryTableProps from '../primary-table-props';\nimport SimpleTable from '../base-table';\nimport expand from './mixins/expand';\nimport select from './mixins/select';\nimport sort from './mixins/sort';\nimport rowDraggable from './mixins/row-draggable';\nimport filter from './mixins/filter';\nimport showColumns from './mixins/show-columns';\nimport asyncLoadingMixin from './mixins/async-loading';\nimport { EVENT_NAME_WITH_KEBAB, RenderExpandRow } from '../util/interface';\nimport { PageInfo } from '../../pagination/type';\nimport { emitEvent } from '../../utils/event';\nimport { getPropsApiByEvent } from '../../utils/helper';\nimport { renderTNodeJSX } from '../../utils/render-tnode';\n\ntype PageChangeContext = Parameters<TdBaseTableProps['onPageChange']>;\ntype ChangeContext = Parameters<TdPrimaryTableProps['onChange']>;\n\nexport default defineComponent({\n  name: 'TTable',\n  components: { SimpleTable },\n  mixins: [expand, select, sort, rowDraggable, filter, showColumns, asyncLoadingMixin],\n  props: {\n    ...baseTableProps,\n    ...primaryTableProps,\n  },\n  emits: ['change', 'page-change', ...EVENT_NAME_WITH_KEBAB],\n  computed: {\n    rehandleColumns(): Array<PrimaryTableCol> {\n      let columns = this.columns.map((col) => ({ ...col }));\n      columns = this.getShowColumns([...this.columns]);\n      columns = this.getSorterColumns(columns);\n      columns = this.getFilterColumns(columns);\n      columns = this.getSelectColumns(columns);\n      columns = this.getExpandColumns(columns);\n      return columns;\n    },\n  },\n  created() {\n    if (typeof this.$attrs['expanded-row-render'] !== 'undefined') {\n      console.warn('The expandedRowRender prop is deprecated. Use expandedRow instead.');\n    }\n  },\n  methods: {\n    // 最后一行，通行数据，可能是异步加载状态，可能是其他\n    renderLastFullRow() {\n      const lastFullRow = renderTNodeJSX(this, 'lastFullRow');\n      const asyncLoadingNode = this.renderAsyncLoadingRow();\n      const nodes = [lastFullRow, asyncLoadingNode].filter((v) => ![undefined, null, false].includes(v));\n      if (nodes.length === 0) return null;\n      if (nodes.length === 1) return nodes[0];\n      return (\n        <div>\n          {nodes[0]}\n          {nodes[1]}\n        </div>\n      );\n    },\n  },\n  render() {\n    const { $props, $slots, rehandleColumns } = this;\n\n    const rowEvents = {};\n    EVENT_NAME_WITH_KEBAB.forEach((eventName) => {\n      rowEvents[getPropsApiByEvent(eventName)] = (params: RowEventContext<any>) => {\n        emitEvent(this, eventName, params);\n      };\n    });\n\n    const listeners = {\n      onPageChange: (pageInfo: PageInfo, newDataSource: Array<DataType>) => {\n        emitEvent<PageChangeContext>(this, 'page-change', pageInfo, newDataSource);\n        emitEvent<ChangeContext>(\n          this,\n          'change',\n          { pagination: pageInfo },\n          { trigger: 'pagination', currentData: newDataSource },\n        );\n      },\n      onRowClick: this.onRowClick,\n      onRowDragstart: this.onDragStart,\n      onRowDragover: this.onDragOver,\n      ...rowEvents,\n    };\n    if (this.expandOnRowClick) {\n      listeners.onRowClick = (params: { row: Record<string, any>; index: number }) => {\n        this.handleExpandChange(params.row);\n      };\n    }\n    const baseTableProps = {\n      ...$props,\n      columns: rehandleColumns,\n      provider: {\n        renderExpandedRow: this.expandedRow ?? this.$slots.expandedRow ? this.renderExpandedRow : undefined,\n        sortOnRowDraggable: this.sortOnRowDraggable,\n        dragging: this.dragging,\n      },\n      firstFullRow: this.hasFilterCondition ? this.renderFirstFilterRow : this.firstFullRow,\n      lastFullRow: this.renderLastFullRow,\n      empty: this.empty,\n      ...listeners,\n    };\n    return (\n      <div style=\"width: 100%\">\n        <simple-table {...baseTableProps}>{$slots}</simple-table>\n      </div>\n    );\n  },\n});\n"],"names":["defineComponent","name","components","SimpleTable","mixins","expand","select","sort","rowDraggable","filter","showColumns","asyncLoadingMixin","props","baseTableProps","primaryTableProps","emits","EVENT_NAME_WITH_KEBAB","computed","rehandleColumns","columns","map","col","getShowColumns","getSorterColumns","getFilterColumns","getSelectColumns","getExpandColumns","created","$attrs","console","warn","methods","renderLastFullRow","lastFullRow","renderTNodeJSX","asyncLoadingNode","renderAsyncLoadingRow","nodes","v","includes","length","render","$props","$slots","rowEvents","forEach","eventName","getPropsApiByEvent","params","emitEvent","listeners","onPageChange","pageInfo","newDataSource","pagination","trigger","currentData","onRowClick","onRowDragstart","onDragStart","onRowDragover","onDragOver","expandOnRowClick","handleExpandChange","row","baseTableProps2","provider","renderExpandedRow","expandedRow","sortOnRowDraggable","dragging","firstFullRow","hasFilterCondition","renderFirstFilterRow","empty"],"mappings":"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"}