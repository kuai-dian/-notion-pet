{"version":3,"file":"expand.js","sources":["../../../../src/table/primary-table/mixins/expand.tsx"],"sourcesContent":["import { defineComponent, VNode, h } from 'vue';\nimport get from 'lodash/get';\nimport { TdPrimaryTableProps } from '../../type';\nimport baseTableProps from '../../base-table-props';\nimport ExpandBox from '../expand-box';\nimport TableRow from '../../base-table/table-row';\nimport { ExpandProps, RenderExpandRow } from '../../util/interface';\nimport { filterDataByIds, getRecord } from '../../util/common';\nimport { prefix } from '../../../config';\nimport { emitEvent } from '../../../utils/event';\nimport { renderTNodeJSX } from '../../../utils/render-tnode';\n\ntype Columns = TdPrimaryTableProps['columns'];\n\nconst expandedColKey = 'expanded-icon-cell';\nexport default defineComponent({\n  name: `${prefix}-primary-table-expand`,\n  props: {\n    data: baseTableProps.data,\n    rowKey: baseTableProps.rowKey,\n    ...ExpandProps,\n  },\n  emits: ['expand-change'],\n  computed: {\n    reRowKey(): string {\n      return this.rowKey || 'id';\n    },\n  },\n  methods: {\n    getExpandRowHandler(): TdPrimaryTableProps['expandedRow'] {\n      if (!this.expandedRow && !this.$slots.expandedRow) return;\n      return (h, params) => renderTNodeJSX(this, 'expandedRow', { params });\n    },\n    getExpandColumns(columns: Columns): Columns {\n      const expandRowHandler = this.getExpandRowHandler();\n      if (!expandRowHandler || !this.expandIcon) return columns;\n\n      return [\n        {\n          colKey: expandedColKey,\n          width: 48,\n          attrs: {\n            class: [`${prefix}-table__expandable-icon-cell`],\n            style: {\n              overflow: 'auto',\n            },\n          },\n          cell: (h, { row, rowIndex }) => this.renderExpandIconCell({ row, rowIndex }),\n        },\n        ...columns,\n      ];\n    },\n    // 渲染展开单元格内容\n    renderExpandIconCell({ row, rowIndex }: Record<string, any>): VNode {\n      const { expandedRowKeys = [] } = this;\n      const id = get(row, this.reRowKey);\n      const isExpanded = expandedRowKeys.indexOf(id) !== -1;\n      return (\n        <ExpandBox\n          expandIcon={this.expandIcon}\n          expanded={isExpanded}\n          row={row}\n          rowIndex={rowIndex}\n          onClick={(e: MouseEvent) => {\n            this.expandOnRowClick && e.stopPropagation();\n            this.handleExpandChange(row);\n          }}\n        />\n      );\n    },\n\n    // 渲染被展开行\n    renderExpandedRow(\n      params: Parameters<TdPrimaryTableProps['expandedRow']>[1],\n    ): ReturnType<TdPrimaryTableProps['expandedRow']> {\n      const id = get(params.row, this.reRowKey);\n      const isShowExpanded = this.expandedRowKeys.includes(id);\n      if (isShowExpanded) {\n        return (\n          <tr>\n            <td colspan={this.columns.length}>{renderTNodeJSX(this, 'expandedRow', { params })}</td>\n          </tr>\n        );\n      }\n      return null;\n    },\n    // handle\n    handleExpandChange(record: Record<string, any> = {}): void {\n      const expandedRowKeys = [...this.expandedRowKeys] as Array<string | number>;\n      const id = get(record, this.reRowKey);\n      const expandedRowIndex = expandedRowKeys.indexOf(id);\n      const isExpanded = expandedRowIndex !== -1;\n      isExpanded\n        ? expandedRowKeys.splice(expandedRowIndex, 1) // 删除\n        : expandedRowKeys.push(id); // 增加\n      emitEvent(this, 'expand-change', expandedRowKeys, {\n        expandedRowData: filterDataByIds(this.data, expandedRowKeys),\n      });\n    },\n  },\n});\n"],"names":["expandedColKey","defineComponent","name","prefix","props","data","baseTableProps","rowKey","ExpandProps","emits","computed","reRowKey","methods","getExpandRowHandler","expandedRow","$slots","h2","params","renderTNodeJSX","getExpandColumns","columns","expandRowHandler","expandIcon","colKey","width","attrs","style","overflow","cell","row","rowIndex","renderExpandIconCell","expandedRowKeys","id","get","isExpanded","indexOf","e","expandOnRowClick","stopPropagation","handleExpandChange","renderExpandedRow","isShowExpanded","includes","length","record","expandedRowIndex","splice","push","emitEvent","expandedRowData","filterDataByIds"],"mappings":"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"}