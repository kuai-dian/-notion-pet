{"version":3,"file":"useDefault.js","sources":["../../src/hooks/useDefault.ts"],"sourcesContent":["import { computed, ref, SetupContext, watchEffect, WritableComputedRef } from 'vue';\nimport camelCase from 'lodash/camelCase';\n\nfunction getDefaultName(key: string): string {\n  const str = camelCase(key);\n  return `default${str[0].toLocaleUpperCase() + str.slice(1)}`;\n}\n\n// eventName is keybase, change -> onChange; visible-change -> onVisibleChange\nfunction getEventPropsName(eventName: string): string {\n  const str = camelCase(eventName);\n  return `on${str[0].toLocaleUpperCase()}${str.slice(1)}`;\n}\n\n/**\n * 受控和非受控逻辑处理，包含 value / modelValue / events\n * @param props 属性\n * @param emit 触发方法，context.emit\n * @param key 受控属性名称\n * @param eventName 事件名称\n * @example const [value, setValue] = useDefault();\n * @returns [value, setValue]\n */\nexport default function useDefault<V, T>(props: T, emit: SetupContext['emit'], key: string, eventName: string) {\n  const modelValue = 'modelValue';\n  const defaultName = getDefaultName(String(key));\n\n  const isUsedModelValue = props[modelValue] !== undefined;\n  const isUsedKey = props[key] !== undefined;\n\n  const innerValue = ref<V>();\n\n  if (isUsedKey) {\n    innerValue.value = props[key];\n  } else if (isUsedModelValue) {\n    innerValue.value = props[modelValue];\n  } else {\n    innerValue.value = props[defaultName];\n  }\n\n  watchEffect(() => {\n    if (isUsedModelValue) {\n      innerValue.value = props[modelValue];\n    }\n    if (isUsedKey) {\n      innerValue.value = props[key];\n    }\n  });\n\n  function emitEvents<T extends Array<any>>(value: V, ...arg: T) {\n    const updateKeys = [`update:${key}`];\n    if (isUsedModelValue) {\n      updateKeys.push(`update:modelValue`);\n    }\n    // Props Event exists in Vue3. `props.onChange()` is equal `contex.emit('change')`\n    updateKeys.forEach((updateKey) => {\n      emit(updateKey, value, ...arg);\n    });\n    const propsEventName = getEventPropsName(eventName);\n    props[propsEventName]?.(value, ...arg);\n  }\n\n  function setInnerValue<M extends Array<any>>(value: V, ...arg: M) {\n    if (!isUsedKey && !isUsedModelValue) {\n      innerValue.value = value;\n    }\n    emitEvents<M>(value, ...arg);\n  }\n\n  const innerValueRef = computed({\n    get() {\n      return innerValue.value;\n    },\n    set(value: V) {\n      setInnerValue(value);\n    },\n  });\n\n  return [innerValueRef, setInnerValue] as [WritableComputedRef<V>, typeof setInnerValue];\n}\n"],"names":["getDefaultName","key","str","camelCase","toLocaleUpperCase","slice","getEventPropsName","eventName","useDefault","props","emit","modelValue","defaultName","String","isUsedModelValue","isUsedKey","innerValue","ref","value","watchEffect","emitEvents","arg","updateKeys","push","forEach","updateKey","propsEventName","setInnerValue","innerValueRef","computed","get","set"],"mappings":"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"}